function ShowMesasByCurrentTab(){var e=$("#nav li.active");$("#nav li.active").length>0&&MostrarMesas(e.attr("data-idambiente"))}function crearItemAmbiente(e,t){var a="";return a+='<li data-idambiente="'+e.tm_idambiente+'">',a+='<div class="collapsible-header"><i class="material-icons">&#xE42A;</i>'+e.tm_nombre+"</div>",a+='<div class="collapsible-body">',a+='<div class="panel panel-default no-margin">',a+='<div class="panel-heading"><h3 class="panel-title">Lista de equipos</h3></div>',a+='<div class="panel-body"><div class="gridview mdl-grid no-padding"></div></div>',a+='<div class="panel-footer">',a+='<button data-action="edit-ambiente" type="button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--primary mdl-button--colored left">Editar ambiente</button>',a+='<button data-action="delete-ambiente" type="button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored left">Eliminar ambiente</button>',a+='<button data-action="new-mesa" type="button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored right">Nueva máquina</button>',a+='<div class="clear"></div>',a+="</div>",a+="</div>",a+="</div>",a+="</li>"}function MostrarAmbientes(){$.ajax({url:"services/ambientes/ambientes-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(e){var t=0,a=e.length,i="";if(a>0)for(;t<a;)i+=crearItemAmbiente(e[t],0==t),++t;$("#nav").html(i).collapsible({accordion:!1}).find("li:first > .collapsible-header").trigger("click")},error:function(e){console.log(e)}})}function GuardarAmbiente(){var e=new FormData,t=$("#modalAmbiente :input").serializeArray();e.append("btnGuardarAmbiente","btnGuardarAmbiente"),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/ambientes/mesas-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){if(createSnackbar(e.titulomsje),"0"!=e.rpta){var t=$("#hdIdAmbiente").val(),a=crearItemAmbiente(e.rpta[0],!1);"0"==t?$("#nav").append(a):$('#nav li[data-idambiente="'+t+'"]').replaceWith(a),$("#nav").collapsible({accordion:!1}),"0"!=t&&$('#nav li[data-idambiente="'+t+'"] > .collapsible-header').trigger("click"),closeCustomModal("#modalAmbiente")}},error:function(e){console.log(e)}})}function LimpiarAmbiente(){$("#hdIdAmbiente").val("0"),$("#txtCodigoAmbiente").val(""),$("#txtNombreAmbiente").val(""),Materialize.updateTextFields()}function GoToEditAmbiente(e){LimpiarAmbiente(),openModalCallBack("#modalAmbiente",function(){"0"!=e&&$.ajax({url:"services/ambientes/amesas-getdetails.php",type:"GET",dataType:"json",cache:!1,data:{tipo:"00",id:e},success:function(e){e.length>0&&($("#hdIdAmbiente").val(e[0].tm_idambiente),$("#txtCodigoAmbiente").val(e[0].tm_codigo),$("#txtNombreAmbiente").val(e[0].tm_nombre),Materialize.updateTextFields())},error:function(e){console.log(e)}})})}function EliminarAmbiente(e){var t=e.getAttribute("data-idambiente");MessageBox({content:"¿Desea eliminar el ambiente?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(a){var i=new FormData;i.append("btnEliminarAmbiente","btnEliminarAmbiente"),i.append("hdIdAmbiente",t),$.ajax({type:"POST",url:"services/ambientes/mesas-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:i,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&$(e).fadeOut(400,function(){$(this).remove()})},error:function(e){console.log(e)}})}}],cancelButton:!0})}function LimpiarMesa(){$("#hdIdMesa").val("0"),$("#txtCodigoMesa").val(""),$("#txtNroComensales").val("1"),Materialize.updateTextFields()}function GoToEditMesa(e){LimpiarMesa(),openModalCallBack("#modalMesa",function(){"0"!=e&&$.ajax({type:"GET",url:"services/ambientes/amesas-getdetails.php",cache:!1,data:{tipo:"01",id:e},dataType:"json",success:function(e){e.length>0&&($("#hdIdMesa").val(e[0].tm_idmesa),$("#txtCodigoMesa").val(e[0].tm_codigo),$("#txtNroComensales").val(e[0].tm_nrocomensales),Materialize.updateTextFields())},error:function(e){console.log(e)}})})}function GuardarMesa(){var e=new FormData,t=$("#modalMesa :input").serializeArray();e.append("btnGuardarMesa","btnGuardarMesa"),e.append("hdIdAmbiente",$("#hdIdAmbiente").val()),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/ambientes/mesas-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#modalMesa"),ShowMesasByCurrentTab())},error:function(e){console.log(e)}})}function EliminarItemMesa(e,t){var a=new FormData,i=e.getAttribute("data-idmesa");a.append("btnEliminarMesa","btnEliminarMesa"),a.append("hdIdMesa",i),$.ajax({type:"POST",url:"services/ambientes/mesas-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:a,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove(),0==$("#nav li.active .dato").length&&$("#nav li.active .gridview").html("<h2>No se encontraron registros</h2>")}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemMesa(elemsSelected[indexList],t):(n=!0,i=a.titulomsje)):"single"==t&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function MostrarMesas(e){precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/ambientes/mesas-search.php",cache:!1,dataType:"json",data:{tipo:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),id:e},success:function(e){var t=e.length,a=0,i="#nav li.active .gridview",n="";if(t>0)for(;a<t;)n+='<div class="card-panel pos-rel dato mdl-shadow--2dp mdl-cell mdl-cell--2-col mdl-cell--2-col-tablet mdl-cell--2-col-phone" data-idmesa="'+e[a].tm_idmesa+'">',n+='<input type="checkbox" name="chkItem[]" class="oculto" value="'+e[a].tm_idmesa+'" />',n+='<h1 class="padding10 align-center">'+e[a].tm_codigo+"</h1>",n+='<div class="dato-badge place-top-right margin5 padding5 align-center blue darken-1 white-text rounded">'+e[a].tm_nrocomensales+"</div>",n+='<div class="grouped-buttons place-bottom-right padding5 margin5">',n+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="edit-mesa" data-delay="50" data-position="bottom" data-tooltip="Editar"><i class="material-icons">&#xE254;</i></a>',n+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="delete-mesa" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></a>',n+="</div>",n+="</div>",++a;else n="<h2>No se encontraron registros</h2>";$(i).html(n),precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}$(function(){MostrarAmbientes(),$("#nav").on("click","li > .collapsible-header",function(e){e.preventDefault(),ShowMesasByCurrentTab()}),$("#nav").on("click",".mdl-button",function(e){e.preventDefault();var t,a=this.getAttribute("data-action"),i="0";"edit-ambiente"==a||"delete-ambiente"==a||"new-mesa"==a?(t=getParentsUntil(this,"#nav","li"),i=t[0].getAttribute("data-idambiente"),"edit-ambiente"==a?GoToEditAmbiente(i):"delete-ambiente"==a?EliminarAmbiente(t[0]):($("#hdIdAmbiente").val(i),GoToEditMesa("0"))):"edit-mesa"!=a&&"delete-mesa"!=a||(t=getParentsUntil(this,"#nav",".dato"),"edit-mesa"==a?(i=t[0].getAttribute("data-idmesa"),GoToEditMesa(i)):MessageBox({content:"¿Desea eliminar la mesa?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemMesa(t[0],"single")}}],cancelButton:!0}))}),$("#btnNuevoAmbiente").on("click",function(e){e.preventDefault(),GoToEditAmbiente("0")}),$("#btnGuardarAmbiente").on("click",function(e){e.preventDefault(),GuardarAmbiente()}),$("#btnGuardarMesa").on("click",function(e){e.preventDefault(),GuardarMesa()})});var indexList=0,elemsSelected,progress=0,progressError=!1;