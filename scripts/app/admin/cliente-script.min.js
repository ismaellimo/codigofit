function LimpiarForm(){$("#hdIdPrimary").val(""),$("#txtnroDNI").val(""),$("#rbSexo__Masculino")[0].checked=!0,$("#txtFechaNacimiento").val(""),$("#txtApellidos").val(""),$("#txtNombres").val(""),$("#txtTelefono").val(""),$("#txtCelular").val(""),$("#txtEmail").val(""),$("#txtFacebook").val("")}function removeValidFormRegister(){$("#txtnroDNI").rules("remove"),$("#txtFechaNacimiento").rules("remove"),$("#txtNombres").rules("remove"),$("#txtApellidos").rules("remove"),$("#txtCelular").rules("remove"),$("#txtEmail").rules("remove")}function addValidFormRegister(){$("#txtnroDNI").rules("add",{required:!0}),$("#txtFechaNacimiento").rules("add",{required:!0}),$("#txtNombres").rules("add",{required:!0}),$("#txtApellidos").rules("add",{required:!0}),$("#txtCelular").rules("add",{required:!0}),$("#txtEmail").rules("add",{required:!0,email:!0})}function GoToEdit(e){var t="#pnlForm";document.getElementById("hdIdPrimary").value="0",document.getElementById("hdFoto").value="no-set",precargaExp(t,!0),resetFoto("new"),LimpiarForm(),removeValidFormRegister(),addValidFormRegister(),openModalCallBack(t,function(){"0"==e?precargaExp(t,!1):$.ajax({type:"GET",url:"services/clientes/cliente-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){if(e.length>0){var a=e[0].tm_foto,i=a.replace("_o","_s255");$("#hdIdPrimary").val(e[0].tm_idcliente),$("#txtNombres").val(e[0].tm_nombres),$("#txtApellidos").val(e[0].tm_apellidos),$("#txtnroDNI").val(e[0].tm_nrodni),$("#txtFechaNacimiento").val(ConvertMySQLDate(e[0].tm_fechanac)),$("#rbSexo__Masculino")[0].checked="1"==e[0].tm_sexo,$("#rbSexo__Femenino")[0].checked="1"!=e[0].tm_sexo,$("#txtTelefono").val(e[0].tm_telefono),$("#txtCelular").val(e[0].tm_celular),$("#txtEmail").val(e[0].tm_email),$("#txtFacebook").val(e[0].tm_facebook),"no-set"!=a?setFoto(i):i="images/user-nosetimg-233.jpg",imgFoto.setAttribute("data-src",i),$("#hdFoto").val(a),$("#txtnroDNI").val(e[0].tm_nrodni).focus(),Materialize.updateTextFields()}precargaExp(t,!1)},error:function(e){console.log(e)}})})}function BuscarDatos(e){var t="#gvDatos",a=t+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/cliente/cliente-search.php",cache:!1,dataType:"json",data:{criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),pagina:e},success:function(i){var n=i.length,l=0,r="";if(n>0){for(;l<n;){var o=i[l].tm_idcliente,c=i[l].tm_foto.replace("_o","_s42");r+='<li class="collection-item avatar no-border dato" data-idmodel="'+o+'"  data-baselement="'+t+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+o+'" />',r+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',r+="no-set"==c?'<i class="material-icons circle">&#xE853;</i>':'<img src="'+c+'" alt="" class="circle">',r+='<span class="title descripcion">'+i[l].tm_nombres+"</span>",r+="<p>Apellidos: "+i[l].tm_apellidos+' - DNI: <span class="dni">'+i[l].tm_nrodni+"</span><br>",r+="<p>Celular: "+i[l].tm_celular+' - Teléfono fijo: <span class="Fijo">'+i[l].tm_telefono+"</span><br>",r+='<span class="correo">Correo: '+i[l].tm_email+"</span> - Facebook: "+i[l].tm_facebook+"</p>",r+='<div class="grouped-buttons place-top-right padding5">',r+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',r+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="asistenciacliente" class="waves-effect">Asistencia</a></li><li><a href="#" data-action="clasescliente" class="waves-effect">Clases</a></li><li><a href="#" data-action="evaluacioncliente" class="waves-effect">Evaluaci&oacute;n</a></li><li><a href="#" data-action="rutinacliente" class="waves-effect">Rutinas</a></li><li><a href="#" data-action="dietacliente" class="waves-effect">Dietas</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',r+="</div>",r+='<div class="divider"></div>',r+="</li>",++l}datagrid.currentPage(datagrid.currentPage()+1),"1"==e?$(a).html(r):$(a).append(r)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GuardarDatos(){var e=document.getElementById("hdFoto"),t=fileValue,a=new FormData;if($("#form1").valid()){precargaExp("#pnlForm",!0),"images/user-nosetimg-233.jpg"==e.value&&(e.value="no-set"),a.append("btnGuardar","btnGuardar"),a.append("hdIdEmpresa",$("#hdIdEmpresa").val()),a.append("hdIdcentro",$("#hdIdCentro").val()),a.append("archivo",t);var i=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(i,function(e){a.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/cliente/cliente-post.php",contentType:!1,processData:!1,cache:!1,data:a,dataType:"json",success:function(e){precargaExp("#pnlForm",!1),createSnackbar(e.titulomsje),Number(e.rpta)>0&&(closeCustomModal("#pnlForm"),paginaGeneral=1,BuscarDatos("1"))},error:function(e){console.log(e)}})}}function Eliminarcliente(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemcliente(elemsSelected[0],"multiple")}function EliminarItemcliente(e,t){var a=new FormData,i=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdCliente",i),$.ajax({url:"services/cliente/cliente-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemcliente(elemsSelected[indexList],t):(n=!0,i=a.titulomsje)):"single"==t&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function Buscar(){BuscarDatos("1")}function navigateInFrame(e,t){var a="ifr"+t,i=document.getElementById(a);if(null===i){var n=document.createElement("iframe");n.setAttribute("id",a),n.setAttribute("scrolling","no"),n.setAttribute("marginwidth","0"),n.setAttribute("marginheight","0"),n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("frameborder","no"),n.setAttribute("src",t),n.addEventListener("load",function(e){}),$(e).append(n)}}function GoToDetalleCliente(e){openModalCallBack("#pnlDetalleCliente",function(){$('#tabDetalleCliente .mdl-tabs__tab-bar .mdl-tabs__tab[href="#'+e+'"] span').trigger("click")})}$(function(){BuscarDatos("1"),cargarDatePicker("#txtFechaNacimiento",function(e,t){}),$("#btnSearch").on("click",function(e){e.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#generic-actionbar").on("click touchend","button",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){Eliminarcliente()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),i=a[0].getAttribute("data-idmodel");"edit"==t?GoToEdit(i):"asistenciacliente"==t||"clasescliente"==t||"evaluacioncliente"==t||"rutinacliente"==t||"dietacliente"==t?GoToDetalleCliente(t):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemcliente(a[0],"single")}}],cancelButton:!0})}),$("#tabDetalleCliente .mdl-tabs__tab-bar").on("click",".mdl-tabs__tab span",function(e){var t=this.parentNode.getAttribute("href");null!==t&&navigateInFrame(t+" .mdl-tabs__panel-content","?pag=admin&subpag="+t.substr(1)+"&op=list")}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(e){e.preventDefault(),GuardarDatos()}),$("#form1").validate({lang:"es",errorElement:"div",errorPlacement:function(e,t){var a=$(t).data("error");a?$(a).append(e):e.insertAfter(t)}})});var indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}});