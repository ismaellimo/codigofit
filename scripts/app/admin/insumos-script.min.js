function LimpiarCategoria(){$("#hdIdCategoria").val("0"),$("#txtNombreCategoria").val("").focus()}function LimpiarAlmacen(){$("#hdIdAlmacen").val("0"),$("#txtDireccionAlmacen").val(""),$("#txtNombreAlmacen").val("").focus()}function LimpiarInsumo(){$("#hdIdPrimary").val("0"),$("#txtDescripcion").val(""),$("#txtCostoPromedio").val("0.00"),$("#txtStockMinimo").val("0.000"),$("#txtStockMaximo").val("0.000"),$("#txtNombre").val("").focus()}function Nuevo(){$("#gvDatos").is(":visible")?GoToEditInsumo("0"):$("#gvAlmacen").is(":visible")?GoToEditAlmacen("0"):GoToEditCategoria("0")}function FiltrarPorIdItem(e){$("#hdIdCategoria").value=e,navigateSubSite("#gvDatos","Insumos"),ListarInsumos("#gvDatos","1","0","1")}function clearFormPresentacion(){$("#ddlPresentacion")[0].selectedIndex=0,$("#txtMedida").val("0")}function ListarPresentaciones(e){$.ajax({type:"GET",url:"services/presentacion/presentacion-search.php",cache:!1,data:"tipobusqueda=1&idinsumo="+e+"&tipoinsumo=00",dataType:"json",success:function(e){var t=e.length,a=0,o="";if(t>0)for(;a<t;)o+=crearItem_Presentacion(e[a].tm_idpresentacion,e[a].tm_idunidadmedida,e[a].Presentacion,e[a].UnidadMedida,e[a].td_medida),++a,counter_presentacion=a;$("#tablePresentacion tbody").html(o)},error:function(e){console.log(e)}})}function GetInfoPresentacion(){var e=$("#tablePresentacion tbody tr.selected:first"),t=e[0].getAttribute("data-idpresentacion"),a=(e[0].getAttribute("data-idunidadmedida"),e.find(".medida").text());$("#ddlPresentacion").val(t),$("#txtMedida").val(a)}function crearItem_Presentacion(e,t,a,o,n){var i="";return i+='<tr data-iddetalle="0" data-idpresentacion="'+e+'" data-idunidadmedida="'+t+'">',i+='<td class="hide">',i+='<input type="hidden" name="pre_insumo['+counter_presentacion+'][idpresentacion]" value="'+e+'" />',i+='<input type="hidden" name="pre_insumo['+counter_presentacion+'][idunidadmedida]" value="'+t+'" />',i+='<input type="hidden" name="pre_insumo['+counter_presentacion+'][medida]" value="'+n+'" />',i+="</td>",i+='<td class="presentacion">'+a+"</td>",i+='<td class="unidadmedida">'+o+"</td>",i+='<td class="medida text-right">'+n+"</td>",i+='<td class="text-center"><a class="padding5 mdl-button mdl-button--icon tooltipped center-block" href="#" data-action="delete" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></a></td>',i+="</tr>"}function AddDetalle(){var e=$("#tablePresentacion tbody tr.selected"),t=$("#ddlPresentacion").val(),a=$("#ddlPresentacion option:selected").text(),o=$("#ddlUnidadMedidaReg").val(),n=$("#ddlUnidadMedidaReg option:selected").attr("data-simbolo"),i=Number($("#txtMedida").val());if($("#btnPresentacionAdd").hasClass("mode-edit"))e.length>0&&(e.attr("data-idpresentacion",t),e.attr("data-idunidadmedida",o),e.find(".presentacion").text(a),e.find(".unidadmedida").text(n),e.find(".medida").text(i),closeCustomModal("#pnlInfoPresentacion"),$("#tablePresentacion tbody tr.selected").removeClass("selected"));else{$("#tablePresentacion tbody tr:first").find("h3").length>0&&$("#tablePresentacion tbody tr").remove();var r=crearItem_Presentacion(t,o,a,n,i);$("#tablePresentacion tbody").append(r),++counter_presentacion,clearFormPresentacion(),$("#ddlPresentacion").focus()}}function BackToList(){removeValidFormInsumo(),$("#pnlForm").fadeOut(500,function(){$("#pnlListado").fadeIn(500,function(){})})}function addValidFormCategoria(){$("#txtNombreCategoria").rules("add",{required:!0,maxlength:150,remote:{url:"services/categorias/check-nombre-categoria_insumo.php",type:"POST",data:{idempresa:function(){return $("#hdIdEmpresa").val()},idcentro:function(){return $("#hdIdCentro").val()},idregistro:function(){return $("#hdIdCategoria").val()}}}})}function removeValidFormCategoria(){$("#txtNombreCategoria").rules("remove")}function addValidFormAlmacen(){$("#txtNombreAlmacen").rules("add",{required:!0,maxlength:150,remote:{url:"services/almacen/check-nombre.php",type:"POST",data:{idempresa:function(){return $("#hdIdEmpresa").val()},idcentro:function(){return $("#hdIdCentro").val()},idregistro:function(){return $("#hdIdAlmacen").val()}}}})}function removeValidFormAlmacen(){$("#txtNombreAlmacen").rules("remove")}function addValidFormInsumo(){$("#txtNombre").rules("add",{required:!0,maxlength:350,remote:{url:"services/insumos/check-nombre.php",type:"POST",data:{idempresa:function(){return $("#hdIdEmpresa").val()},idcentro:function(){return $("#hdIdCentro").val()},idregistro:function(){return $("#hdIdPrimary").val()}}}}),$("#txtCostoPromedio").rules("add",{required:!0})}function removeValidFormInsumo(){$("#txtNombre").rules("remove"),$("#txtCostoPromedio").rules("remove")}function GoToEditCategoria(e){var t="#modalRegCategoria";precargaExp(t,!0),addValidFormCategoria(),openModalCallBack(t,function(){LimpiarCategoria(),"0"==e?precargaExp(t,!1):$.ajax({url:"services/categorias/categoriainsumo-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:e},success:function(e){e.length>0&&($("#hdIdCategoria").val(e[0].tm_idcategoria_insumo),$("#txtNombreCategoria").val(e[0].tm_nombre).focus()),precargaExp(t,!1)},error:function(e){console.log(e)}})})}function GuardarCategoria(){var e=new FormData;if($("#form1").valid()){var t=$("#modalRegCategoria :input").serializeArray();e.append("btnAplicarCategoria","btnAplicarCategoria"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),$.each(t,function(t,a){e.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/categorias/categoriainsumo-post.php",cache:!1,dataType:"json",data:e,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#modalRegCategoria"),ListarCategorias("1"))},error:function(e){console.log(e)}})}}function EliminarCategoria(){indexList=0,elemsSelected=$("#gvCategoria .selected"),EliminarItemCategoria(elemsSelected[0],"multiple")}function EliminarItemCategoria(e,t){var a=new FormData,o=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdCategoria",o),$.ajax({url:"services/categorias/categoriainsumo-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var o="",n=$(e),i=!1;"0"==a.rpta?(i=!0,o="No se puede eliminar"):(n.fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemCategoria(elemsSelected[indexList],t):(i=!0,o=a.titulomsje)):"single"==t&&(i=!0,o=a.titulomsje)),i&&(createSnackbar(o),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"),"undefined"!=typeof endCallback&&endCallback())},error:function(e){console.log(e)}})}function ListarCategorias(e){var t="#gvCategoria",a=t+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/categorias/categoriainsumo-search.php",cache:!1,dataType:"json",data:{tipobusqueda:1,idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:$("#txtSearch").val(),pagina:e},success:function(o){var n=0,i=o.length,r="",s="0";if(i>0){for(;n<i;){var s=o[n].tm_idcategoria_insumo;o[n].tm_nombre;r+='<li data-idmodel="'+s+'" class="list-group-item dato" data-baselement="'+t+'">',r+='<input name="chkItem[]" type="checkbox" class="filled-in" value="'+s+'" id="chkItem'+n+'" /><label for="chkItem'+n+'" class="check-filled"></label>',r+=o[n].tm_nombre,r+='<div class="grouped-buttons place-bottom-right padding5">',r+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons">&#xE5D4;</i></a>',r+='<ul class="dropdown">',r+='<li><a href="#" data-action="edit">Editar</a></li>',r+='<li><a href="#" data-action="delete">Eliminar</a></li>',r+="</div>",r+="</li>",++n}gvCategoria.currentPage(gvCategoria.currentPage()+1),"1"==e?$(a).html(r):$(a).append(r),registerScriptMDL("#gvCategoria .mdl-js-checkbox")}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GoToEditInsumo(e){var t="#pnlForm";precargaExp(t,!0),addValidFormInsumo(),$("#tablePresentacion tbody").html(""),$("#pnlListado").fadeOut(500,function(){$(t).fadeIn(500,function(){LimpiarInsumo(),"0"==e?(ListarCategorias_Combo("0"),ListarUnidadMedida_Combo("#ddlUnidadMedidaReg","0"),precargaExp(t,!1)):$.ajax({type:"GET",url:"services/insumos/insumos-getdetails.php",cache:!1,data:"id="+e,dataType:"json",success:function(e){if(e.length>0){var a=e[0].tm_idinsumo;$("#hdIdPrimary").val(a),$("#txtDescripcion").val(e[0].tm_descripcion),$("#txtCostoPromedio").val(e[0].tm_costoPromedio),$("#txtStockMinimo").val(e[0].tm_stock_min),$("#txtStockMaximo").val(e[0].tm_stock_max),Materialize.updateTextFields(),ListarCategorias_Combo(e[0].tm_idcategoria),ListarUnidadMedida_Combo("#ddlUnidadMedidaReg",e[0].tm_idunidadmedida),counter_presentacion=0,ListarPresentaciones(a),$("#txtNombre").val(e[0].tm_nombre).focus()}precargaExp(t,!1)},error:function(e){console.log(e)}})})})}function GuardarInsumo(){if($("#form1").valid()){var e=new FormData,t=$("#pnlForm :input").serializeArray();e.append("btnGuardar","btnGuardar"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),$.each(t,function(t,a){e.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/insumos/insumos-post.php",cache:!1,dataType:"json",data:e,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(BackToList(),ListarInsumos("#gvDatos","1","0","1"))},error:function(e){console.log(e)}})}}function EliminarInsumo(){indexList=0,elemsSelected=$("#gvDatos .selected").toArray(),EliminarItemInsumo(elemsSelected[0],"multiple")}function EliminarItemInsumo(e,t){var a=new FormData,o=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdInsumo",o),$.ajax({url:"services/insumos/insumos-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var o="",n=!1,i=$(e);"0"==a.rpta?(n=!0,o="No se puede eliminar"):(i.fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemInsumo(elemsSelected[indexList],t):(n=!0,o=a.titulomsje)):"single"==t&&(n=!0,o=a.titulomsje)),n&&(createSnackbar(o),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"),"undefined"!=typeof endCallback&&endCallback())},error:function(e){console.log(e)}})}function ListarInsumos(e,t,a,o){var n=e+" .contenedor",i="#gvDatos"==e?"INSUMO":"INSUMO-STOCK",r="#gvDatos"==e?"#txtSearch":"#txtSearchStock",s=$("#hdIdCategoria").val();precargaExp("#pnlListado",!0),$.ajax({url:"services/insumos/insumos-search.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:i,tipo:t,idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idalmacen:a,id:s,criterio:$(r).val(),pagina:o},success:function(t){var a=t.length,i=0,r="";if(a>0){for(;i<a;){var s=t[i].tm_idinsumo;"#gvDatos"==e?(r+='<div class="pos-rel card-panel padding10 mdl-shadow--2dp mdl-cell mdl-cell--2-col mdl-cell--2-col-tablet mdl-cell--4-col-phone dato bg-gray-glass" data-idmodel="'+s+'" data-baselement="'+e+'">',r+='<input name="chkInsumo[]" type="checkbox" class="oculto" value="'+s+'" />',r+='<h4 class="descripcion">'+t[i].tm_nombre+"</h4>",r+='<strong>Unidad base:</strong> <span class="unidadmedida">'+t[i].nombre_unidad+" ("+t[i].simbolo_unidad+")</span>",r+='<i class="icon-select place-top-right margin10 material-icons white-text circle">done</i><div class="layer-select"></div>',r+='<div class="grouped-buttons place-bottom-right padding5">',r+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons">&#xE5D4;</i></a>',r+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',r+="</div>",r+="</div>"):(r+='<tr data-idmodel="'+s+'" class="dato">',r+="<td>",r+='<input type="checkbox" class="filled-in" id="chkItemArtIns'+i+'" name="mc_articulo['+i+'][chkItemArtIns]" value="'+s+'" /><label for="filled-in-box"></label>',r+="</td>",r+='<td data-title="Articulo" class="v-align-middle pos-rel">'+t[i].tm_nombre+"</td>",r+='<td data-title="Unidad de medida">'+t[i].UM+"</td>",r+='<td data-title="Saldo inicial">',r+='<div class="mdl-input-js mdl-textfield mdl-js-textfield full-size no-padding"><input disabled class="mdl-textfield__input align-right saldoinicial" type="number" step="any" name="mc_articulo['+i+'][saldoinicial]" id="saldoinicial'+i+'" value="'+t[i].td_stock+'"><label class="mdl-textfield__label" for="saldoinicial'+i+'"></label></div>',r+="</td>",r+='<td data-title="Costo unitario">',r+='<div class="mdl-input-js mdl-textfield mdl-js-textfield full-size no-padding"><input disabled class="mdl-textfield__input align-right costounitario" type="number" step="any" name="mc_articulo['+i+'][costounitario]" id="costounitario'+i+'" value="'+t[i].tm_costo_unitario+'"><label class="mdl-textfield__label" for="costounitario'+i+'"></label></div>',r+="</td>",r+='<td data-title="Costo total">',r+='<div class="mdl-input-js mdl-textfield mdl-js-textfield full-size no-padding"><input readonly class="mdl-textfield__input align-right costotal" type="number" step="any" name="mc_articulo['+i+'][costotal]" id="costotal'+i+'" value="'+t[i].tm_costo_total+'"><label class="mdl-textfield__label" for="costotal'+i+'"></label></div>',r+="</td>",r+="</tr>"),++i}var d;d="#gvDatos"==e?datagrid:gvStockInsumo,d.currentPage(d.currentPage()+1),"1"==o?$(n).html(r):$(n).append(r)}else"1"==o&&$(n).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GoToEditAlmacen(e){var t="#modalRegAlmacen";precargaExp(t,!0),addValidFormAlmacen(),openModalCallBack(t,function(){LimpiarAlmacen(),"0"==e?precargaExp(t,!1):$.ajax({url:"services/almacen/almacen-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"3",id:e},success:function(e){e.length>0&&($("#hdIdAlmacen").val(e[0].tm_idalmacen),$("#txtDireccionAlmacen").val(e[0].tm_direccion),$("#chkDefaultAlmacen")[0].checked="1"==e[0].tm_default,$("#txtNombreAlmacen").val(e[0].tm_nombre).focus(),Materialize.updateTextFields()),precargaExp(t,!1)},error:function(e){console.log(e)}})})}function GuardarAlmacen(){var e=new FormData;if($("#form1").valid()){var t=$("#modalRegAlmacen :input").serializeArray();e.append("btnAplicarAlmacen","btnAplicarAlmacen"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),$.each(t,function(t,a){e.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/almacen/almacen-post.php",cache:!1,dataType:"json",data:e,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(closeCustomModal("#modalRegAlmacen"),ListarAlmacen("1"))},error:function(e){console.log(e)}})}}function EliminarAlmacen(){indexList=0,elemsSelected=$("#gvAlmacen .selected"),EliminarItemAlmacen(elemsSelected[0],"multiple")}function EliminarItemAlmacen(e,t){var a=new FormData,o=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdAlmacen",o),$.ajax({url:"services/almacen/almacen-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var o="",n=$(e),i=!1;"0"==a.rpta?(i=!0,o="No se puede eliminar"):(n.fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemAlmacen(elemsSelected[indexList],t):(i=!0,o=a.titulomsje)):"single"==t&&(i=!0,o=a.titulomsje)),i&&(createSnackbar(o),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"),"undefined"!=typeof endCallback&&endCallback())},error:function(e){console.log(e)}})}function ListarAlmacen(e){var t="#gvAlmacen",a=t+" .list-group";precargaExp("#pnlListado",!0),$.ajax({url:"services/almacen/almacen-search.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:$("#txtSearch").val(),pagina:e},success:function(t){var o=t.length,n=0,i="";if(o>0){for(;n<o;)i+='<div data-idmodel="'+t[n].tm_idalmacen+'" class="list-group-item dato">',i+='<input name="chkItem[]" type="checkbox" class="filled-in" value="'+t[n].tm_idalmacen+'" id="chkItem'+n+'" /><label for="chkItem'+n+'" class="check-filled"></label>',i+='<h4 class="list-group-item-heading">'+t[n].tm_nombre+"</h4>",i+='<p class="list-group-item-text">'+t[n].tm_direccion+"</p>",i+='<div class="grouped-buttons place-bottom-right padding5">',i+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons">&#xE5D4;</i></a>',i+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',i+="</div>",i+="</div>",++n;gvAlmacen.currentPage(gvAlmacen.currentPage()+1),"1"==e?$(a).html(i):$(a).append(i)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function DefaultAlmacen(){$.ajax({url:"services/almacen/almacen-search.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"4"},success:function(e){if(e.length>0){var t=e[0].tm_idalmacen;$("#hdIdAlmacen").val(t),$("#txtSearchAlmacen").val(e[0].tm_nombre),ListarInsumos("#gvStockInsumo","1",t,"1")}},error:function(e){console.log(e)}})}function GuardarStockInicial(){indexList=0,elemsSelected=$("#gvStockInsumo .selected"),GuardarItemStockInicial(elemsSelected[0],"multiple")}function GuardarItemStockInicial(e,t){var a=new FormData,o=e.getAttribute("data-idmodel"),n=e.getElementsByClassName("saldoinicial")[0].value,i=e.getElementsByClassName("costounitario")[0].value,r=e.getElementsByClassName("costotal")[0].value;a.append("btnEditarStock","btnEditarStock"),a.append("hdTipoInsumo","1"==$("#hdTipoInsumo").val()?"00":"01"),a.append("hdIdInsumo",o),a.append("hdIdEmpresa",$("#hdIdEmpresa").val()),a.append("hdIdCentro",$("#hdIdCentro").val()),a.append("hdIdAlmacen",$("#hdIdAlmacen").val()),a.append("txtSaldoInicial",n),a.append("txtCostoUnitario",i),a.append("txtCostoTotal",r),$.ajax({url:"services/insumos/insumos-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(e){var a="",o=!1;"0"==e.rpta?(o=!0,a="No se pudo registrar"):"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?GuardarItemStockInicial(elemsSelected[indexList],t):(o=!0,a=e.titulomsje)):"single"==t&&(o=!0,a=e.titulomsje),o&&(createSnackbar(a),$("#stockinsumo-actionbar").hasClass("is-visible")&&(gvStockInsumo.removeSelection(),gvStockInsumo.showAppBar(!1,"edit")),"0"!=e.rpta&&ListarInsumos("#gvStockInsumo",$("#hdTipoInsumo").val(),$("#hdIdAlmacen").val(),"1"))},error:function(e){console.log(e)}})}function ListarKardex(){precargaExp("#pnlKardex",!0),$.ajax({type:"GET",url:"services/almacen/kardex-search.php",cache:!1,dataType:"json",data:{tipobusqueda:1,tipoexistencia:$("#ddlTipoExistencia").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idalmacen:$("#hdIdAlmacen").val(),idarticulo:$("#hdIdArticulo").val()},success:function(e){var t=e.length,a=0,o="";if(t>0)for(;a<t;)o+="<tr>",o+='<td class="text-center">'+e[a].tm_fechadoc+"</td>",o+="<td>"+e[a].TipoComprobante+"</td>",o+='<td class="text-center">'+e[a].tm_seriedoc+"</td>",o+='<td class="text-center">'+e[a].tm_numerodoc+"</td>",o+="<td>"+e[a].TipoOperacion+"</td>",o+='<td class="text-right">'+e[a].cantidad_entrada+"</td>",o+='<td class="text-right">'+e[a].costounitario_entrada+"</td>",o+='<td class="text-right">'+e[a].costototal_entrada+"</td>",o+='<td class="text-right">'+e[a].cantidad_salida,NaN,o+='<td class="text-right">'+e[a].costounitario_salida,NaN,o+='<td class="text-right">'+e[a].costotal_salida,NaN,o+='<td class="text-right">'+e[a].cantidad_saldo+"</td>",o+='<td class="text-right">'+e[a].costounitario_saldo+"</td>",o+='<td class="text-right">'+e[a].costototal_saldo+"</td>",o+="</tr>",++a;$("#gvKardex tbody").html(o),precargaExp("#pnlKardex",!1)},error:function(e){console.log(error)}})}function CerrarKardex(){var e=new FormData;e.append("btnCerrarKardex","btnCerrarKardex"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("ddlTipoExistencia",$("#ddlTipoExistencia").val()),e.append("ddlAnho",$("#ddlAnho").val()),e.append("ddlMes",$("#ddlMes").val()),e.append("hdIdArticulo",$("#hdIdArticulo").val()),$.ajax({url:"services/almacen/kardex-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){var t=e.length,a="",o=0;if(t>0)for(;o<t;)a+="<tr>",a+="<td>"+e[o].fecha+"</td>",a+="<td>"+e[o].tipo_documento+"</td>",a+="<td>"+e[o].serie+"</td>",a+="<td>"+e[o].numero+"</td>",a+="<td>"+e[o].tipo_operacion+"</td>",a+="<td>"+e[o].cantidad_entrada+"</td>",a+="<td>"+e[o].costo_unitario_entrada+"</td>",a+="<td>"+e[o].costo_total_entrada+"</td>",a+="<td>"+e[o].cantidad_salida+"</td>",a+="<td>"+e[o].costo_unitario_salida+"</td>",a+="<td>"+e[o].costo_total_salida+"</td>",a+="<td>"+Number(e[o].cantidad_saldo).toFixed(2)+"</td>",a+="<td>"+Number(e[o].costo_unitario_saldo).toFixed(2)+"</td>",a+="<td>"+Number(e[o].costo_total_saldo).toFixed(2)+"</td>",a+="</tr>",++o;$("#gvKardex tbody").html(a)},error:function(e){console.log(e)}})}function LimpiarChangeCost(){$("#hdIdInsumo").val("0"),$("#txtCostoReceta").val("0.00")}function CambiarCostoInsumo(){var e=new FormData;e.append("btnCambiarCostoInsumo","btnCambiarCostoInsumo"),e.append("hdIdInsumo",$("#hdIdInsumo").val()),e.append("txtCostoReceta",$("#txtCostoReceta").val()),$.ajax({url:"services/insumos/insumos-post.php",type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(LimpiarChangeCost(),closeCustomModal("#modalChangeCost"))},error:function(e){console.log(e)}})}function ActualizarStockMinMax(){var e=new FormData,t=$("#gvDatos :input").serializeArray();e.append("btnCambiarStockMinMax","btnCambiarStockMinMax"),e.append("txtStockMin_Masivo",$("#txtStockMin_Masivo").val()),e.append("txtStockMax_Masivo",$("#txtStockMax_Masivo").val()),$.each(t,function(t,a){e.append(a.name,a.value)}),$.ajax({url:"services/insumos/insumos-post.php",type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&($("#txtStockMax_Masivo").val("0.00"),$("#txtStockMin_Masivo").val("0.00"),datagrid.removeSelection(),closeCustomModal("#modalChangeStockMinMax"))},error:function(e){console.log(e)}})}function ListarCategorias_Combo(e){$.ajax({type:"GET",url:"services/categorias/categoriainsumo-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(t){var a="",o=0,n=t.length;if(n>0)for(;o<n;){var i=e==t[o].tm_idcategoria_insumo?" selected":"";a+="<option"+i+' value="'+t[o].tm_idcategoria_insumo+'">'+t[o].tm_nombre+"</option>",++o}else a='<option value="0">No existen categor&iacute;as registradas.</option>';$("#ddlCategoriaReg").html(a)},error:function(e){console.log(e)}})}function ListarUnidadMedida_Combo(e,t){$.ajax({type:"GET",url:"services/unidadmedida/unidadmedida-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(a){var o="",n=0,i=a.length;if(i>0)for(;n<i;){var r=t==a[n].tm_idunidadmedida?" selected":"";o+="<option"+r+' data-simbolo="'+a[n].tm_abreviatura+'" value="'+a[n].tm_idunidadmedida+'">'+a[n].tm_nombre+"</option>",++n}else o='<option value="0">No hay unidades de medida registradas.</option>';$(e).html(o)},error:function(e){console.log(e)}})}function ListarPresentacion_Combo(e){$.ajax({type:"GET",url:"services/presentacion/presentacion-search.php",cache:!1,dataType:"json",data:{tipo:"L",tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(t){var a="",o=0,n=t.length;if(n>0)for(;o<n;){var i=e==t[o].tm_idpresentacion?" selected":"";a+="<option"+i+' value="'+t[o].tm_idpresentacion+'">'+t[o].tm_nombre+"</option>",++o}else a='<option value="0">No hay categor&iacute;as de insumo.</option>';$("#ddlPresentacion").html(a)},error:function(e){console.log(e)}})}function clearValidationsRules(e){"#modalRegCategoria"==e?removeValidFormCategoria():"#modalRegAlmacen"==e&&removeValidFormAlmacen()}function Buscar(){$("#gvCategoria").is(":visible")?ListarCategorias("1"):$("#gvAlmacen").is(":visible")?ListarAlmacen("1"):ListarInsumos("#gvDatos","1","0","1")}function showAll(){$("#txtSearch").val(""),$("#gvStockInsumo").is(":visible")?ListarInsumos("#gvStockInsumo",$("#hdTipoInsumo").val(),$("#hdIdAlmacen").val(),"1"):Buscar()}function getDataByReference(e){showAll()}function callBack__selectAll(){$("#gvCategoria").is(":visible")?$('#generic-actionbar a[data-action="change-stockminmax"]').addClass("hide"):$("#gvAlmacen").is(":visible")?$('#generic-actionbar a[data-action="change-stockminmax"]').addClass("hide"):$("#gvDatos").is(":visible")&&$('#generic-actionbar a[data-action="change-stockminmax"]').removeClass("hide")}$(function(){DefaultAlmacen(),$("#txtMedida, #txtCostoPromedio, #txtCostoReceta, #txtStockMinimo, #txtStockMaximo, #txtStockMax_Masivo, #txtStockMin_Masivo").on("focus",function(e){e.preventDefault(),this.select()}),$("#btnCambiarStockMinMax").on("click",function(e){e.preventDefault(),MessageBox({content:"¿Desea actualizar stock mínimo y máximo de todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Actualizar",onClickButton:function(e){ActualizarStockMinMax()}}],cancelButton:!0})}),$("#txtSearchStock").on("keyup",function(e){ListarInsumos("#gvStockInsumo",$("#hdTipoInsumo").val(),$("#hdIdAlmacen").val(),"1")}),$("#btnSearchStock").on("click",function(e){e.preventDefault(),gvStockInsumo.showAppBar(!0,"search"),$("#txtSearchStock").focus()}),$("#btnSearch").on("click",function(e){e.preventDefault();var t;t=$("#gvCategoria").is(":visible")?gvCategoria:$("#gvAlmacen").is(":visible")?gvAlmacen:datagrid,t.showAppBar(!0,"search"),$("#txtSearch").focus()}),$("#btnCerrarKardex").on("click",function(e){e.preventDefault(),CerrarKardex()}),$("#btnCambiarCostoInsumo").on("click",function(e){e.preventDefault(),CambiarCostoInsumo()}),$("#btnRecursosBack").on("click",function(e){e.preventDefault(),$("#btnUnSelectAll").trigger("click")}),$("#gvStockInsumo tbody").on("scroll",function(e){gvStockInsumo.listenerScroll(this,e)}),$("#pnlListado .mdl-layout__content").on("scroll",function(e){var t;t=$("#gvCategoria").is(":visible")?gvCategoria:$("#gvAlmacen").is(":visible")?gvAlmacen:datagrid,t.listenerScroll(this,e)}),$("#gvStockInsumo tbody").on("click","input:checkbox",function(e){handlerRowCheck(this,"#gvStockInsumo",e)}),$("#gvStockInsumo tbody").on("click","tr",function(e){handlerRowCheck(this,"#gvStockInsumo",e)}),$("#gvStockInsumo tbody").on("click","tr .mdl-textfield__input",function(e){e.stopPropagation()}),$("#gvStockInsumo tbody").on("keyup","tr .mdl-textfield__input",function(e){var t=this;if(!t.classList.contains("costotal")){var a=0,o=0,n=getParentsUntil(t,"#gvStockInsumo","tr"),i=n[0].getElementsByClassName("costotal")[0];t.classList.contains("saldoinicial")?(a=t.value,o=Number(n[0].getElementsByClassName("costounitario")[0].value)):(a=Number(n[0].getElementsByClassName("saldoinicial")[0].value),o=t.value);var r=a*o;i.value=r.toFixed(2)}}),$("#btnTipoInsumo").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled")||$("#mnuTipoInsumo").addClass("is-visible")}),$("#mnuTipoInsumo").on("click","a",function(e){e.preventDefault();var t=this.getAttribute("href"),a=this.innerText;$("#mnuTipoInsumo").removeClass("is-visible");var o=document.querySelector("#pnlStock .mdl-layout-title span.text");o.innerText=a;var n="#gvStockInsumo"==t?"1":"2";$("#hdTipoInsumo").val(n),ListarInsumos("#gvStockInsumo",n,$("#hdIdAlmacen").val(),"1")}),$("#btnUnSelectAll").on("click",function(e){e.preventDefault(),$("#pnlListado").is(":visible")?$("#gvCategoria").is(":visible")?gvCategoria.removeSelection(function(){$("#gvCategoria .dato .title").removeClass("hide"),$("#gvCategoria .dato .mdl-textfield").addClass("hide")}):$("#gvAlmacen").is(":visible")?gvAlmacen.removeSelection():datagrid.removeSelection():gvStockInsumo.removeSelection()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#txtSearchAlmacen").easyAutocomplete({url:function(e){var t="services/almacen/almacen-search.php";return t+="?idempresa="+$("#hdIdEmpresa").val(),t+="&idcentro="+$("#hdIdCentro").val(),t+="&criterio="+e},getValue:function(e){return e.tm_nombre},list:{onSelectItemEvent:function(){var e=$("#txtSearchAlmacen").getSelectedItemData().tm_idalmacen;$("#hdIdAlmacen").val(e).trigger("change"),ListarInsumos("#gvStockInsumo",$("#hdTipoInsumo").val(),e,"1")}},template:{type:"custom",method:function(e,t){return t.tm_nombre}},theme:"square"}),$("#txtSearchInsumoKardex").easyAutocomplete({url:function(e){var t="services/insumos/insumos-search.php";return t+="?tipobusqueda=EXISTENCIAS",t+="&idempresa="+$("#hdIdEmpresa").val(),t+="&idcentro="+$("#hdIdCentro").val(),t+="&tipoproducto="+$("#ddlTipoExistencia").val(),t+="&criterio="+e},getValue:function(e){return e.tm_nombre},list:{onSelectItemEvent:function(){var e=$("#txtSearchInsumoKardex").getSelectedItemData().idarticulo;$("#hdIdArticulo").val(e).trigger("change")}},template:{type:"custom",method:function(e,t){return t.tm_nombre}},theme:"square"}),$("#btnStockInsumo").on("click touchend",function(e){e.preventDefault(),GuardarStockInicial()}),$("#btnBackToList").on("click",function(e){e.preventDefault(),BackToList()}),$("#btnNuevo").on("click",function(e){e.preventDefault(),Nuevo()}),$("#btnGuardarInsumo").on("click",function(e){e.preventDefault(),GuardarInsumo()}),$(".actionbar").on("click touchend","button",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t?MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){$("#gvCategoria").is(":visible")?EliminarCategoria():$("#gvAlmacen").is(":visible")?EliminarAlmacen():$("#gvDatos").is(":visible")&&EliminarInsumo()}}],cancelButton:!0}):"change-stockminmax"==t&&openModalCallBack("#modalChangeStockMinMax",function(){$("#txtStockMin_Masivo").val("0.000"),$("#txtStockMax_Masivo").val("0.000")})}),$("#btnAgregarPresentacion").on("click",function(e){e.preventDefault(),$("#btnPresentacionAdd").html("Agregar a detalle").removeClass("mode-edit").addClass("mode-add"),openModalCallBack("#pnlInfoPresentacion",function(){var e=$("#ddlUnidadMedidaReg option:selected").text();$('label[for="txtMedida"]').text("Equivalencia en: "+e),ListarPresentacion_Combo("0")})}),$("#btnPresentacionAdd").on("click",function(e){e.preventDefault(),AddDetalle()}),$("#gvAlmacen").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvAlmacen",".dato"),o=a[0].getAttribute("data-idmodel");"edit"==t?GoToEditAlmacen(o):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemAlmacen(a[0],"single")}}],cancelButton:!0})}),$("#gvCategoria").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvCategoria",".dato"),o=a[0].getAttribute("data-idmodel");"edit"==t?GoToEditCategoria(o):"delete"==t&&MessageBox({
content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemCategoria(a[0],"single")}}],cancelButton:!0})}),$("#btnAplicarCategoria").on("click",function(e){e.preventDefault(),GuardarCategoria()}),$("#btnAplicarAlmacen").on("click",function(e){e.preventDefault(),GuardarAlmacen()}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),o=a[0].getAttribute("data-idmodel");datagrid.removeSelection(),"edit"==t?GoToEditInsumo(o):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemInsumo(a[0],"single")}}],cancelButton:!0})}),$("#tablePresentacion tbody").on("click","a",function(e){e.preventDefault();var t=this.getAttribute("data-action");if("delete"==t){var a=getParentsUntil(this,"#tablePresentacion","tr");$(a).fadeOut(400,function(){$(this).remove()})}})});var indexList=0,elemsSelected,progress=0,progressError=!1,selectorSelection="#pnlListado .mdl-layout__content section:visible",messagesValid={txtNombreCategoria:{remote:"Este nombre de categoría ya existe"},txtNombreAlmacen:{remote:"Este nombre de almacen ya existe"}},handlerRowCheck=function(e,t,a){if("textbox"!==(a.target||{}).type){var o,n,i,r=e,s=!0;if("checkbox"!==(e||{}).type?(a.preventDefault(),o=e,r=e.querySelector('input[type="checkbox"]'),null!=r&&(r.checked=!r.checked)):o=getParentsUntil(r,t,".dato"),"#gvStockInsumo"==t){var d=o.getElementsByClassName("saldoinicial")[0],c=o.getElementsByClassName("costounitario")[0];n=gvStockInsumo,i=[d,c],null!=r&&(habilitarControl(i,r.checked),r.checked?(o.classList.add("selected"),s=!0,d.parentNode.classList.remove("is-disabled"),c.parentNode.classList.remove("is-disabled"),d.focus(),d.select()):(o.classList.remove("selected"),d.parentNode.classList.add("is-disabled"),c.parentNode.classList.add("is-disabled"),0==$(t).find(".selected").length&&(s=!1))),n.showAppBar(s,"edit")}}},gvCategoria=new DataList("#gvCategoria",{typeview:"checklist",onSearch:function(){ListarCategorias(gvCategoria.currentPage())}}),gvAlmacen=new DataList("#gvAlmacen",{typeview:"checklist",onSearch:function(){ListarAlmacen(gvAlmacen.currentPage())}}),datagrid=new DataList("#gvDatos",{onSearch:function(){ListarInsumos("#gvDatos","1","0",datagrid.currentPage())}}),gvStockInsumo=new DataList("#gvStockInsumo",{actionbar:"#stockinsumo-actionbar",onSearch:function(){ListarInsumos("#gvStockInsumo",$("#hdTipoInsumo").val(),$("#hdIdAlmacen").val(),gvStockInsumo.currentPage())}}),counter_presentacion=0;