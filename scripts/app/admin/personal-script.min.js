function ListarCargos(a){$.ajax({type:"GET",url:"services/cargos/cargos-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(e){var t="",o=0,r=e.length;if(r>0)for(;o<r;){var n=a==e[o].tp_idcargo?" selected":"";t+="<option"+n+' value="'+e[o].tp_idcargo+'">'+e[o].tp_nombre+"</option>",++o}else t='<option value="0">No hay cargos administrativos registrados.</option>';$("#ddlCargoReg").html(t)},error:function(a){console.log(a)}})}function ListarAreasTrabajo(a){$.ajax({type:"GET",url:"services/areas/areas-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(e){var t="",o=0,r=e.length;if(r>0)for(;o<r;){var n=a==e[o].tp_idarea?" selected":"";t+="<option"+n+' value="'+e[o].tp_idarea+'">'+e[o].tp_nombre+"</option>",++o}else t='<option value="0">No hay &aacute;reas de trabajo registradas.</option>';$("#ddlAreaReg").html(t)},error:function(a){console.log(a)}})}function LimpiarForm(){$("#txtCodigo").val(""),$("#txtApePaterno").val(""),$("#txtApeMaterno").val(""),$("#txtNombres").val(""),$("#txtEmail").val(""),$("#txtTelefono").val(""),$("#ddlTurnoReg")[0].selectedIndex=0,$("#txtNroDNI").val("").focus()}function GoToEdit(a){var e="#pnlForm";document.getElementById("hdIdPrimary").value="0",document.getElementById("hdFoto").value="no-set",precargaExp(e,!0),resetFoto("new"),LimpiarForm(),openModalCallBack(e,function(){"0"==a?(precargaExp(e,!1),ListarCargos("0"),ListarAreasTrabajo("0"),$("#txtCodigo").focus()):$.ajax({type:"GET",url:"services/organigrama/organigrama-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",idpersonal:a},success:function(a){if(a.length>0){var t=a[0].tm_foto,o=t.replace("_o","_s255");$("#hdIdPrimary").val(a[0].tm_idpersonal),$("#txtNroDNI").val(a[0].tm_nrodni),$("#txtApePaterno").val(a[0].tm_apellidopaterno),$("#txtApeMaterno").val(a[0].tm_apellidomaterno),$("#txtNombres").val(a[0].tm_nombres),$("#txtEmail").val(a[0].tm_email),ListarCargos(a[0].tp_idcargo),ListarAreasTrabajo(a[0].tp_idarea),$("#ddlTurnoReg").changeMaterialSelect(a[0].ta_turno),"no-set"!=t?setFoto(o):o="images/user-nosetimg-233.jpg",imgFoto.setAttribute("data-src",o),hdFoto.value=t,$("#txtCodigo").val(a[0].tm_codigo).focus(),Materialize.updateTextFields()}precargaExp(e,!1)}})})}function BuscarDatos(a){var e="#gvDatos",t=e+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/organigrama/organigrama-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:$("#txtSearch").val(),pagina:a},success:function(o){var r=o.length,n=0,i="";if(r>0){for(;n<r;){var s=o[n].tm_idpersonal,l=o[n].tm_foto.replace("_o","_s42");i+='<li class="collection-item avatar no-border dato" data-idmodel="'+s+'"  data-baselement="'+e+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+s+'" />',i+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',i+="no-set"==l?'<i class="material-icons circle">&#xE853;</i>':'<img src="'+l+'" alt="" class="circle">',i+='<span class="title descripcion">'+o[n].tm_apellidopaterno+" "+o[n].tm_apellidomaterno+" "+o[n].tm_nombres+"</span>",i+='<p><span class="docidentidad">RUC: '+o[n].tm_nrodni+"</span> -  "+o[n].tm_email+"</p>",i+='<div class="grouped-buttons place-top-right padding5">',i+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',i+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',i+="</div>",i+='<div class="divider"></div>',i+="</li>",++n}datagrid.currentPage(datagrid.currentPage()+1),"1"==a?$(t).html(i):$(t).append(i)}else"1"==a&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)}})}function GuardarDatos(){var a=document.getElementById("hdFoto"),e=fileValue,t=new FormData;precargaExp("#pnlForm",!0),"images/user-nosetimg-233.jpg"==a.value&&(a.value="no-set"),t.append("btnGuardar","btnGuardar"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),t.append("archivo",e);var o=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(o,function(a){t.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/personal/personal-post.php",contentType:!1,processData:!1,cache:!1,data:t,dataType:"json",success:function(a){precargaExp("#pnlForm",!1),createSnackbar(a.titulomsje),"0"!=a.rpta&&(closeCustomModal("#pnlForm"),BuscarDatos("1"))}})}function EliminarPersonal(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemPersonal(elemsSelected[0],"multiple")}function EliminarItemPersonal(a,e){var t=new FormData,o=a.getAttribute("data-idmodel");t.append("btnEliminar","btnEliminar"),t.append("hdIdPersonal",o),$.ajax({url:"services/personal/personal-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){var o="",r=$(a),n=!1;"0"==t.rpta?(n=!0,o="No se puede eliminar"):(r.fadeOut(400,function(){$(this).remove()}),"multiple"==e?(++indexList,indexList<=elemsSelected.length-1?EliminarItemPersonal(elemsSelected[indexList],e):(n=!0,o=t.titulomsje)):"single"==e&&(n=!0,o=t.titulomsje)),n&&(createSnackbar(o),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"),"undefined"!=typeof endCallback&&endCallback())},error:function(a){console.log(a)}})}function Buscar(){BuscarDatos("1")}function showAll(){Buscar()}$(function(){BuscarDatos("1"),$("#btnSearch").on("click",function(a){a.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#generic-actionbar").on("click touchend","button",function(a){a.preventDefault();var e=this.getAttribute("data-action");"delete"==e&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(a){EliminarPersonal()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(a){a.preventDefault();var e=this.getAttribute("data-action"),t=getParentsUntil(this,"#gvDatos",".dato"),o=t[0].getAttribute("data-idmodel");"edit"==e?GoToEdit(o):"delete"==e&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(a){EliminarItemPersonal(t[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(a){a.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(a){a.preventDefault(),$("#chkCrearUsuario")[0].checked||GuardarDatos()})});var indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}});