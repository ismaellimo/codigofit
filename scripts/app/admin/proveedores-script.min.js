function LimpiarForm(){$("#txtCodigo").val(""),$("#txtNroDNI").val(""),$("#txtApePaterno").val(""),$("#txtApeMaterno").val(""),$("#txtNombres").val(""),$("#txtEmail").val(""),$("#txtTelefono").val("")}function GoToEdit(e){var t="#pnlForm";document.getElementById("hdIdPrimary").value="0",document.getElementById("hdFoto").value="no-set",precargaExp(t,!0),resetFoto("new"),LimpiarForm(),openModalCallBack(t,function(){"0"==e?precargaExp(t,!1):$.ajax({type:"GET",url:"services/proveedores/proveedor-getdetails.php",cache:!1,dataType:"json",data:"id="+e,success:function(e){if(e.length>0){var a=e[0].tm_foto,o=a.replace("_o","_s255");$("#hdIdPrimary").val(e[0].tm_idproveedor),$("#txtNombreProveedor").val(e[0].tm_nombreproveedor),$("#txtNombreContacto").val(e[0].tm_nombrecontacto),$("#txtCargoContacto").val(e[0].tm_cargocontacto),$("#txtDireccion").val(e[0].tm_direccion),$("#txtTelefono").val(e[0].tm_telefono),$("#txtCelular").val(e[0].tm_celular),$("#txtEmail").val(e[0].tm_email),$("#txtFax").val(e[0].tm_fax),"no-set"!=a?setFoto(o):o="images/user-nosetimg-233.jpg",imgFoto.setAttribute("data-src",o),hdFoto.value=a,$("#txtRucProveedor").val(e[0].tm_numerodoc).focus(),Materialize.updateTextFields()}precargaExp(t,!1)},error:function(e){console.log(e)}})})}function BuscarDatos(e){var t="#gvDatos",a=t+" .gridview-content";precargaExp("#pnlListado",!0),$.ajax({type:"GET",url:"services/proveedores/proveedores-search.php",cache:!1,dataType:"json",data:{criterio:$("#txtSearch").val(),idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),pagina:e},success:function(o){var r=o.length,n=0,i="";if(r>0){for(;n<r;){var c=o[n].tm_idproveedor,l=o[n].tm_foto.replace("_o","_s42");i+='<li class="collection-item avatar no-border dato" data-idmodel="'+c+'"  data-baselement="'+t+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',i+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',i+="no-set"==l?'<i class="material-icons circle">&#xE853;</i>':'<img src="'+l+'" alt="" class="circle">',i+='<span class="title descripcion">'+o[n].tm_nombreproveedor+"</span>",i+="<p>Tel&eacute;fono: "+o[n].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+o[n].tm_direccion+"</span><br>",i+='<span class="docidentidad">RUC: '+o[n].tm_numerodoc+"</span> - "+o[n].tm_email+"</p>",i+='<div class="grouped-buttons place-top-right padding5">',i+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons md-18">&#xE5D4;</i></a>',i+='<ul class="dropdown"><li><a href="#" data-action="edit" class="waves-effect">Editar</a></li><li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li></ul>',i+="</div>",i+='<div class="divider"></div>',i+="</li>",++n}datagrid.currentPage(datagrid.currentPage()+1),"1"==e?$(a).html(i):$(a).append(i)}else"1"==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListado",!1)},error:function(e){console.log(e)}})}function GuardarDatos(){var e=document.getElementById("hdFoto"),t=fileValue,a=new FormData;precargaExp("#pnlForm",!0),"images/user-nosetimg-233.jpg"==e.value&&(e.value="no-set"),a.append("btnGuardar","btnGuardar"),a.append("hdIdEmpresa",$("#hdIdEmpresa").val()),a.append("hdIdCentro",$("#hdIdCentro").val()),a.append("archivo",t);var o=$("#pnlForm :input").serializeArray();Array.prototype.forEach.call(o,function(e){a.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/proveedores/proveedores-post.php",contentType:!1,processData:!1,cache:!1,data:a,dataType:"json",success:function(e){precargaExp("#pnlForm",!1),createSnackbar(e.titulomsje),Number(e.rpta)>0&&(closeCustomModal("#pnlForm"),paginaGeneral=1,BuscarDatos("1"))},error:function(e){console.log(e)}})}function EliminarProveedor(){indexList=0,elemsSelected=$("#gvDatos .selected"),EliminarItemProveedor(elemsSelected[0],"multiple")}function EliminarItemProveedor(e,t){var a=new FormData,o=e.getAttribute("data-idmodel");a.append("btnEliminar","btnEliminar"),a.append("hdIdProveedor",o),$.ajax({url:"services/proveedores/proveedores-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var o="",r=!1;"0"==a.rpta?(r=!0,o="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove()}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemProveedor(elemsSelected[indexList],t):(r=!0,o=a.titulomsje)):"single"==t&&(r=!0,o=a.titulomsje)),r&&(createSnackbar(o),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}function Buscar(){BuscarDatos("1")}$(function(){BuscarDatos("1"),$("#btnSearch").on("click",function(e){e.preventDefault(),datagrid.showAppBar(!0,"search"),$("#txtSearch").focus()}),$(".back-button").on("click",function(){$("#btnUnSelectAll").trigger("click")}),$("#generic-actionbar").on("click touchend","button",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t&&MessageBox({content:"¿Desea eliminar todo lo seleccionado?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarProveedor()}}],cancelButton:!0})}),$("#gvDatos").on("click touchend",".dropdown a",function(e){e.preventDefault();var t=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato"),o=a[0].getAttribute("data-idmodel");"edit"==t?GoToEdit(o):"delete"==t&&MessageBox({content:"¿Desea eliminar este elemento?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemProveedor(a[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GoToEdit("0")}),$("#btnGuardar").on("click",function(e){e.preventDefault(),GuardarDatos()})});var indexList=0,elemsSelected,progress=0,progressError=!1,datagrid=new DataList("#gvDatos",{onSearch:function(){BuscarDatos(datagrid.currentPage())}});