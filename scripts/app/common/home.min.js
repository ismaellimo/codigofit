function rgb2hex(e){return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+hex(e[1])+hex(e[2])+hex(e[3])}function hex(e){var t=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return isNaN(e)?"00":t[(e-e%16)/16]+t[e%16]}function precargaModulo(e,t){var i=$("head"),a=i.find('meta[name="theme-color"]');if(a.remove(),t){var n=e.getElementsByClassName("material-icons")[0].outerHTML,l=$(e).find(".tile-label").text(),o=getStyle(e,"background-color");i.append('<meta name="theme-color" content="'+rgb2hex(o)+'">'),$(".list-sites").append('<div class="preload" style="background-color: '+o+'"><div class="preload-wrapper">'+n+'<h2 class="title-preload white-text place-bottom align-center padding20">'+l+"</h2></div>")}else{i.append('<meta name="theme-color" content="#3F51B5">');var c=$(".list-sites").find(".preload");c.remove()}}function closeActiveWin(e){var t=e.parentNode,i=$(".list-sites").find('.panelWin[data-url="'+t.getAttribute("data-url")+'"]');i.remove(),$(t).remove();var a=$(".panelWin");a.is(":visible")&&($(".list-sites").fadeOut(300),hideFrame())}function showDesktop(){$(".list-sites").fadeOut(300),hideFrame(),hideAllSlidePanels()}function hideAllSlidePanels(){showOrHideCharmOptions("#charmOptions",!1)}function hideFrame(){var e=$(".list-activewin").find(".activewin.active"),t=$(".panelWin");e.removeClass("active"),t.is(":visible")&&(t.removeClass("active"),t.hide()),$("#menuModulo").html("")}function navigateInFrame(e,t,i){var a="",n=t.getAttribute("data-url"),l=t.getAttribute("data-id");if("00"==e)a="pnl"+l;else{var o=$(".list-sites").find('.panelWin[data-url="'+n+'"]');a=o.attr("id")}hideFrame(),$(".list-sites").css({display:"block",opacity:1,visibility:"visible"});var c=document.getElementById(a);if(null===c){var r="ifr"+n;precargaModulo(t,!0);var s=document.createElement("div");s.setAttribute("id",a),s.setAttribute("data-url",n),s.setAttribute("data-id",l);var d=document.createElement("iframe");d.setAttribute("id",r),d.setAttribute("scrolling","no"),d.setAttribute("marginwidth","0"),d.setAttribute("marginheight","0"),d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.setAttribute("frameborder","no"),d.setAttribute("src",n),d.addEventListener("load",function(e){var a=this.document||this.contentWindow;precargaModulo(t,!1),createThumbWin(t,this),"undefined"!=typeof a.ListarOpcionesDropdown&&a.ListarOpcionesDropdown(l),"undefined"!=typeof i&&i(a)}),s.appendChild(d),$(".list-sites").append(s),s.classList.add("panelWin","active")}else{c.classList.add("active"),c.style.display="block";var d=c.getElementsByTagName("iframe")[0],m=d.document||d.contentWindow;m.ListarOpcionesDropdown(l),"undefined"!=typeof i&&i(m)}ListarOpcionesCharm(l)}function createThumbWin(e,t){var i="",a="thumb"+e.getAttribute("id"),n=e.getAttribute("data-id"),l=document.getElementById(a);if(null==l){var o=$(e).find(".tile-label").text(),c=e.getAttribute("data-url");l=document.createElement("div"),l.setAttribute("id",a),l.setAttribute("data-id",n),l.setAttribute("title",o),l.setAttribute("data-url",c),l.classList.add("activewin","demo-card-image","mdl-card","mdl-shadow--2dp","mdl-cell","mdl-cell--4-col","mdl-cell--4-col-tablet","mdl-cell--12-col-phone","active"),i='<a href="#" class="close bg-opacity-8 circle place-top-right margin5 padding5"><i class="material-icons">close</i></a>',i+='<div class="mdl-card__title mdl-card--expand"></div>',i+='<div class="mdl-card__actions bg-opacity-8"><span class="demo-card-image__filename">'+o+"</span></div>",l.innerHTML=i;var r=$(".list-activewin").find(".view");r.append(l);var s=t.contentDocument.body;html2canvas(s,{onrendered:function(e){l.style.backgroundImage="url("+e.toDataURL()+")"},allowTaint:!0,taintTest:!1,logging:!0,width:600,height:350})}else l.classList.add("active")}function navigateInPage(e){var t=$(".list-sites").find(".panelWin.active"),i=t.find("iframe")[0],a=i.contentDocument.body;$(".page",a).addClass("hide"),$(e,a).removeClass("hide");var n=$("#menuModulo").find(".active");n.removeClass("active");var l=$("#menuModulo").find('a[href="'+e+'"]');l.addClass("active");var o=i.document||i.contentWindow;"undefined"!=typeof o.getDataByReference&&o.getDataByReference(e)}function ListarOcionesMenu(){$.ajax({type:"GET",url:"services/menu/menu-group-search.php",cache:!1,dataType:"json",data:{tipobusqueda:1,idperfil:$("#spnIdPerfil").text()},success:function(e){var t=0,i="",a=0,n=_.groupBy(e,function(e){return e.tp_idgroupoption+"#"+e.tp_nombre}),l=_.map(n,function(e){return{tp_idgroupoption:e[0].tp_idgroupoption,tp_nombre:e[0].tp_nombre,list_secciones:e}}),o=l.length;if(o>0)for(;t<o;){var c=0,r=l[t].list_secciones;if(a=1==r.length?0==r[0].tm_titulo.trim().length?0:1:r.length,a>0){for(i+='<div class="mdl-cell mdl-cell--6-col">',i+='<div class="page-header no-margin"><h3>'+l[t].tp_nombre+"</h3></div>",i+='<div class="mdl-grid">';c<a;)"undefined"!=typeof r[c]&&(i+='<div id="tile'+r[c].tm_idmenu+'" data-id="'+r[c].tm_idmenu+'" class="mdl-card pos-rel mdl-shadow--2dp mdl-cell mdl-cell--4-col mdl-cell--4-col-tablet mdl-cell--2-col-phone opcion '+r[c].tm_iconbgcolor+' white-text" data-url="'+r[c].tm_uri+'" data-role="tile">',i+='<i class="material-icons centered">'+r[c].tm_iconuri+"</i>",i+='<h5 class="tile-label place-bottom-left padding5 margin5">'+r[c].tm_titulo+"</h5>",i+="</div>"),++c;i+="</div></div>"}++t}$("#AppMain").html(i)},error:function(e){console.log(e)}})}function ListarOpcionesCharm(e){$.ajax({url:"services/menu/menu-search.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"HOME",idperfil:$("#spnIdPerfil").text(),idreferencia:e,tipomenu:"03"},success:function(e){var t=0,i="",a=e.length;if(a>0)for(;t<a;)i+='<li><a class="'+e[t].tm_iconbgcolor+'" href="'+e[t].tm_uri+'" data-id="'+e[t].tm_idmenu+'"><i class="material-icons icon">'+e[t].tm_iconuri+'</i><span class="text">'+e[t].tm_titulo+"</span></a></li>",++t;$("#menuModulo").html(i)},error:function(e){console.error(e)}})}function ListarCentros(){$.ajax({type:"GET",url:"services/centro/centro-empresa.php",cache:!1,dataType:"json",success:function(e){var t="",i=e.length,a=0;if(i>0)for(;a<i;)t+='<div id="tile'+e[a].tm_idcentro+'" data-id="'+e[a].tm_idcentro+'" class="mdl-card pos-rel mdl-shadow--2dp mdl-cell mdl-cell--4-col mdl-cell--4-col-tablet mdl-cell--2-col-phone demo-card-order red" style="height: 180px;" data-role="tile">',t+='<div style="display: table; height: 100%;" class="full-size">',t+='<div style="display: table-cell; vertical-align: middle;">',t+='<h3 class="white-text align-center">'+e[a].tm_nombre+"</h3>",t+="</div>",t+="</div>",t+='<div class="mark-selected pos-abs indigo accent-4 white-text circle"><i class="material-icons centered">&#xE5CA;</i></div>',t+="</div>",++a;$("#gvCentros").html(t)},error:function(e){console.log(e)}})}$(function(){var e=getParameterByName("screenmode");"cliente"!=e&&(ListarOcionesMenu(),$("#AppMain").on("click",".opcion",function(e){e.preventDefault(),navigateInFrame("00",this)}),$("#gvCentros").on("click",".mdl-card",function(e){e.preventDefault(),$(this).siblings(".mdl-card").removeClass("oneSelected"),$(this).addClass("oneSelected"),$("#hdIdCentro").val(this.getAttribute("data-id"))}),$("#btnOpciones").on("click",function(e){e.preventDefault(),WebNotifications.askForPermission()}),$(".list-activewin").on("click",".activewin:not(.close)",function(e){e.preventDefault(),navigateInFrame("01",this),$(this).addClass("active"),$(".close-modal-example,.close-dialog").trigger("click")}),$("body").on("click",".modal-example-overlay",function(e){e.preventDefault(),$(".close-modal-example,.close-dialog").trigger("click")}),$(".list-activewin").on("click",".activewin > a.close",function(e){e.preventDefault(),e.stopPropagation(),closeActiveWin(this)}),$("#lnkShowDesktop").on("click",function(e){e.preventDefault(),showDesktop(),$(".close-modal-example,.close-dialog").trigger("click")}),$("#menuModulo").on("click","a",function(e){e.preventDefault();var t=this.getAttribute("href");navigateInPage(t),showOrHideCharmOptions("#charmOptions",!1)})),$("#control-app").on("click",function(e){e.preventDefault(),showOrHideCharmOptions("#charmOptions",!0)}),$("#menuBottomSettings").on("click","a",function(e){e.preventDefault();var t=this,i=t.getAttribute("data-action");hideAllSlidePanels(),"recents"==i?openCustomModal("#modalRecents"):"settings"==i?$('.mdl-card[data-id="'+config.configuracion.id+'"]').trigger("click"):"home"==i?showDesktop():"center"==i?openModalCallBack("#modalCentros",function(){ListarCentros()}):"logout"==i&&MessageBox({content:"¿Realmente desea cerrar la sesi&oacute;n?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Cerrar sesión",onClickButton:function(e){window.location=t.getAttribute("href")}}],cancelButton:!0})})});