function addValidCliente(){$("#txtNroDocCliente").rules("add",{required:!0}),$("#txtEmailCliente").rules("add",{required:!0,email:!0})}function addValidCliente_Natural(){$("#txtApePaternoCliente").rules("add",{required:!0}),$("#txtApeMaternoCliente").rules("add",{required:!0}),$("#txtNombresCliente").rules("add",{required:!0})}function addValidCliente_Juridica(){$("#txtRazonSocialCliente").rules("add",{required:!0})}function habilitarModuloCliente(t){"GET"==t?(habilitarControl("#txtSearchCliente",!0),habilitarClienteNatural(!1),habilitarClienteJuridico(!1),habilitarControl("#ddlTipoDocCliente,#txtNroDocCliente,#txtDireccionCliente,#txtTelefonoCliente,#txtEmailCliente",!1)):(habilitarControl("#txtSearchCliente",!1),"NA"==$("#hdTipoCliente").val()?(habilitarClienteNatural(!0),habilitarClienteJuridico(!1)):(habilitarClienteNatural(!1),habilitarClienteJuridico(!0)),habilitarControl("#ddlTipoDocCliente,#txtNroDocCliente,#txtDireccionCliente,#txtTelefonoCliente,#txtEmailCliente",!0))}function ListarAperturas(){$.ajax({type:"GET",url:"services/ventas/aperturacaja-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"3",fecha:GetToday()},success:function(t){var e=0,a=t.length,o="";if(a>0)for(;e<a;)o+="<tr>",o+="<td>"+(e+1)+"</td>",o+="<td>"+t[e].tm_apellidopaterno+" "+t[e].tm_apellidomaterno+" "+t[e].tm_nombres+"</td>",o+="<td>"+t[e].NombreMoneda+"</td>",o+="<td>"+t[e].tm_monto_inicial+"</td>",o+="<td>"+t[e].tm_monto_final+"</td>",o+="<td>"+t[e].Turno+"</td>",o+="<td>"+t[e].Estado+"</td>",o+="</tr>",++e;$("#tableAperturaDia tbody").html(o)},error:function(t){console.log(t)}})}function RegistrarAperturaCaja(){var t=new FormData,e=$("#pnlAperturaCaja :input").serializeArray();t.append("btnRegistrarApertura","btnRegistrarApertura"),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/ventas/caja-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:t,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&(closeCustomModal("#pnlAperturaCaja"),AperturaByDefault())},error:function(t){console.log(t)}})}function RegistrarMovCaja(){var t=new FormData,e=$("#pnlRegMovimientoCaja :input").serializeArray();t.append("btnRegistrarMovCaja","btnRegistrarMovCaja"),t.append("hdIdAperturaCaja",$("#hdIdAperturaCaja").val()),t.append("hdIdPersona",$("#hdIdPersona").val()),t.append("hdIdMoneda",$("#hdIdMoneda").val()),t.append("hdTipoDataPersona",$("#hdTipoDataPersona").val()),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/ventas/caja-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:t,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&($("#pnlCajaActual .btn-group button.btn-primary").removeClass("btn-primary"),$('#pnlCajaActual .btn-group button[data-tipomov="'+$("#ddlTipoMovimiento").val()+'"]').addClass("btn-primary"),closeCustomModal("#pnlRegMovimientoCaja"),AperturaByDefault())}})}function CerrarCaja(){var t=new FormData,e=$("#pnlCierreCaja :input").serializeArray();t.append("btnCerrarCaja","btnCerrarCaja"),t.append("hdIdAperturaCaja",$("#hdIdAperturaCaja").val()),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({url:"services/ventas/caja-post.php",type:"POST",cache:!1,contentType:!1,processData:!1,dataType:"json",data:t,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&(closeCustomModal("#pnlCierreCaja"),$("#pnlCajaActual .btn-group button").removeClass("btn-primary").first().trigger("click"),AperturaByDefault(),habilitarCaja(!1))},error:function(t){console.log(t)}})}function habilitarOptionCliente(t){habilitarControl('input:radio[name="rbRegCliente"]',t)}function habilitarClienteNatural(t){habilitarControl(".rowClienteNatural input:text",t)}function habilitarClienteJuridico(t){habilitarControl(".rowClienteJuridico input:text",t)}function LimpiarCobranza(){$("#ddlNombreTarjeta")[0].selectedIndex=0,$("#txtNumeroTarjeta").val(""),$("#txtImporteTarjeta").val(""),$("#hdIdCliente").val("0"),$("#ddlTipoDocCliente")[0].selectedIndex=0,$("#txtNroDocCliente").val(""),$("#txtApePaternoCliente").val(""),$("#txtApeMaternoCliente").val(""),$("#txtNombresCliente").val(""),$("#txtRazonSocialCliente").val(""),$("#txtDireccionCliente").val(""),$("#txtTelefonoCliente").val(""),$("#txtEmailCliente").val(""),habilitarControl("#btnCobrar",!0),habilitarControl("#btnImprimir",!1)}function MostrarPanelCobranza(){if(LimpiarCobranza(),0==Number($("#lblTotalPago .monto").text())){var t=$("#lblTotalCobro .monto").text();$("#lblTotalPago .monto").text(t),$("#lblEfectivoPago").text(t)}openModalCallBack("#pnlCobranza",function(){habilitarOptionCliente(!$("#chkClienteDefault")[0].checked)})}function MostrarTipoDocCliente(t){$.ajax({url:"services/documentos/documentos-tributables.php",type:"GET",dataType:"json",data:{codigotributable:t},success:function(t){var e="",a=0,o=t.length;if(o>0)for(;a<o;)e+='<option value="'+t[a].tm_iddocident+'">'+t[a].tm_descripcion+"</option>",++a;else e='<option value="0">No hay tipos de documento para este tipo de cliente.</option>';$("#ddlTipoDocCliente").html(e)},error:function(t){console.log(t)}})}function GestionarCobranza(){$.ajax({url:"services/tipocomprobante/tipocomprobante-search.php",type:"GET",dataType:"json",data:{tipo:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(t){var e=0,a=t.length,o="";if(a>0){for(;e<a;){var i=0==e?" checked":"";o+='<p><input class="with-gap" name="rbTipoComprobante" data-impuesto="'+t[e].tm_porcjimpuesto+'" type="radio" id="rbTipoComprobante'+t[e].tm_idtipocomprobante+'" value="'+t[e].tm_idtipocomprobante+'"'+i+' /><label for="rbTipoComprobante'+t[e].tm_idtipocomprobante+'">'+t[e].tm_nombre+"</label></p>",++e}o+="<h5>Medio de pago</h5>",o+='<p><input class="with-gap" name="rbMedioPago" type="radio" id="rbMedioPago1" value="1" checked /><label for="rbMedioPago1">MEDIOS DE PAGO</label></p>',o+='<p><input class="with-gap" name="rbMedioPago" type="radio" id="rbMedioPago2" value="2" /><label for="rbMedioPago2">CR&Eacute;DITO PERSONAL</label></p>',o='<div class="scrollbarra">'+o+"</div>",MessageBox({title:"Seleccione tipo de comprobante",content:o,width:"320px",height:"390px",buttons:[{primary:!0,content:"Continuar",onClickButton:function(t){var e=$('input[name="rbTipoComprobante"]:checked').val(),a=$('input[name="rbTipoComprobante"]:checked').attr("data-impuesto");$("#hdTipoComprobante").val(e);var o=$('input[name="rbMedioPago"]:checked').val();$("#hdMedioPago").val(o),"2"==o?($("#chkClienteDefault").prop("checked",!1),$("#rbObtenerCliente").prop("checked",!0),habilitarControl("#txtSearchCliente",!0),habilitarClienteNatural(!1),habilitarClienteJuridico(!1),habilitarControl("#ddlTipoDocCliente, #txtNroDocCliente, #txtDireccionCliente, #txtTelefonoCliente, #txtEmailCliente",!1),addValidCliente(),$("#tabcob_2 span").trigger("click"),$("#tabcob_1").addClass("hide")):($("#rbObtenerCliente").prop("checked",!0),habilitarControl("#txtSearchCliente",!1),habilitarClienteNatural(!1),habilitarClienteJuridico(!1),habilitarControl("#ddlTipoDocCliente,#txtNroDocCliente,#txtDireccionCliente,#txtTelefonoCliente,#txtEmailCliente",!1),$("#chkClienteDefault").prop("checked",!0),$("#tabcob_1 span").trigger("click"),$("#tabcob_1").removeClass("hide")),"2"==e?($("#hdTipoCliente").val("JU"),$(".rowClienteNatural").addClass("hide"),$(".rowClienteJuridico").removeClass("hide"),calcultarTotalFinal(a),MostrarTipoDocCliente("6"),"2"==o&&addValidCliente_Juridica()):($("#hdTipoCliente").val("NA"),$(".rowClienteNatural").removeClass("hide"),$(".rowClienteJuridico").addClass("hide"),calcultarTotalFinal(a),MostrarTipoDocCliente("1"),"2"==o&&addValidCliente_Natural()),MostrarPanelCobranza()}}],cancelButton:!0})}},error:function(t){console.log(t)}}),$("#lblEfectivoPago .monto").text($("#lblTotalPago .monto").text()),$("#lblEfectivoCambio .monto").text($("#lblTotalCambio .monto").text())}function GuardarCobranza(){var t=new FormData,e=$("#pnlCaja :input").serializeArray(),a=$("#pnlCobranza :input").serializeArray();t.append("btnCobrar","btnCobrar"),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),Array.prototype.forEach.call(a,function(e){t.append(e.name,e.value)}),t.append("hdIdOrden",$("#hdIdOrden").val()),t.append("hdIdAperturaCaja",$("#hdIdAperturaCaja").val()),t.append("hdTotalSinImpuesto",$("#lblTotalSinImpuesto .monto").text()),t.append("hdImpuesto",$("#lblImpuesto .monto").text()),t.append("hdTotalConImpuesto",$("#lblTotalConImpuesto .monto").text()),$.ajax({url:"services/ventas/caja-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){if(createSnackbar(t.titulomsje),"0"!=t.rpta){$("#titleOrden").text("Orden #:"),$("#gvArticuloMenu tbody").html(""),$("#lblTotalCobro .monto").text("0.00"),$("#lblTotalCambio .monto").text("0.00"),$("#lblTotalPago .monto").text("0.00");var e=t.datosVenta;habilitarControl("#btnCobrar",!1),habilitarControl("#btnImprimir",!0);var a=_.groupBy(e,function(t){return t.CodigoVenta+"#"+t.Cliente+"#"+t.SimboloMoneda+"#"+t.TipoComprobante}),o=_.map(a,function(t){return{CodigoVenta:t[0].CodigoVenta,Cliente:t[0].Cliente,SimboloMoneda:t[0].SimboloMoneda,TipoComprobante:t[0].TipoComprobante,tm_base_imponible:t[0].tm_base_imponible,tm_impuesto:t[0].tm_impuesto,tm_total:t[0].tm_total,list_articulos:t}}),i=o.length,n="";if(i>0){var r=o[0].SimboloMoneda;$("#lblTipoComprobante_print").text(o[0].TipoComprobante),$("#lblCodigoVenta_print").text(o[0].CodigoVenta),$("#lblFechaHora_print").text(moment().format("DD/MM/YYYY hh:mm:ss")),$("#lblNombreCliente_print").text(o[0].Cliente),$("#lblTotal_print").text(r+Number(o[0].tm_base_imponible).toFixed(2)),$("#lblImpuestos_print").text(r+Number(o[0].tm_impuesto).toFixed(2)),$("#lblTotalImp_print").text(r+Number(o[0].tm_total).toFixed(2));var l=o[0].list_articulos,c=0;c=1==l.length?0==l[0].nombreArticulo.trim().length?0:1:l.length;var d=0;if(c>0)for(;d<c;)n+="<tr>",n+="<td>"+l[d].nombreArticulo+"</td>",n+="<td>"+l[d].td_cantidad+"</td>",n+="<td>"+r+Number(l[d].td_precio).toFixed(2)+"</td>",n+="<td>"+r+Number(l[d].td_subtotal).toFixed(2)+"</td>",n+="</tr>",++d}$(".performance-facts__table tbody").html(n),$("#hdIdOrden").val("0"),clearValidationsRules("#pnlCobranza")}},error:function(t){console.log(t)}})}function calcularCambio(t){var e=0,a=0,o=Number($("#lblTotalCobro .monto").text());isNaN(t)||(t.length>0&&(e=Number(t)),e>0&&(a=e-o)),$("#lblTotalPago .monto").text(e.toFixed(2)),$("#lblTotalCambio .monto").text(a.toFixed(2))}function ListarPersonalPorTurno(t){var e="#gvPersonalTurno .collection";$.ajax({type:"GET",url:"services/organigrama/organigrama-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"3",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),turno:t},success:function(t){var a=0,o=t.length,i="";if(o>0){for(;a<o;){var n=t[a].tm_idpersonal,r=t[a].tm_foto;i+='<li class="collection-item avatar no-border dato" data-idmodel="'+n+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+n+'" />',i+='<i class="icon-select material-icons circle white-text">done</i><div class="layer-select"></div>',i+="no-set"==r?'<i class="material-icons circle">&#xE853;</i>':'<img src="'+r+'" alt="" class="circle">',i+='<span class="title descripcion">'+t[a].tm_apellidopaterno+" "+t[a].tm_apellidomaterno+" "+t[a].tm_nombres+"</span>",i+='<p><span class="docidentidad">RUC: '+t[a].tm_nrodni+"</span> -  "+t[a].tm_email+"</p>",i+='<div class="divider"></div>',i+="</li>",++a}$(e).html(i)}else $(e).html("<h2>No se encontraron resultados.</h2>")},error:function(t){console.log(t)}})}function createItem__Articulo(t,e,a,o,i,n,r){var l="";return l+='<tr data-iditem="'+a+'" class="dato">',l+='<td class="hide">',l+='<input name="mc_articulo['+filaArticulo+'][iddetalle]" type="hidden" id="iddetalle'+filaArticulo+'" value="'+a+'" /><input name="mc_articulo['+filaArticulo+'][tipomenudia]" type="hidden" id="tipomenudia'+filaArticulo+'" value="'+e+'" /><input name="mc_articulo['+filaArticulo+'][idproducto]" type="hidden" id="idproducto'+filaArticulo+'" value="'+t+'" /></td>',l+='<td data-title="Articulo" class="v-align-middle nombre-articulo">'+o,l+="</td>",l+='<td data-title="Cantidad" class="text-right">',l+='<input type="hidden" name="mc_articulo['+filaArticulo+'][cantidad]" id="cantidad'+filaArticulo+'" value="'+i+'">'+i,l+="</td>",l+='<td data-title="Precio" class="text-right">',l+='<input type="hidden" name="mc_articulo['+filaArticulo+'][precio]" id="precio'+filaArticulo+'" value="'+n+'">'+n,l+="</td>",l+='<td data-title="Subtotal" class="text-right">',l+='<input type="hidden" name="mc_articulo['+filaArticulo+'][subtotal]" id="subtotal'+filaArticulo+'" value="'+r.toFixed(2)+'" class="subtotal">'+r.toFixed(2),l+="</td>",l+='<td><a class="padding5 mdl-button mdl-button--icon tooltipped center-block" href="#" data-action="delete" data-placement="left" data-toggle="tooltip" title="Eliminar"><i class="material-icons">&#xE872;</i></a></td>',l+="</tr>",++filaArticulo,l}function buildMenu(t){var e=t.length,a=0,o="";if(e>0&&t[0].nombreProducto.length>0)for(var i=0;i<e;){var n=t[i].td_cantidad,r=Number(t[i].td_precio).toFixed(2),l=Number(t[i].td_subtotal);o+=createItem__Articulo(t[i].tm_idproducto,t[i].ta_tipomenudia,t[i].td_idatencion_articulo,t[i].nombreProducto,n,r,l),a+=l,++i}$("#gvArticuloMenu tbody").html(o),$("#lblTotalCobro .monto").text(a.toFixed(2)),$(".tooltipped").tooltip({delay:50})}function recalcularTotal(){var t=$("#gvArticuloMenu tbody tr"),e=t.length,a=0,o=0;if(e>0)for(;o<e;){var i=Number(t[o].getElementsByClassName("subtotal")[0].value);a+=i,++o}$("#lblTotalCobro .monto").text(a.toFixed(2))}function calcultarTotalFinal(t){var e=Number($("#lblTotalCobro .monto").text()),a=e*(Number(t)/100),o=e-a;$("#lblTotalSinImpuesto .monto").text(o.toFixed(2)),$("#lblImpuesto .monto").text(a.toFixed(2)),$("#lblTotalConImpuesto .monto").text(e.toFixed(2))}function getOrden(t){$.ajax({url:"services/atencion/atencion-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"ONE-ATENCION",idatencion:t},success:function(t){var e=_.groupBy(t,function(t){return t.tm_idatencion+"#"+t.tm_nroatencion+"#"+t.tm_fechahora}),a=_.map(e,function(t){return{tm_idatencion:t[0].tm_idatencion,tm_nroatencion:t[0].tm_nroatencion,tm_fechahora:t[0].tm_fechahora,list_articulos:t}}),o=a.length;o>0&&($("#hdIdOrden").val(a[0].tm_idatencion),$("#titleOrden").text("Orden #: "+a[0].tm_nroatencion),buildMenu(a[0].list_articulos))},error:function(t){console.log(t)}})}function LimpiarCaja(){$("#hdIdAperturaCaja").val("0"),$("#hdIdMoneda").val("0"),$("#lblFechaRegistroCaja").text(""),$("#lblTurnoCaja").text(""),$("#lblMonedaInicial").text(""),$("#lblImporteInicial").text("0.00"),$("#lblMonedaActual").text(""),$("#lblImporteActual").text("0.00"),$("#lblMonedaTotalCaja").text(""),$("#lblImporteTotalCaja").text("0.00"),$("#tableRegistroCaja .ibody tbody").html("")}function ListarMovimientoCaja(t){var e=$("#pnlCajaActual .btn-group button.btn-primary").attr("data-tipomov");precargaExp("#tableRegistroCaja",!0),$.ajax({type:"GET",url:"services/ventas/detalleapertura-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idregistrocaja:t,tipomov:e},success:function(t){var e=0,a=t.length,o="";if(a>0)for(;e<a;)o+="<tr>",o+="<td>"+(e+1)+"</td>",o+="<td>"+t[e].Concepto+"</td>",o+="<td>"+t[e].FechaReg.split(" ")[1]+"</td>",o+="<td>"+t[e].Moneda+"</td>",o+="<td>"+t[e].tm_monto_mn+"</td>",o+="<td>"+t[e].tm_observacion+"</td>",o+="</tr>",++e;$("#tableRegistroCaja tbody").html(o),precargaExp("#tableRegistroCaja",!1)},error:function(t){console.log(t)}})}function habilitarCaja(t){var e="",a="",o="";t?(e='<span class="fa fa-lock md-36"></span>',a="cerrar",o="Cerrar caja"):(e='<span class="fa fa-unlock md-36"></span>',a="abrir",o="Abrir caja"),$('.calc button[data-value="operar-caja"]').html(e).attr({"data-action":a,title:o,"data-original-title":o}),habilitarControl('.calc button[data-value!="operar-caja"]',t)}function ComprobarApertura(){$.ajax({url:"services/ventas/aperturacaja-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),fecha:GetToday()},success:function(t){var e=t.length,a=e>0;habilitarCaja(a),AperturaByDefault()},error:function(t){console.log(t)}})}function AperturaByDefault(){$.ajax({type:"GET",url:"services/ventas/aperturacaja-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(t){var e=t.length;LimpiarCaja(),e>0&&($("#hdIdAperturaCaja").val(t[0].tm_idregistro_caja),$("#hdIdMoneda").val(t[0].tm_idmoneda),$("#lblFechaRegistroCaja").text(ConvertMySQLDate(t[0].tm_fecharegistro)),$("#lblTurnoCaja").text(t[0].Turno),$("#lblMonedaIngreso").text(t[0].SimboloMoneda),$("#lblImporteIngreso").text(Number(t[0].tm_monto_ingreso).toFixed(2)),$("#lblMonedaSalida").text(t[0].SimboloMoneda),$("#lblImporteSalida").text(Number(t[0].tm_monto_salida).toFixed(2)),$("#lblMonedaInicial").text(t[0].SimboloMoneda),$("#lblImporteInicial").text(Number(t[0].tm_monto_inicial).toFixed(2)),$("#lblMonedaActual").text(t[0].SimboloMoneda),$("#lblImporteActual").text(Number(t[0].tm_monto_actual).toFixed(2)),ListarMovimientoCaja(t[0].tm_idregistro_caja),habilitarCaja(!0))},error:function(t){console.log(t)}})}function ListarInsumos(t){$.ajax({url:"services/insumos/insumos-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"INSUMO-PRESENTACION",tipo:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idcategoria:$("#hdIdCategoria").val(),idsubcategoria:"0",criterio:$("#txtSearchProd").val(),pagina:t},success:function(e){var a=0,o="",i="#gvInsumo tbody",n=_.groupBy(e,function(t){return t.idarticulo+"#"+t.nombre+"#"+t.tipoinsumo}),r=_.map(n,function(t){return{idarticulo:t[0].idarticulo,nombre:t[0].nombre,precio:t[0].precio,tipoinsumo:t[0].tipoinsumo,list_presentacion:t}}),l=r.length;if(l>0){for(;a<l;){var c=0,d=r[a].list_presentacion,s=0;if(d.length>0&&(s=0==d[0].Presentacion.length?0:d.length),o+="<tr>",o+="<td>",s>0&&(o+='<input type="checkbox" class="filled-in" id="chkInsumo'+a+'" value="'+r[a].idarticulo+'" name="itemsventa['+a+'][idproducto]" /><label for="chkInsumo'+a+'"></label>'),o+="</td>",o+='<td data-title="Insumo/Articulo" class="descripcion">'+r[a].nombre+"</td>",o+='<td data-title="Presentacion"><select name="itemsventa['+a+'][idpresentacion]" disabled class="select-presentacion browser-default">',s>0)for(;c<s;)"undefined"!=typeof d[c]&&(o+='<option value="'+d[c].idpresentacion+'" data-idunidadmedida="'+d[c].idunidadmedida+'" data-medidapre="'+d[c].medida_presentacion+'">'+d[c].Presentacion+(0==d[c].Presentacion.length?"":" - ")+d[c].UM+"</option>"),++c;else o+='<option value="0" data-idunidadmedida="0">No hay presentaciones</option>';o+="</select></td>",o+='<td data-title="Cantidad">',o+='<div class="mdl-input-js mdl-textfield mdl-js-textfield full-size no-padding"><input disabled class="mdl-textfield__input align-right cantidad" type="number" step="any" id="cantidad'+a+'" name="itemsventa['+a+'][cantidad]" value=""><label class="mdl-textfield__label" for="cantidad'+a+'"></label></div>',o+="</td>",o+='<td data-title="Precio">',o+='<div class="mdl-input-js mdl-textfield mdl-js-textfield full-size no-padding"><input disabled class="mdl-textfield__input align-right precio" type="number" step="any" id="precio'+a+'" name="itemsventa['+a+'][precio]" value="'+r[a].precio+'"><label class="mdl-textfield__label" for="precio'+a+'"></label></div>',o+="</td>",o+='<td data-title="SubTotal" class="subtotal">',o+='<input type="hidden" id="subtotal'+a+'" name="itemsventa['+a+'][subtotal]" value="0"><h4 class="grey-text text-right">0.00</h4>',o+="</td>",o+="</tr>",++a}gvInsumo.currentPage(gvInsumo.currentPage()+1),"1"==t?$(i).html(o):$(i).append(o)}else"1"==t&&$(i).html(""),habilitarControl("#btnAddItemsVenta",!1)},error:function(t){console.log(t)}})}function ListarServicios(t){$.ajax({url:"services/servicio/servicio-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"3",tipo:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:$("#txtSearchServ").val(),pagina:t},success:function(e){var a=0,o="",i="#gvServicio tbody",n=e.length;if(n>0){for(;a<n;)o+="<tr>",o+="<td>",o+='<input type="checkbox" class="filled-in" id="chkServicio'+a+'" value="'+e[a].tm_idservicio+'" name="itemsservicio['+a+'][idproducto]" /><label for="chkServicio'+a+'"></label>',o+="</td>",o+='<td data-title="Servicio" class="descripcion">'+e[a].tm_nombre,o+='<input type="hidden" id="serv_descripcion'+a+'" name="itemsservicio['+a+'][descripcion]" value="'+e[a].tm_nombre+'">',o+="</td>",o+='<td data-title="Precio">',o+='<div class="mdl-input-js mdl-textfield mdl-js-textfield full-size no-padding"><input disabled class="mdl-textfield__input align-right precio" type="number" step="any" id="serv_precio'+a+'" name="itemsservicio['+a+'][precio]" value="'+Number(e[a].tm_precio).toFixed(2)+'"><label class="mdl-textfield__label" for="serv_precio'+a+'"></label></div>',o+='<input type="hidden" id="serv_subtotal'+a+'" name="itemsservicio['+a+'][subtotal]" value="'+Number(e[a].tm_precio).toFixed(2)+'">',o+="</td>",o+="</tr>",++a;gvServicio.currentPage(gvServicio.currentPage()+1),"1"==t?$(i).html(o):$(i).append(o)}else"1"==t&&$(i).html(""),habilitarControl("#btnAddItemsVenta",!1)},error:function(t){console.log(t)}})}function LimpiarPreSeleccion_articulo(){$("#gvInsumo input:checkbox").prop("checked",!1),$("#gvInsumo .precio").val(""),$("#gvInsumo .cantidad").val(""),$("#gvInsumo .subtotal input:hidden").val(""),$("#gvInsumo .subtotal h4").text("0.00").addClass("grey-text"),habilitarControl("#btnAddItemsVenta",!1)}function LimpiarPreSeleccion_servicio(){$("#gvServicio input:checkbox").prop("checked",!1),$("#gvServicio .precio").val(""),$("#gvServicio .subtotal h4").text("0.00").addClass("grey-text"),habilitarControl("#btnAddItemsVenta",!1)}function AgregarItemsVenta(){var t=new FormData,e=$("#gvInsumo :input").serializeArray();t.append("btnAddItemsVenta","btnAddItemsVenta"),t.append("hdIdOrden",$("#hdIdOrden").val()),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({url:"services/ventas/caja-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&(getOrden(t.rpta),LimpiarPreSeleccion_articulo())},error:function(t){console.log(t)}})}function AgregarServicio(){var t=new FormData,e=$("#gvServicio :input").serializeArray();t.append("btnAddServicioVenta","btnAddServicioVenta"),t.append("hdIdOrden",$("#hdIdOrden").val()),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({url:"services/ventas/caja-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&(getOrden(t.rpta),LimpiarPreSeleccion_servicio())},error:function(t){console.log(t)}})}function eliminarArticulo(t){var e=getParentsUntil(t,"#gvArticuloMenu",".dato"),a=e[0].getAttribute("data-iditem");MessageBox({content:"¿Desea quitar este item?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Quitar item",onClickButton:function(t){var o=new FormData;o.append("btnRemoveArticles","btnRemoveArticles"),o.append("hdIdArticuloOrden",a),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:o,cache:!1,contentType:!1,processData:!1,success:function(t){"0"!=t.rpta&&($(e[0]).remove(),recalcularTotal())},error:function(t){console.log(t)}})}}],cancelButton:!0})}function clearValidationsRules(t){"#pnlCobranza"==t&&($("#txtNroDocCliente").rules("remove"),$("#txtEmailCliente").rules("remove"),"2"==$("#hdTipoComprobante").val()?$("#txtRazonSocialCliente").rules("remove"):($("#txtApePaternoCliente").rules("remove"),$("#txtApeMaternoCliente").rules("remove"),$("#txtNombresCliente").rules("remove")))}$(function(){$("#hdFechaHoraApertura").val(moment().format("DD/MM/YYYY hh:mm:ss")),$("#lblFechaHoraApertura").val(moment().format("DD/MM/YYYY hh:mm:ss"));var operators=["+","-","x","÷"],operations=["clientes","atencion","ventas","compras","menu","ver-caja","operar-caja","imprimir","cobrar"],decimalAdded=!1;$("#gvArticuloMenu").on("click","a",function(t){t.preventDefault(),"delete"==this.getAttribute("data-action")&&eliminarArticulo(this)}),$("#txtImporteApertura").on("focus",function(t){t.preventDefault(),this.select()}),ComprobarApertura(),$("#ddlPaisCliente").on("change",function(t){t.preventDefault(),ListarUbicacion("#ddlRegionCliente",this.value,"0")}).trigger("change"),$("#chkClienteDefault").on("change",function(t){t.preventDefault();var e=this.checked;habilitarOptionCliente(!e),0==e?($("#rbObtenerCliente").prop("checked",!0),habilitarControl("#txtSearchCliente",!0),habilitarClienteNatural(!1),habilitarClienteJuridico(!1),habilitarControl("#ddlTipoDocCliente,#txtNroDocCliente,#txtDireccionCliente,#txtTelefonoCliente,#txtEmailCliente",!1)):(habilitarControl("#txtSearchCliente",!1),habilitarClienteNatural(!1),habilitarClienteJuridico(!1),habilitarControl("#ddlTipoDocCliente,#txtNroDocCliente,#txtDireccionCliente,#txtTelefonoCliente,#txtEmailCliente",!1))}),$('input:radio[name="rbRegCliente"]').on("change",function(t){habilitarModuloCliente(this.value)}),$("#txtSearchCliente").easyAutocomplete({url:function(t){var e="services/clientes/clientes-autocomplete.php";return e+="?idempresa="+$("#hdIdEmpresa").val(),e+="&idcentro="+$("#hdIdCentro").val(),e+="&tipobusqueda=3",e+="&criterio="+t},getValue:function(t){return t.tm_numerodoc.toLowerCase()+" - "+t.Descripcion},list:{onSelectItemEvent:function(){var t=$("#txtSearchCliente").getSelectedItemData().tm_idtipocliente;$("#hdIdCliente").val(t).trigger("change")}},template:{type:"custom",method:function(t,e){return e.tm_numerodoc.toLowerCase()+" - "+e.Descripcion}},theme:"square"}),$("#btnChooseTipoItem").on("click",function(t){t.preventDefault(),t.stopPropagation(),$("#mnuTipoItem").addClass("is-visible")}),$("#mnuTipoItem").on("click","a",function(t){var e=this.getAttribute("data-tipoitem");"00"==e?($("#pnlSearchArticulo, #gvInsumo").removeClass("hide"),$("#pnlSearchServicio, #gvServicio").addClass("hide")):($("#pnlSearchArticulo, #gvInsumo").addClass("hide"),$("#pnlSearchServicio, #gvServicio").removeClass("hide")),$("#btnChooseTipoItem").find(".text").text(this.innerHTML).end().attr("data-tipoitem",e),$("#mnuTipoItem").removeClass("is-visible")}),$("#ddlTurnoApertura").on("change",function(t){t.preventDefault(),ListarPersonalPorTurno($(this).val())}),$(".calc").on("click","button",function(event){event.preventDefault();var input=document.getElementsByClassName("screen")[0],inputVal=input.value,btnVal=this.getAttribute("data-value"),btnAction=this.getAttribute("data-action");if(operations.indexOf(btnVal)>-1)if("ver-caja"==btnVal)$(".lblFechaHoy").text(GetToday()),openModalCallBack("#pnlCajaActual",function(){});else if("operar-caja"==btnVal)"abrir"==btnAction?($("#ddlMonedaApertura")[0].selectedIndex=0,$("#txtImporteApertura").val("0.00"),openModalCallBack("#pnlAperturaCaja",function(){ListarPersonalPorTurno($("#ddlTurnoApertura").val())})):openCustomModal("#pnlCierreCaja");else if("cobrar"==btnVal)GestionarCobranza();else if("menu"==btnVal)openModalCallBack("#pnlProductos",function(){ListarInsumos("1"),ListarServicios("1")});else{var module_id=config[btnVal].id,_btnOpcionMenu=$('.mdl-card[data-id="'+module_id+'"]',window.top.document);_btnOpcionMenu.attr("data-idcajareferer",$("#hdIdAperturaCaja").val()).trigger("click")}else{if("C"==btnVal)input.value="",decimalAdded=!1;else if("="==btnVal){var equation=inputVal,lastChar=equation[equation.length-1];equation=equation.replace(/x/g,"*").replace(/÷/g,"/"),(operators.indexOf(lastChar)>-1||"."==lastChar)&&(equation=equation.replace(/.$/,"")),equation&&(input.value=eval(equation)),decimalAdded=!1}else if(operators.indexOf(btnVal)>-1){var lastChar=inputVal[inputVal.length-1];""!=inputVal&&operators.indexOf(lastChar)==-1?input.value+=btnVal:""==inputVal&&"-"==btnVal&&(input.value+=btnVal),operators.indexOf(lastChar)>-1&&inputVal.length>1&&(input.value=inputVal.replace(/.$/,btnVal)),decimalAdded=!1}else if("."==btnVal)decimalAdded||(input.value+=btnVal,decimalAdded=!0);else{var moneda=this.getAttribute("data-idmoneda");null!=moneda?input.value=btnVal:input.value+=btnVal}calcularCambio(input.value)}}),$("#gvServicio tbody").on("scroll",function(t){gvServicio.listenerScroll(this,t)}),$("#gvInsumo tbody").on("scroll",function(t){gvInsumo.listenerScroll(this,t)}),$("#gvServicio tbody").on("click","input:checkbox",function(t){this.checked?habilitarControl("#btnAddItemsVenta",!0):0==$("#gvServicio input:checked").length&&habilitarControl("#btnAddItemsVenta",!1)}),$("#gvInsumo tbody").on("click","input:checkbox",function(t){var e=getParentsUntil(this,"#gvInsumo","tr"),a=e[0].getElementsByClassName("select-presentacion")[0],o=e[0].getElementsByClassName("cantidad")[0],i=e[0].getElementsByClassName("precio")[0],n=e[0].getElementsByClassName("subtotal")[0].getElementsByTagName("input")[0],r=e[0].getElementsByTagName("h4")[0];this.checked?(a.removeAttribute("disabled"),o.removeAttribute("disabled"),i.removeAttribute("disabled"),r.classList.remove("grey-text"),o.focus(),habilitarControl("#btnAddItemsVenta",!0)):(a.setAttribute("disabled",""),o.setAttribute("disabled",""),o.value="",i.value="",n.value="",i.setAttribute("disabled",""),r.classList.add("grey-text"),r.innerHTML="0.00",0==$("#gvInsumo input:checked").length&&habilitarControl("#btnAddItemsVenta",!1))}),$("#gvInsumo tbody").on("keyup",'input[type="number"]',function(t){var e=t.target,a=0,o=0,i=getParentsUntil(e,"#gvInsumo","tr");i=i[0],e.classList.contains("cantidad")?(o=e.value,a=i.getElementsByClassName("precio")[0].value):(o=i.getElementsByClassName("cantidad")[0].value,a=e.value);var n=o*a,r=i.getElementsByClassName("subtotal")[0];r.getElementsByTagName("input")[0].value=n.toFixed(2),r.getElementsByTagName("h4")[0].innerHTML=n.toFixed(2)}),$("#btnAddItemsVenta").on("click",function(t){t.preventDefault(),"00"==$("#btnChooseTipoItem").attr("data-tipoitem")?AgregarItemsVenta():AgregarServicio()}),$("#btnInfoOrden").on("click",function(t){t.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active").attr("data-tooltip","M&aacute;s informaci&oacute;n").html('<i class="left material-icons">&#xE88E;</i> M&aacute;s informaci&oacute;n'),$("#pnlInfoOrden").fadeOut(300,function(){$("#pnlDetalleOrden").fadeIn(300,function(){})})):($(this).addClass("active").attr("data-tooltip","Volver al detalle de orden").html('<i class="left material-icons">&#xE5C4;</i> Volver al detalle de orden'),$("#pnlDetalleOrde.end()n").fadeOut(300,function(){$("#pnlInfoOrden").fadeIn(300,function(){})}))}),$("#btnCobrar").on("click",function(t){t.preventDefault();var e=$("#hdMedioPago").val();if("2"==e)if($("#rbObtenerCliente")[0].checked){if("0"==$("#hdIdCliente").val())return MessageBox({title:"TAMBOAPP dice",content:"Cuando se trata de compra al cr&eacute;dito, se debe seleccionar alg&uacute;n cliente para continuar",width:"320px",height:"260px",cancelButton:!0}),!1}else if(!$("#form1").valid())return MessageBox({title:"TAMBOAPP dice",content:"Cuando se trata de compra al cr&eacute;dito, se debe ingresar la informaci&oacute;n de cliente para continuar",width:"320px",height:"260px",cancelButton:!0}),!1;GuardarCobranza()}),$("#btnImprimir").on("click",function(t){t.preventDefault(),window.print()}),$("#chkPagoTarjeta").on("change",function(t){var e=0;if(this.checked){var a=Number($("#lblTotalPago .monto").text()),o=Number($("#lblTotalCobro .monto").text());e=a>0?o-a:o}$("#txtImporteTarjeta").val(e.toFixed(2))}),$("#datetimepickerFHA").datetimepicker({inline:!0,locale:"es",format:"DD/MM/YYYY hh:mm A"}),$("#btnCloseFechaHoraApertura").on("click",function(t){t.preventDefault(),toggleOptions_v2("#pnlFechaHora","left")}),$("#btnMostrarFechaHoraApertura").on("click",function(t){
t.preventDefault(),toggleOptions_v2("#pnlFechaHora","left")}),$("#btnEstablecerFechaHoraApertura").on("click",function(t){t.preventDefault();var e=$("#datetimepickerFHA").data("date");$("#lblFechaHoraApertura").text(e),$("#hdFechaHoraApertura").val(e),toggleOptions_v2("#pnlFechaHora","left")}),$("#btnRegistrarApertura").on("click",function(t){t.preventDefault(),RegistrarAperturaCaja()}),$("#btnRegistrarMovCaja").on("click",function(t){t.preventDefault(),RegistrarMovCaja()}),$("#btnCerrarCaja").on("click",function(t){t.preventDefault(),MessageBox({content:"¿Desea cerrar caja?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Cerrar caja",onClickButton:function(t){CerrarCaja()}}],cancelButton:!0})}),$("#pnlCajaActual .btn-group").on("click","button",function(t){t.preventDefault();this.getAttribute("data-tipomov");$(this).siblings(".btn-primary").removeClass("btn-primary"),$(this).addClass("btn-primary"),AperturaByDefault()}),$("#btnAddMovimiento").on("click",function(t){t.preventDefault(),openCustomModal("#pnlRegMovimientoCaja")}),$("#txtSearchPersonal").easyAutocomplete({url:function(t){return"services/organigrama/organigrama-search.php?criterio="+t+"&tipobusqueda=1&idempresa="+$("#hdIdEmpresa").val()+"&idcentro="+$("#hdIdCentro").val()},getValue:function(t){return t.tm_nrodni.toLowerCase()+" - "+t.tm_apellidopaterno+" "+t.tm_apellidomaterno},list:{onSelectItemEvent:function(){var t=$("#txtSearchPersonal").getSelectedItemData().tm_idpersonal;$("#hdIdPersona").val(t).trigger("change")}},template:{type:"custom",method:function(t,e){return e.tm_nrodni.toLowerCase()+" - "+e.tm_apellidopaterno+" "+e.tm_apellidomaterno}},theme:"square"})});var filaArticulo=0,messagesValid={txtNroDocCliente:{required:"El número de documento es obligatorio"}},gvInsumo=new DataList("#gvInsumo",{onSearch:function(){ListarInsumos(gvInsumo.currentPage())}}),gvServicio=new DataList("#gvServicio",{onSearch:function(){ListarServicios(gvServicio.currentPage())}});