function eventTileSpinner(a){$(a).on("blur",".inputCantidad",function(a){a.preventDefault(),0==$(this).val().trim().length?$(this).val("0"):$(this).val(Number($(this).val()))}).numeric("."),$(a).on("click","button.up",function(a){a.preventDefault();var t=$(this).parent().parent().find("input"),e=($(this).parent().parent().parent().attr("data-idProducto"),Number(t.val()));return 999>e&&(e+=1,t.val(e)),!1}),$(a).on("click","button.down",function(a){var t=$(this).parent().parent().find("input"),e=($(this).parent().parent().parent().attr("data-idProducto"),Number(t.val()));return e>.01&&(e-=1,t.val(e)),!1})}function GoToPacks(){$("#btnSelectYearMonth").addClass("oculto"),$("#btnBuscarArticulos, #btnBackToPrevious").removeClass("oculto"),$("#pnlCalendarioPack").fadeOut(500,function(){$("#pnlPacks").fadeIn(500,function(){ListarGrupos("1")})})}function ListarGrupos(a){var t="#gvGrupos .tile-area";precargaExp("#gvGrupos",!0),$.ajax({type:"GET",url:"services/grupos/grupos-search.php",cache:!1,dataType:"json",data:"tipobusqueda=2&criterio=&pagina="+a,success:function(e){var r=0,n=e.length,o="";if(n>0){for(;n>r;)o+='<div data-idgrupo="'+e[r].tm_idgrupoarticulo+'" class="tile dato double bg-olive" data-nrosecciones="'+e[r].tm_nrosecciondefault+'" data-precio="'+Number(e[r].td_precio).toFixed(2)+'" data-click="transform">',o+='<div class="tile-content">',o+='<div class="text-right padding10 ntp">',o+='<h2 class="white-text">'+e[r].tm_simbolo+" "+Number(e[r].td_precio).toFixed(2)+"</h2>",o+="</div>",o+="</div>",o+='<div class="brand">',o+='<div class="label">'+e[r].tm_nombre+"</div>",o+="</div>",o+="</div>",++r;"1"==a?$(t).html(o):$(t).append(o),$("#hdPageGrupo").val(Number($("#hdPageGrupo").val())+1),$(t).on("scroll",function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){var a=$("#hdPageGrupo").val();ListarGrupos(a)}}).find(".tile:first").trigger("click")}else"1"==a&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvGrupos",!1)}})}function BackToPrevious(){var a=$("#pnlConfigMenu .sectionHeader button.success").attr("data-tipomenu");$("#hdEstadoApertura").val("00"),$("#btnBackToPrevious, #btnAperturarMenu, #btnSelectAll, #btnBuscarArticulos, #btnGuardarCambios, #btnLimpiarSeleccion, #btnAsignar, #btnEliminar").addClass("oculto"),"00"==a?($("#btnNuevaCarta").removeClass("oculto"),$("#pnlCarta").fadeOut(500,function(){$("#pnlListaCartas").fadeIn(500,function(){})})):"01"==a?($("#btnSelectYearMonth").removeClass("oculto"),$("#pnlMenu").fadeOut(500,function(){$("#pnlCalendarioIndividual").fadeIn(500,function(){ListarPlatos("01",$("#hdFecha").val())})})):"03"==a&&($("#btnSelectYearMonth").removeClass("oculto"),$("#pnlPacks").fadeOut(500,function(){$("#pnlCalendarioPack").fadeIn(500,function(){ListarGrupos("1")})}))}function AperturarMenu(){var TipoCarta=$("#pnlConfigMenu .sectionHeader button.success").attr("data-tipomenu");MessageBox("¿Desea apeturar este men&uacute;?","Recuerde que no se podr&aacute;n hacer cambios una vez aperturado el men&uacute;.","[No], [Si]",function(action){"Si"==action&&$.ajax({type:"POST",url:"services/cartadia/cartadia-post.php",cache:!1,data:"fnPost=fnPost&btnAperturarMenu=btnAperturarMenu&hdTipoCarta="+TipoCarta+"&hdIdGrupo="+$("#hdIdGrupo").val()+"&hdFecha="+$("#hdFecha").val(),success:function(data){datos=eval("("+data+")"),Number(datos.rpta)>0&&(BackToPrevious(),SetUpInfoCalendar(TipoCarta))}})})}function ListarCartas(a){var t="#gvCarta",e=t+" .gridview",r=$("#txtSearch").val();precargaExp("#pnlListaCartas",!0),$.ajax({type:"GET",url:"services/cartadia/cartas-search.php",cache:!1,dataType:"json",data:{idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:r,pagina:a},success:function(r){var n=0,o=r.length,i="",s="";if(o>0){for(;o>n;)s=1==r[n].Actual?" is-active":"",i+='<li data-idmodel="'+r[n].tm_idcarta+'" class="collection-item dato'+s+' pos-rel expandable" data-baselement="'+t+'">',i+='<input type="checkbox" name="chkItemCarta[]" value="'+r[n].tm_idcarta+'" />',i+='<div class="expandable-wrapper generic-panel gp-no-footer">',i+='<h4 class="gp-header">'+r[n].tm_nombre,i+='<button class="hide-expandable place-top-left waves-effect mdl-button mdl-button mdl-button--icon"><i class="material-icons">&#xE5C4;</i></button></h4>',i+='<div class="gp-body"><div class="scrollbarra"></div></div>',i+="</div>",i+='<i class="icon-select height-centered material-icons white-text circle place-top-right">done</i><div class="layer-select"></div>',i+='<div class="grouped-buttons place-bottom-right padding5">',i+='<a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="more" data-delay="50" data-position="bottom" data-tooltip="M&aacute;s"><i class="material-icons">&#xE5D4;</i></a>',i+='<ul class="dropdown">',i+='<li><a href="#" data-action="view-content" class="waves-effect">Ver contenido</a></li>',i+='<li><a href="#" data-action="activate" class="waves-effect">Activar carta</a></li>',i+='<li><a href="#" data-action="edit" class="waves-effect">Editar</a></li>',i+='<li><a href="#" data-action="delete" class="waves-effect">Eliminar</a></li>',i+='<li><a href="#" data-action="stats" class="waves-effect">Ir a estad&iacute;sticas</a></li>',i+="</ul>",i+="</div>",i+="</li>",++n;paginaCarta+=1,$("#hdPageCarta").val(paginaCarta),"1"==a?$(e).html(i):$(e).append(i),$(e+" .grouped-buttons a.tooltipped").tooltip()}else"1"==a&&$(e).html("<h2>No se encontraron resultados.</h2>");precargaExp("#pnlListaCartas",!1)}})}function ListarPlatos_Carta(a,t){var e=a.getAttribute("data-idmodel");precargaExp(".dato.expandable.is-expanded",!0),$.ajax({type:"GET",url:"services/cartadia/cartadia-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idcarta:e,criterio:"",pagina:t},success:function(t){var e,r=_.groupBy(t,function(a){return a.tm_idcategoria+"#"+a.Categoria}),n=_.map(r,function(a){return{tm_idcategoria:a[0].tm_idcategoria,Categoria:a[0].Categoria,list_productos:a}}),o=0,i=0,s=n.length,d=0,c="",l=a.querySelector(".expandable-wrapper > .gp-body > .scrollbarra");if(s>0){for(;s>o;){if(c+='<li data-idcategoria="'+n[o].tm_idcategoria+'" class="section-categoria">',c+='<header><h4 class="title grey-text text-darken-2">'+n[o].Categoria+"</h4></header>",c+="<main>",c+='<table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp">',c+='<thead><tr><th class="mdl-data-table__cell--non-numeric">Art&iacute;culo</th><th>Stock</th><th>Precio</th></tr></thead><tbody>',i=0,e=n[o].list_productos,d=e.length,d>0)for(;d>i;)c+="<tr>",c+='<td class="mdl-data-table__cell--non-numeric">'+e[i].nombreProducto+"</td>",c+="<td>"+e[i].td_stockdia+"</td>",c+="<td>"+e[i].simboloMoneda+" "+e[i].td_precio+"</td>",c+="</tr>",++i;c+="</tbody></table>",c+="</main>",c+="</li>",++o}l.innerHTML="<ul>"+c+"</ul>"}precargaExp(".dato.expandable.is-expanded",!1)},error:function(a){console.log(a)}})}function MostrarCarta(a){a.classList.contains("is-expanded")||(viewInExpandItem(a),ListarPlatos_Carta(a,1))}function addValidCarta(){$("#txtNombreCarta").rules("add",{required:!0,maxlength:150})}function removeValidCarta(){$("#txtNombreCarta").rules("remove")}function GoToEditCarta(a){var t="#pnlRegistroCarta";precargaExp(t,!0),resetForm(t),removeValidCarta(),addValidCarta(),openModalCallBack(t,function(){"0"==a?(precargaExp(t,!1),$("#txtNombreCarta").focus()):$.ajax({type:"GET",url:"services/cartadia/cartas-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",id:a},success:function(a){$("#hdIdCarta").val(a[0].tm_idcarta),$("#txtNombreCarta").val(a[0].tm_nombre).focus(),precargaExp(t,!1)},error:function(a){console.log(a)}})})}function GuardarCarta(){var a,t=new FormData;$("#form1").valid()&&(a=$("#pnlRegistroCarta :input").serializeArray(),t.append("btnGuardarCarta","btnGuardarCarta"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),$.each(a,function(a,e){t.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/cartadia/cartadia-post.php",cache:!1,dataType:"json",data:t,contentType:!1,processData:!1,success:function(a){MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){Number(a.rpta)>0&&(closeCustomModal("#pnlRegistroCarta"),ListarCartas("1"))})},error:function(a){console.log(a)}}))}function ActivarCarta(a){var t=new FormData,e="0";e=a.getAttribute("data-idmodel"),t.append("btnSetCarta","btnSetCarta"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),t.append("hdIdCarta",e),$.ajax({type:"POST",url:"services/cartadia/cartadia-post.php",cache:!1,data:t,dataType:"json",contentType:!1,processData:!1,success:function(t){MessageBox(t.titulomsje,t.contenidomsje,"[Aceptar]",function(){Number(t.rpta)>0&&($("#gvCarta .dato").removeClass("is-active"),a.classList.add("is-active"))})},error:function(a){console.log(a)}})}function ListarDiasAsignados(a,t,e){var r="";r="03"==e?"DIAS-GRUPAL":"DIAS-INDIVIDUAL",$.ajax({url:"services/cartadia/cartadia-dias.php",type:"GET",dataType:"json",data:{tipobusqueda:r,anho:a,mes:t,tipomenudia:e},success:function(a){var t="",r=a.length,n=0,o="";if(o="03"==e?"#pnlCalendarioPack":"#pnlCalendarioIndividual",r>0)for(;r>n;)t="01"==a[n].estado?" open":"",$(o+' .day:not(.not-current) a[data-day="'+a[n].dia+'"][data-month="'+a[n].mes+'"][data-year="'+a[n].anho+'"]').parent().addClass("active"+t).attr("data-estado",a[n].estado),++n}})}function GoToMenu(){$("#btnSelectYearMonth").addClass("oculto"),$("#btnBuscarArticulos, #btnBackToPrevious").removeClass("oculto"),$("#pnlCalendarioIndividual").fadeOut(500,function(){$("#pnlMenu").fadeIn(500,function(){ListarPlatos("01",$("#hdFecha").val())})})}function GoToArticles(){$("#hdTipoCarta").val("None"),$("#btnSelectYearMonth").addClass("oculto"),$("#pnlListado").fadeOut(500,function(){$("#pnlMenuToday").fadeIn(500,function(){0==$("#gvProductos .gridview .tile").length&&BuscarProductos("1")})})}function SetUpInfoCalendar(a){setTimeout(function(){var t="",e="0",r="0";t="03"==a?"#pnlCalendarioPack":"#pnlCalendarioIndividual",firstDay=$(t+" .responsive-calendar .days .day:not(.not-current)").first().children("a"),e=firstDay.attr("data-year"),r=firstDay.attr("data-month"),ListarDiasAsignados(e,r,a)},1e3)}function BackToList(){$("#pnlMenuToday").fadeOut(500,function(){$("#pnlListado").fadeIn(500,function(){var a=0,t=0;a=$("#pnlConfigMenu .sectionHeader button.success").attr("data-tipomenu"),"03"==a?t=$("#nav .tile").length:"01"==a&&(t=$("#gvMenu .tile").length),ShowHideAperturador(a,t),SetUpInfoCalendar("03"),SetUpInfoCalendar("01"),$("#txtSearch").focus()})})}function DetalleMenuDia(a,t,e,r,n,o,i,s,d){this.idCartaMenu=a,this.idGrupo=t,this.idProducto=e,this.idMoneda=r,this.fechaMenu=n,this.tipoMenuDia=o,this.precio=i,this.stock=s,this.orden=d}function ShowHideAperturador(a,t){var e="",r="",n=!1;$("#pnlMenuToday").is(":visible")||"00"!=a&&(r="01"==a?$("#gvMenu").attr("data-fecha"):$("#gvGrupos").attr("data-fecha"),e="01"==a?$("#gvMenu").attr("data-estado"):$("#gvGrupos").attr("data-estado"),"00"==e&&ConvertMySQLDate(r)==GetToday()&&t>0&&(n="01"==a?!$("#pnlCalendarioIndividual").is(":visible"):!$("#pnlCalendarioPack").is(":visible"))),n?$("#btnAperturarMenu").removeClass("oculto"):$("#btnAperturarMenu").addClass("oculto")}function BuscarProductos(a){precargaExp("#gvProductos",!0),$.ajax({url:"services/productos/productos-search.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"03",idcategoria:$("#ddlCategoria").val(),idsubcategoria:$("#ddlSubCategoria").val(),criterio:$("#txtSearch").val(),pagina:a},success:function(t){var e=t.length,r=0,n="",o="",i="",s="";if(e>0){for(;e>r;)"no-set"==t[r].tm_foto?(o="images/food-48.png",i=" bg-olive",s="icon"):(o=t[r].tm_foto,s="image"),n+='<div class="tile dato double'+i+'" rel="'+t[r].tm_idproducto+'" data-nomCategoria="'+t[r].Categoria+'" data-nomSubCategoria="'+t[r].SubCategoria+'" data-idCategoria="'+t[r].tm_idcategoria+'" data-idSubCategoria="'+t[r].tm_idsubcategoria+'" data-idMoneda="'+t[r].tm_idmoneda+'">',n+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+t[r].tm_idproducto+'" />',n+='<div class="tile_true_content">',n+='<div class="tile-content '+s+'">',n+='<img src="'+o+'" alt="" />',n+="</div>",n+='<div class="tile-status bg-dark opacity">',n+='<span class="label">'+t[r].nombreProducto+"</span>",n+='<div class="badge bg-red"><span class="moneda">'+t[r].simboloMoneda+' </span><span class="precio">'+Number(t[r].td_precio).toFixed(2)+"</span></div>",n+="</div>",n+="</div>",n+='<div class="input_spinner">',n+='<input type="text" name="txtCantidad" class="inputCantidad" value="5" />',n+='<div class="buttons">',n+='<button type="button" class="up bg-green white-text">+</button>',n+='<button type="button" class="down bg-red white-text">-</button>',n+="</div>",n+="</div>",n+="</div>",++r;$("#btnSelectAll").removeClass("oculto"),$("#gvProductos .tile-area").on("scroll",function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){var a=$("#hdPageProd").val();BuscarProductos(a)}}),$("#hdPageProd").val(Number($("#hdPageProd").val())+1),"1"==a?$("#gvProductos .tile-area").html(n):$("#gvProductos .tile-area").append(n)}else"1"==a&&$("#gvProductos .tile-area").html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvProductos",!1)}})}$(function(){ListarCartas("1"),gridEvents("#gvCarta",".dato",MostrarCarta),listdataEvents_default(),$("#gvCarta").on("click touchend",".dropdown a",function(a){a.preventDefault();var t="0",e=this.getAttribute("data-action"),r=this.parentNode.parentNode.parentNode.parentNode;"view-content"==e?MostrarCarta(r):"activate"==e?(confirmar=confirm("¿Desea activar esta carta?"),confirmar&&ActivarCarta(r)):"edit"==e?(t=r.getAttribute("data-idmodel"),GoToEditCarta(t)):"delete"==e&&(confirmar=confirm("¿Desea eliminar este elemento?"),confirmar&&EliminarItemCarta(r,"single"))}),$("#btnOpcionesMenu").on("click",function(a){a.stopPropagation(),$("#mnuOpcionesMenu").addClass("is-visible")}),$("#btnOpcionesCarta").on("click",function(a){a.stopPropagation(),$("#mnuOpcionesCarta").addClass("is-visible")}),$("#pnlCalendarioIndividual").responsiveCalendar({time:getOnlyYearMonth(),onDayClick:function(a){var t="",e="",r=$(this).data("year"),n=$(this).data("month"),o=$(this).data("day");t=r+"-"+addLeadingZero(n)+"-"+addLeadingZero(o);var i=$('#pnlCalendarioIndividual .day:not(.not-current) a[data-day="'+o+'"][data-month="'+n+'"][data-year="'+r+'"]').parent();e=$(i).attr("data-estado"),$("#hdEstadoApertura").val(e),$("#hdFecha").val(t),$("#gvMenu").attr({"data-fecha":t,"data-estado":e}),GoToMenu()},onInit:function(){setTimeout(function(){var a=$("#hdCurrentYear").val(),t=Number($("#hdCurrentMonth").val());ListarDiasAsignados(a,t,"01")},1e3)},onMonthChange:function(){setTimeout(function(){var a=$("#pnlCalendarioIndividual .responsive-calendar .days .day:not(.not-current)").first().children("a"),t=a.attr("data-year"),e=a.attr("data-month");ListarDiasAsignados(t,e,"01")},1e3)}}),$("#btnAsignar").on("click",function(a){a.preventDefault(),AsignarSeleccion("N")}),$("#btnBuscarArticulos").on("click",function(a){a.preventDefault(),$("#btnBuscarArticulos, #btnAperturarMenu, #btnBackToPrevious, #btnGuardarCambios, #btnLimpiarSeleccion, #btnEliminar").addClass("oculto"),$("#gvProductos .tile").length>0&&$("#btnSelectAll").removeClass("oculto"),GoToArticles()}),$("#btnGuardarCambios").on("click",function(a){a.preventDefault(),AsignarSeleccion("M")}),$("#btnNuevo").on("click",function(a){a.preventDefault(),$("#pnlListaCartas").is(":visible")&&GoToEditCarta("0")}),$("#btnGuardarCarta").on("click",function(a){a.preventDefault(),GuardarCarta()}),$("#btnBackToPrevious").on("click",function(a){a.preventDefault(),BackToPrevious()}),$("#lnkShowFavs").on("click",function(a){var t="";a.preventDefault(),t=$("#pnlConfigMenu .sectionHeader button.success").attr("data-tipomenu"),$(this).hasClass("active")?$(this).removeClass("active").attr("title","Mostrar favoritos"):$(this).addClass("active").attr("title","Mostrar todo"),ListarPlatos(t,$("#hdFecha").val())}),$("#btnAperturarMenu").on("click",function(a){a.preventDefault(),AperturarMenu()})});var paginaCarta=1;