function crearItemMesa(e){var t="";return t+='<div class="demo-card-square dato mdl-cell mdl-cell--2-col mdl-cell--6-col-phone pos-rel mdl-card" ',t+='data-idmesa="'+e.idgrupomesa+'" ',t+='data-tipomesa="'+e.ta_tipomesa+'" ',t+='data-state="'+e.estadoatencion_group+'" ',t+='style="background-color: '+e.color_leyenda_group+';">',t+='<input type="checkbox" name="chkMesa[]" value="'+e.idgrupomesa+'" />',t+='<i class="icon-select place-top-right margin10 material-icons white-text circle">done</i><div class="layer-select"></div>',t+='<div style="width: 64px; height:48px;" class="centered"><h1 class="text-center white-text">'+e.codigo_group+"</h1></div>",t+="</div>"}function initAutoScroll(){$list=$("#pnlEspera"),$listSH=$list[0].scrollHeight-$list.outerHeight();var e=function(){setTimeout(function(){var t=$list.scrollTop();$list.stop().animate({scrollTop:t?0:$listSH},2e3,e)},15e3)};e()}function ListarMesas(e){var t="#pnlMonitor";precargaExp(t,!0),$.ajax({url:"services/ambientes/mesas-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"GROUP-MESAS",tipo:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idambiente:e,estadoatencion:"02,03,04"},success:function(a){var o="",i=0,n=_.groupBy(a,function(e){return e.idgrupomesa+"#"+e.ta_tipomesa+"#"+e.codigo_group+"#"+e.comensales_group+"#"+e.estadoatencion_group+"#"+e.color_leyenda_group}),s=_.map(n,function(e){return{idgrupomesa:e[0].idgrupomesa,ta_tipomesa:e[0].ta_tipomesa,codigo_group:e[0].codigo_group,comensales_group:e[0].comensales_group,estadoatencion_group:e[0].estadoatencion_group,color_leyenda_group:e[0].color_leyenda_group,list_mesas:e}}),r=s.length;if(r>0)for(;i<r;)o+=crearItemMesa(s[i]),++i;$("#pnlEspera").html(o),atencion_Notif(e),precargaExp(t,!1),initAutoScroll()},error:function(e){console.log(e)}})}function atencion_Notif(e){var t=new Comet("services/atencion/mesa-update.php",{idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idambiente:e},function(e){agregar_Notificiacion(e)});t.connect()}function agregar_Notificiacion(e){if("undefined"!=typeof e.idgrupomesa&&"0"!=e.idgrupomesa){var t=e.idgrupomesa,a="",o="#pnlEspera";0==$(o+' .dato[data-idmesa="'+t+'"]').length&&(a=crearItemMesa(e),$("#pnlEspera").prepend(a),initAutoScroll())}}function setVideo(){}function ListarAmbientes(){$.ajax({url:"services/ambientes/ambientes-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(e){var t=0,a=e.length,o="";if(a>0)for(;t<a;)o+='<div data-idambiente="'+e[t].tm_idambiente+'" class="demo-card-monitor dato mdl-cell mdl-cell--3-col pos-rel mdl-card teal">',o+='<div class="mark-selected pos-abs indigo accent-4 white-text circle"><i class="material-icons centered">&#xE5CA;</i></div>',o+='<div style="width: 100%; height: 25%;" class="centered"><h3 class="text-center white-text">'+e[t].tm_nombre+"</h3></div>",o+="</div>",++t;$("#gvAmbientes").html(o).find(".dato:first-child").trigger("click")},error:function(e){console.log(e)}})}var videoArray=["at3FPJaAwoY","IxxstCcJlsc","dGghkjpNCQ8","RVmG_d3HKBA","NF-kLy44Hls","Qc9c12q3mrc","RcZn2-bGXqQ","CevxZvSJLk8","5dbEhBKGOtY"],index=0,player;$(function(){ListarAmbientes(),$("#btnAmbientes").on("click",function(e){e.preventDefault(),openCustomModal("#modalAmbientes")}),$("#gvAmbientes").on("click",".dato",function(e){e.preventDefault(),closeCustomModal("#modalAmbientes");var t=this.getAttribute("data-idambiente");$(this).siblings(".dato").removeClass("oneSelected"),$(this).addClass("oneSelected"),ListarMesas(t)})}),window.onPlayerReady=function(e){e.target.seekTo(0),e.target.playVideo()},window.onPlayerStateChange=function(e){0===e.data&&(index+=1,window.player.destroy(),null==window.player,setVideo(index))};