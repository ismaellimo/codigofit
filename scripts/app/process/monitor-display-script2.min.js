function atencion_Notif(e){var t=new Comet("services/atencion/despacho-update.php",{idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),estadoatencion:e},function(t){agregar_Notificiacion(e,t)});t.connect()}function crearItemArticulo(e,t,a,i,n,d,o){var r="",c=Number(d).toFixed(2);return r+="<li>",r+='<div class="mdl-grid">',r+='<div class="mdl-cell mdl-cell--7-col">'+a+" ("+i+")",r+="</div>",r+='<div class="mdl-cell mdl-cell--5-col align-right">S/. '+c+"</div>",r+="</div>",r+="</li>"}function crearItems_Articulos(e){var t=0,a=0,i="",n=0;if(a=1==e.length?0==e[0].nombreProducto.trim().length?0:1:e.length,a>0)for(;t<a;){if("undefined"!=typeof e[t]){var d=Number(e[t].td_subtotal);i+=crearItemArticulo(e[t].td_idatencion_articulo,e[t].tm_idproducto,e[t].nombreProducto,Number(e[t].td_cantidad).toFixed(0),Number(e[t].td_precio).toFixed(2),e[t].td_subtotal,e[t].td_observacion),n+=d}++t}return{strhtml_articulos:i,total_orden:n}}function crearItemOrden(e,t,a,i){var n="";n='<div data-idorden="'+e+'" class="demo-card-order dato mdl-card mdl-cell mdl-cell--12-col mdl-shadow--2dp">',n+='<input name="chkItem[]" type="checkbox" class="hide" value="'+e+'" />',n+='<div class="mdl-card__title mdl-card--expand mdl-card--border">',n+="<h5>",n+='<span class="padding-right10 padding-left10 place-left"><strong>ORDEN</strong>: '+t+"</span>",n+='<span class="padding-right10 padding-left10 place-right"><strong>MOZO</strong>: '+a+"</span>",n+="</h5>",n+="</div>",n+='<div class="mdl-card__supporting-text full-size scrollbarra">',n+='<ul class="details-in-card no-margin">';var d=0;if("undefined"!=typeof i){var o=crearItems_Articulos(i);n+=o.strhtml_articulos,d=o.total_orden}return n+="</ul>",n+="</div>",n+='<div class="mdl-card__actions mdl-card--border">',n+='<h4 class="align-right"><strong>S/.</strong>&nbsp;<span class="total">'+d.toFixed(2)+"</span></h4>",n+="</div>",n+='<div class="mark-selected pos-abs indigo accent-4 white-text circle"><i class="material-icons centered">&#xE5CA;</i></div>',n+='<i class="icon-select centered material-icons white-text circle">&#xE5CA;</i>',n+='<div class="layer-select"></div>',n+="</div>"}function ListarOrdenes(e,t,a){$.ajax({url:"services/atencion/atencion-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"ATENCION-TICKETS",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),idambiente:e,idmesas:"0",estado:a},success:function(e){var i="",n=0,d=_.groupBy(e,function(e){return e.tm_idatencion+"#"+e.tm_idambiente+"#"+e.tm_nroatencion+"#"+e.ta_estadoatencion+"#"+e.ta_tipoubicacion+"#"+e.tm_fechahora+"#"+e.tm_idempresa+"#"+e.tm_idcentro}),o=_.map(d,function(e){return{tm_idatencion:e[0].tm_idatencion,tm_idambiente:e[0].tm_idambiente,tm_nroatencion:e[0].tm_nroatencion,ta_estadoatencion:e[0].ta_estadoatencion,ta_tipoubicacion:e[0].ta_tipoubicacion,tm_fechahora:e[0].tm_fechahora,tm_idempresa:e[0].tm_idempresa,tm_idcentro:e[0].tm_idcentro,list_articulos:e}}),r=o.length;if(r>0)for(;n<r;)i+=crearItemOrden(o[n].tm_idatencion,o[n].tm_nroatencion,"Admin",o[n].list_articulos),++n;$(t).html(i),atencion_Notif(a)},error:function(e){console.log(e)}})}function listarDetalle_Orden(e,t,a,i){$.ajax({url:"services/atencion/detallearticulo-search.php",type:"GET",data:{tipo:"2",idatencion:t},dataType:"json",cache:!1,success:function(n){var d=crearItemOrden(t,a,i,n),o="03"==e?"#pnlCocina":"#pnlEspera";$(o).append(d)},error:function(e){console.log(e)}})}function agregar_Notificiacion(e,t){if("undefined"!=typeof t.idatencion&&"0"!=t.idatencion){var a=t.idatencion,i=t.nroatencion,n="03"==e?"#pnlCocina":"#pnlEspera";0==$(n+' .dato[data-idorden="'+a+'"]').length&&listarDetalle_Orden(e,a,i,"Admin")}}function setVideo(){}function ListarAmbientes(){$.ajax({url:"services/ambientes/ambientes-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(e){var t=0,a=e.length,i="";if(a>0)for(;t<a;)i+='<div data-idambiente="'+e[t].tm_idambiente+'" class="demo-card-monitor dato mdl-cell mdl-cell--3-col pos-rel mdl-card teal">',i+='<div class="mark-selected pos-abs indigo accent-4 white-text circle"><i class="material-icons centered">&#xE5CA;</i></div>',i+='<div style="width: 100%; height: 25%;" class="centered"><h3 class="text-center white-text">'+e[t].tm_nombre+"</h3></div>",i+="</div>",++t;$("#gvAmbientes").html(i).find(".dato:first-child").trigger("click")},error:function(e){console.log(e)}})}var videoArray=["at3FPJaAwoY","IxxstCcJlsc","dGghkjpNCQ8","RVmG_d3HKBA","NF-kLy44Hls","Qc9c12q3mrc","RcZn2-bGXqQ","CevxZvSJLk8","5dbEhBKGOtY"],index=0,player;$(function(){ListarAmbientes(),$("#btnAmbientes").on("click",function(e){e.preventDefault(),openCustomModal("#modalAmbientes")}),$("#gvAmbientes").on("click",".dato",function(e){e.preventDefault(),$(".close-modal-example").trigger("click");var t=this.getAttribute("data-idambiente");$(this).siblings(".dato").removeClass("oneSelected"),$(this).addClass("oneSelected"),ListarOrdenes(t,"#pnlCocina","03"),ListarOrdenes(t,"#pnlEspera","04")})}),window.onPlayerReady=function(e){e.target.seekTo(0),e.target.playVideo()},window.onPlayerStateChange=function(e){0===e.data&&(index+=1,window.player.destroy(),null==window.player,setVideo(index))};