function MostrarMesas__onupdate(){MostrarMesas(!0)}function MostrarAmbientes(){$.ajax({url:"services/ambientes/ambientes-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(e){var t=0,a=e.length,o="",n=$("#pnlMesas .mdl-layout__header .view-button.btn-success").attr("data-view"),r="",i="";if(a>0)for(;t<a;)"mesas"==n?(r="",i=" hide"):(r=" hide",i=""),o+='<div data-idambiente="'+e[t].tm_idambiente+'" class="item'+(0==t?" active":"")+' all-height"><div class="generic-panel gp-no-footer"><div class="gp-header"><h3 class="text-center">'+e[t].tm_nombre+"</h3></div>",o+='<div class="gp-body">',o+='<div class="pane-carousel mesas scrollbarra'+r+'" class="gridview all-height" data-selected="none" data-multiselect="false" data-actionbar="mesas-actionbar"><div class="gridview-container mdl-grid"></div></div>',o+='<div class="pane-carousel grupos scrollbarra'+i+'" class="gridview all-height" data-selected="none" data-multiselect="false" data-actionbar="grupos-actionbar"><div class="gridview-container mdl-grid"></div></div>',o+="</div>",o+="</div>",o+="</div>",++t;$(".carousel-inner").html(o),$(".carousel").carousel({interval:!1,wrap:!0,keyboard:!0}),initGvMesas(),initGvMesasGroup(),MostrarMesas()},error:function(e){console.log(e)}})}function Ambientes(){openModalCallBack("#pnlMesas",function(){MostrarAmbientes()})}function Ordenes(e,t){$("#pnlMesas").fadeOut(300,function(){$("#pnlOrden").removeClass("hide"),$("#pnlOrden").fadeIn(300,function(){$("#pnlOrden > .gp-header .mdl-layout-title").text("Mesa: "+t),listarDetalle(e)})})}function MostrarMesas(e){var t=$("#carousel-example-generic").find(".item.active"),a=t.attr("data-idambiente");$("#hdIdAmbiente").val(a),"undefined"!=typeof e&&precarga_OverLayer(".page-region",!0,{mensaje:"Las mesas se están actualizando, espere unos minutos..."}),ListarMesas(a,e),ListarMesasGroup(a,e)}function ListarMesas(e,t){var a='#carousel-example-generic .item[data-idambiente="'+e+'"]',o=a+" .mesas .gridview-container";precargaExp(a,!0),$.ajax({url:"services/ambientes/mesas-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"GROUP-MESAS",tipo:"1U",idambiente:e},success:function(e){var n="",r=0,i=e.length;if(i>0)for(;r<i;)n+='<div class="dato mdl-cell mdl-cell--2-col mdl-cell--2-col-phone pos-rel mdl-card card-mesa" ',n+='data-idatencion="'+e[r].tm_idatencion+'" ',n+='data-nroatencion="'+e[r].tm_nroatencion+'" ',n+='data-idmesa="'+e[r].idgrupomesa+'" ',n+='data-tipomesa="'+e[r].ta_tipomesa+'" ',n+='data-state="'+e[r].estadomesa_group+'" ',n+='style="background-color: '+e[r].color_leyenda_group+';">',n+='<input type="checkbox" name="chkMesa[]" value="'+e[r].idgrupomesa+'" />',n+='<div class="mark-selected pos-abs indigo accent-4 white-text circle"><i class="material-icons centered">&#xE5CA;</i></div>',n+='<i class="icon-select place-top-right margin10 material-icons white-text circle">done</i><div class="layer-select"></div>',n+='<div style="width: 64px; height:48px;" class="centered"><h1 class="text-center white-text nombremesa">'+e[r].codigo_group+"</h1></div>",n+="</div>",++r;else n="<h2>No se encontraron resultados.</h2>";$(o).html(n).find(".dato:first-child").trigger("click"),precargaExp(a,!1),"undefined"!=typeof t&&precarga_OverLayer(".page-region",!1)},error:function(e){console.log(e)}})}function ListarMesasGroup(e,t){var a='#carousel-example-generic .item[data-idambiente="'+e+'"]',o=a+" .grupos .gridview-container";precargaExp(a,!0),$.ajax({url:"services/ambientes/mesas-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"GROUP-MESAS",tipo:"1G",idambiente:e},success:function(e){var n="",r=0,i=_.groupBy(e,function(e){return e.idgrupomesa+"#"+e.ta_tipomesa+"#"+e.codigo_group+"#"+e.comensales_group+"#"+e.estadomesa_group+"#"+e.color_leyenda_group}),s=_.map(i,function(e){return{tm_idatencion:e[0].tm_idatencion,tm_nroatencion:e[0].tm_nroatencion,idgrupomesa:e[0].idgrupomesa,ta_tipomesa:e[0].ta_tipomesa,codigo_group:e[0].codigo_group,comensales_group:e[0].comensales_group,estadomesa_group:e[0].estadomesa_group,color_leyenda_group:e[0].color_leyenda_group,list_mesas:e}}),c=s.length;if(c>0)for(;r<c;){var d="",l=0,u=0;if(s[r].codigo_group.trim().length>0)d=s[r].codigo_group;else if(l=1==mesas.length&&0==mesas[0].tm_codigo.trim().length?0:mesas.length,l>0)for(;u<l;)d+=mesas[u].tm_codigo,++u;n+='<div class="dato mdl-cell mdl-cell--4-col mdl-cell--4-col-phone pos-rel mdl-card card-mesa" ',n+='data-idatencion="'+s[r].tm_idatencion+'" ',n+='data-nroatencion="'+s[r].tm_nroatencion+'" ',n+='data-idmesa="'+s[r].idgrupomesa+'" ',n+='data-tipomesa="'+s[r].ta_tipomesa+'" ',n+='data-state="'+s[r].estadomesa_group+'" ',n+='style="background-color: '+s[r].color_leyenda_group+';">',n+='<input type="checkbox" name="chkGrupos[]" value="'+s[r].idgrupomesa+'" />',n+='<i class="icon-select place-top-right margin10 material-icons white-text circle">done</i><div class="layer-select"></div>',n+='<div style="width: 84px; height:84px;" class="centered"><h1 class="text-center white-text nombremesa">'+d+"</h1></div>",n+="</div>",++r}else n="<h2>No se encontraron resultados.</h2>";$(o).html(n).find(".dato:first-child").trigger("click"),precargaExp(a,!1),"undefined"!=typeof t&&precarga_OverLayer(".page-region",!1)},error:function(e){console.log(e)}})}function crearItemArticulo(e,t,a,o,n,r,i){var s="",c=Number(r).toFixed(2);return s+='<tr data-iditem="'+e+'">',s+='<td data-title="Articulo" class="v-align-middle nombre-articulo">'+a+"</td>",s+='<td data-title="Cantidad">'+o+"</td>",s+='<td data-title="Precio">'+c+"</td>",s+='<td class="pos-rel"><button class="mdl-button mdl-button--icon" data-action="delete"><i class="material-icons">&#xE872;</i></td>',s+="</tr>"}function listarDetalle(e){$.ajax({url:"services/atencion/detallearticulo-search.php",type:"GET",data:{tipo:"2",idatencion:e},dataType:"json",cache:!1,success:function(e){var t=crearItems_Articulos(e),a=t.count_articulos,o=t.strhtml_articulos,n=t.total_orden;$("#gvOrdenes tbody").html(o),$("#lblTotalFromOrder .monto").text(Number(n).toFixed(2)),a>0?("02"==$("#hdEstadoMesa").val()?$("#btnConfirmOrder").removeClass("hide"):$("#btnConfirmOrder").addClass("hide"),"05"!=$("#hdEstadoMesa").val()&&$("#btnPayOrder").removeClass("hide"),$("#emptyStateOrders").addClass("hide"),$("#pnlOrdenesDetalle").removeClass("hide")):($("#emptyStateOrders").removeClass("hide"),$("#pnlOrdenesDetalle").addClass("hide"))},error:function(e){console.log(e)}})}function agregarArticulos(e){var t=new FormData;t.append("btnAddArticles","btnAddArticles"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),t.append("hdIdAtencion",e),t.append("hdIdArticulo",$("#hdIdArticulo").val()),t.append("hdPrecio",$("#hdPrecio").val()),t.append("hdCantidad",$("#hdCantidad").val()),t.append("hdSubTotal",$("#hdSubTotal").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){"0"!=t.rpta&&(VerOrden__FromSede(),listarDetalle(e))},error:function(e){console.log(e)}})}function eliminarArticulo(e){var t=getParentsUntil(e,"#gvOrdenes","tr"),a=t[0].getAttribute("data-iditem");MessageBox({content:"¿Desea quitar este item?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Quitar item",onClickButton:function(e){var o=new FormData;o.append("btnRemoveArticles","btnRemoveArticles"),o.append("hdIdArticuloOrden",a),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:o,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&$(t[0]).remove()},error:function(e){console.log(e)}})}}],cancelButton:!0})}function nuevaOrden(){var e=new FormData;$("#hdNombrePersonal").val();e.append("btnNuevaOrden","btnNuevaOrden"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAtencion",$("#hdIdAtencion").val()),e.append("hdIdCliente",$("#hdIdCliente").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){var t=e.rpta;e.contenidomsje;createSnackbar(e.titulomsje),"0"!=t&&($("#hdIdAtencion").val(t),agregarArticulos(t))},error:function(e){console.log(e)}})}function crearItems_Articulos(e){var t=0,a=0,o="",n=0;if(a=1==e.length?0==e[0].nombreProducto.trim().length?0:1:e.length,a>0)for(;t<a;){if("undefined"!=typeof e[t]){var r=Number(e[t].td_subtotal);o+=crearItemArticulo(e[t].td_idatencion_articulo,e[t].tm_idproducto,e[t].nombreProducto,Number(e[t].td_cantidad).toFixed(0),Number(e[t].td_precio).toFixed(2),e[t].td_subtotal,e[t].td_observacion),n+=r}++t}return{count_articulos:a,strhtml_articulos:o,total_orden:n}}function CambiarEstado(e){var t=new FormData,a=$("#carousel-example-generic").find(".item.active"),o=a.attr("data-idambiente"),n='#carousel-example-generic .item[data-idambiente="'+o+'"]',r=n+" .gridview-container",i=$(r+" :input").serializeArray();t.append("btnCambiarEstado","btnCambiarEstado"),t.append("hdEstadoMesa",e),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),Array.prototype.forEach.call(i,function(e){t.append(e.name,e.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(gvMesas.removeSelection(),gvMesasGroup.removeSelection(),MostrarMesas())},error:function(e){console.log(e)}})}function ConfirmarOrden(){var e=new FormData;e.append("btnConfirmOrder","btnConfirmOrder"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAtencion",$("#hdIdAtencion").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&($("#btnBackToRooms").trigger("click"),MostrarMesas())},error:function(e){console.log(e)}})}function EliminarOrden(){var e=new FormData;e.append("btnRemoveOrder","btnRemoveOrder"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAtencion",$("#hdIdAtencion").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&($("#btnBackToRooms").trigger("click"),MostrarMesas())},error:function(e){console.log(e)}})}function AgruparMesas(){var e=new FormData;e.append("btnAgruparMesas","btnAgruparMesas"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAmbiente",$("#hdIdAmbiente").val());var t=$(".mesas :input").serializeArray();Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(gvMesas.removeSelection(),MostrarMesas())},error:function(e){console.log(e)}})}function SepararMesas(){var e=new FormData;e.append("btnSepararMesas","btnSepararMesas"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val());var t=$(".grupos :input").serializeArray();Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(gvMesasGroup.removeSelection(),MostrarMesas())},error:function(e){console.log(e)}})}function initGvMesas(){gvMesas=new DataList("#carousel-example-generic .mesas",{onSearch:function(){},oneItemClick:function(e){var t=e.target,a=getParentsUntil(t,"#carousel-example-generic .mesas",".dato");a=a[0],$("#carousel-example-generic .mesas .oneSelected").removeClass("oneSelected"),$(a).addClass("oneSelected")}})}function initGvMesasGroup(){gvMesasGroup=new DataList("#carousel-example-generic .grupos",{onSearch:function(){},oneItemClick:function(e){var t=e.target,a=getParentsUntil(t,"#carousel-example-generic .grupos",".dato");a=a[0],$("#carousel-example-generic .grupos .oneSelected").removeClass("oneSelected"),$(a).addClass("oneSelected")}})}function BackToRooms(){$("#hdIdAtencion").val("0"),$("#hdIdMesa").val("0"),$("#hdTipoMesa").val("0"),$("#hdEstadoMesa").val("00"),$("#pnlOrden").fadeOut(300,function(){$("#pnlOrden").addClass("hide"),$("#pnlMesas").fadeIn(300,function(){$("#btnPayOrder, #btnRemoveOrder, #btnAddArticles, #btnConfirmOrder").addClass("hide")})})}function VerOrden__FromArticulo(){$("#pnlArticulo").fadeOut(400,function(){$("#pnlOrden").fadeIn(400,function(){})})}function VerOrden__FromSede(){$("#pnlCentros").fadeOut(400,function(){$("#pnlOrden").fadeIn(400,function(){})})}function VerSedes(){$("#pnlArticulo").fadeOut(400,function(){$("#pnlCentros").fadeIn(400,function(){ListarCentros()})})}function VerLocal(){openModalCallBack("#pnlLocal",function(){$("#pnlLocal > .modal-example-body > .scrollbarra").animate({scrollTop:0},1e3,function(){ListarArticulos__Individual("1")})})}function seleccionarMesa(){var e=$("#pnlMesas .mdl-layout__header .view-button.btn-success").attr("data-view"),t=$("#carousel-example-generic ."+e+" .dato.oneSelected"),a=t.attr("data-idatencion"),o=t.attr("data-idmesa"),n=t.attr("data-tipomesa"),r=t.attr("data-state");t.find(".nombremesa").text();$("#hdIdAtencion").val(a),$("#hdIdMesa").val(o),$("#hdTipoMesa").val(n),$("#hdEstadoMesa").val(r),closeCustomModal("#pnlMesas"),nuevaOrden(),VerOrden__FromArticulo()}function ListarArticulos__Portada(e){var t="portada",a=$("#txtArticulo").val(),o={tipoconsulta:"COMENSAL",tipobusqueda:"1",tipomenu:"01",criterio:a,pagina:e};precargaExp("#pnlArticulo > .gp-body > .container-body",!0),ListarArticulos(t,o,e,function(){$(".info-card-list li").each(function(e,t){new SwipeListItem(t,"option")}),precargaExp("#pnlArticulo > .gp-body > .container-body",!1)})}function createItem__Menu(e,t,a,o,n){var r="",i="undefined"==typeof n?0:n;return r+='<li class="resultItem dato mdl-shadow--2dp"',r+='data-iditem="'+o+'" ',r+='data-nombreProducto="'+a+'" ',r+='data-importe="'+i+'" ',r+=">",r+='<input type="hidden" name="carrito['+e+'][importe]" class="importe" value="'+n+'" />',r+='<div class="resultItem-avatar blue-grey darken-2">',r+='<img data-src="'+t.replace("_o","_s640")+'" class="image__centro centered" alt="'+a+'" src="'+t.replace("_o","_s140")+'">',r+="</div>",r+='<div class="resultItem-information">',r+='<h3 class="resultItem-name">',r+=a,r+="</h3>",r+='<div class="resultItem-address hide"></div>',i>0&&(r+='<div class="resultItem-averagePrice">',r+="S/."+i,r+="</div>"),r+="</div>",r+='<div class="resultItem-rating resultItem-rating--noTimeSlot">',r+='<div class="rating pos-rel no-margin">',r+='<div class="spin"><input type="number" min="1" max="100" value="1" /></div>',r+='<div class="clear"></div>',r+="</div>",r+="</div>",r+='<div class="resultItem-action">',r+='<a href="#" data-action="add" class="mdl-button mdl-button--icon tooltipped" data-delay="50" data-position="bottom" data-tooltip="Agregar a la orden"><i class="material-icons">&#xE146;</i></a>',r+="</div>",r+="</li>"}function ListarArticulos__Menu(e){}function ListarArticulos__Carta(e){var t="";({tipobusqueda:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),tipomenu:"00",idcarta:0,criterio:t,pagina:e});$.ajax({type:"GET",url:"services/cartadia/cartadia-search.php",cache:!1,dataType:"json",data:data,success:function(e){var t=0,a="",o=e.length;if(o>0){for(;t<o;)a+=createItem__Menu(t,data[t].tm_foto,data[t].nombreProducto,data[t].tm_idproducto,data[t].td_precio),++t;$("#gvArticulo__Carta ul").html(a),$("#gvArticulo__Carta").removeClass("hide"),$("#emptyStateCentros").addClass("hide"),precargaExp("#pnlCentros >.gp-body > .container-body",!1)}else $("#gvArticulo__Carta").addClass("hide"),$("#emptyStateCentros").removeClass("hide")},error:function(e){console.log(e)}})}function ListarArticulos__Individual(e){var t="individual",a="",o={tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),tipomenu:"01",idgrupo:0,criterio:a,pagina:e};ListarArticulos(t,o,e)}function ListarArticulos(e,t,a,o){var n="",r="",i="";"portada"==e?(n="#gvArticulo",r="#gvArticulo > .scrollbarra > ul",i="#emptyStateArticles"):"individual"==e&&(n="#gvArticulo__Individual",r="#gvArticulo__Individual > ul",i="#emptyStateArticles__Individual"),$.ajax({type:"GET",url:"services/cartadia/cartadia-search.php",cache:!1,dataType:"json",data:t,success:function(e){var t="",s=e.length;if(s>0){for(var c=0;c<s;){var d=e[c].tm_foto,l=e[c].nombreProducto;t+=createItem__Menu(c,d,l),++c}gvArticulo.currentPage(gvArticulo.currentPage()+1),"1"==a?$(r).html(t):$(r).append(t),$(i).addClass("hide"),$(n).removeClass("hide")}else"1"==a&&($(r,i).html(""),$(i).removeClass("hide"),$(n).addClass("hide"));"undefined"!=typeof o&&o(),$("input[type=number]").spinner()},error:function(e){console.log(e)}})}function ListarCentros(){precargaExp("#pnlCentros >.gp-body > .container-body",!0),$.ajax({url:"services/centro/centro-search.php",type:"GET",dataType:"json",data:{tipoconsulta:"COMENSAL",tipobusqueda:"1",idregion:$("#hdIdRegion").val(),nombrearticulo:$("#hdNombreArticulo").val()},success:function(e){var t=0,a="",o=e.length;if(o>0){for(;t<o;){var n=(e[t].tm_latitud,e[t].tm_longitud,Number(e[t].td_precio).toFixed(2));a+='<li class="resultItem resultItem__local dato mdl-shadow--2dp"',a+='data-idempresa="'+e[t].tm_idempresa+'" ',a+='data-idcentro="'+e[t].tm_idcentro+'" ',a+='data-lat="'+e[t].tm_latitud+'" ',a+='data-lng="'+e[t].tm_longitud+'" ',a+='data-importe="'+n+'" ',a+=">",a+='<input type="hidden" name="carrito['+t+'][importe]" class="importe" value="'+n+'" />',a+='<div class="resultItem-avatar blue-grey darken-2">',a+='<img data-src="'+e[t].tm_logo.replace("_o","_s640")+'" class="image__centro centered" alt="'+e[t].NombreEmpresa+'" src="'+e[t].tm_logo.replace("_o","_s140")+'">',a+="</div>",a+='<div class="resultItem-information">',a+='<h3 class="resultItem-name">',a+=e[t].NombreEmpresa,a+="</h3>",a+='<div class="resultItem-address">',a+=e[t].tm_direccion,a+="</div>",a+='<div class="resultItem-averagePrice">',a+="S/."+n,a+="</div>",a+="</div>",a+='<div class="resultItem-rating resultItem-rating--noTimeSlot">',a+='<div class="rating">',a+='<a href="#" class="js_rating" target="_blank"><span class="rating-ratingValue">8,5</span> /10</a>',a+="<br />Valoraci&oacute;n",a+="</div>",a+='<button id="btnAgregarArticulos" type="button" data-action="choose" class="hidden-xs mdl-button mdl-js-button waves-effect mdl-button--raised mdl-button--colored mdl-button--primary center-block">SELECCIONAR</button>',a+="</div>",a+='<div class="clear"></div>',a+='<div class="resultItem-footer place-bottom-left-right">',a+='<h3 class="resultItem-name">',a+=e[t].NombreEmpresa,a+="</h3>",a+='<div class="resultItem-address">',a+=e[t].tm_direccion,a+="</div>",a+="</div>",a+="</li>",++t}$("#gvCentro").html(a),$("#pnlViewCentro").removeClass("hide"),$("#emptyStateCentros").addClass("hide"),precargaExp("#pnlCentros >.gp-body > .container-body",!1)}else $("#pnlViewCentro").addClass("hide"),$("#emptyStateCentros").removeClass("hide")},error:function(e){console.log(e)}})}function registrarPosicion(){navigator.geolocation?0==is__setted__question_location?MessageBox({content:"¿Quiere saber qu&eacute; local est&aacute; cerca de usted?",width:"320px",height:"130px",buttons:[{primary:!0,content:"OK",onClickButton:function(e){is__setted__question_location=!0,iniciarRegistroPosicion()}}],cancelButton:!0}):iniciarRegistroPosicion():MessageBox({title:"TAMBOAPP dice",content:"Geolocalización no soportada para este navegador",width:"320px",height:"150px",cancelButton:!0})}function exitoRegistroPosicion(e){if(registrandoPosicion){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);ultimaPosicionUsuario=t,1==is__built__map&&1==context__map&&marcadorUsuario.setPosition(t)}else registrandoPosicion=!0,ultimaPosicionUsuario=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),0==is__built__map&&1==context__map&&ConstruirMapa();if(1==is__built__map&&1==context__map&&(mapa.panTo(ultimaPosicionUsuario),0!=lugar__destino)){var a=google.maps.geometry.spherical.computeDistanceBetween(ultimaPosicionUsuario,lugar__destino);console.log(a),a<1e3?habilitarControl("#btnConfirmarUbicacion",!0):(1==flg_show__message__distance&&(MessageBox({title:"TAMBOAPP dice",content:"Aún no estás en el lugar, acércate a donde quieres ir para confirmar tu ubicación y procesar tu pedido",width:"320px",height:"230px",cancelButton:!0}),flg_show__message__distance=!1),habilitarControl("#btnConfirmarUbicacion",!1))}}function falloRegistroPosicion(e){console.log("No se pudo determinar la ubicación"),MessageBox({title:"TAMBOAPP dice",content:"No se pudo determinar la ubicación: ERROR("+err.code+"): "+err.message,width:"320px",height:"200px",cancelButton:!0}),limpiarUbicacion()}function limpiarUbicacion(){ultimaPosicionUsuario=new google.maps.LatLng(0,0),marcadorUsuario&&(marcadorUsuario.setMap(null),marcadorUsuario=null)}function iniciarRegistroPosicion(){registrandoPosicion?(registrandoPosicion=!1,navigator.geolocation.clearWatch(idRegistroPosicion),limpiarUbicacion()):idRegistroPosicion=navigator.geolocation.watchPosition(exitoRegistroPosicion,falloRegistroPosicion,{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})}function ConstruirMapa(){console.log(lugar__destino);var e={zoom:14,scrollwheel:!0,center:lugar__destino,mapTypeId:google.maps.MapTypeId.ROADMAP};mapa=new google.maps.Map(document.getElementById("google-map"),e),marcadorUsuario=new google.maps.Marker({position:ultimaPosicionUsuario,icon:{path:google.maps.SymbolPath.CIRCLE,strokeColor:"#336699",scale:10},draggable:!1,map:mapa});new google.maps.Marker({position:lugar__destino,draggable:!1,map:mapa}),new google.maps.Polyline({path:[ultimaPosicionUsuario,lugar__destino],strokeColor:"#0DA6DA",strokeOpacity:1,strokeWeight:10,map:mapa});marcadorUsuario.setPosition(ultimaPosicionUsuario),is__built__map=!0}function showModalUbicacion(){flg_show__message__distance=!0,openModalCallBack("#modalConfirmUbicacion",function(){registrarPosicion()})}function showLocal(e){var t=e.getAttribute("data-idempresa"),a=e.getAttribute("data-idcentro"),o=e.getAttribute("data-lat"),n=e.getAttribute("data-lng"),r=1,i=Number(e.getAttribute("data-importe"));$("#hdIdEmpresa").val(t),$("#hdIdCentro").val(a),$("#hdCantidad").val(r),$("#hdPrecio").val(i);var s=e.getElementsByClassName("image__centro")[0].getAttribute("data-src");"no-set"==s&&(s="images/if_business-work_9_2377637.png"),$("#imgLogo__Local").attr("src",s);var c=e.getElementsByClassName("resultItem-name")[0].textContent,d=e.getElementsByClassName("resultItem-address")[0].textContent,l=e.getElementsByClassName("rating-ratingValue")[0].textContent;document.getElementById("lblTitle__Local").textContent=c,document.getElementById("lblAddress__Local").textContent=d,document.getElementById("lblCounter__Local").textContent=l;var u=new google.maps.LatLng(o,n);lugar__destino=u;var p=i*r;$("#hdSubTotal").val(p.toFixed(2)),console.log(u),VerLocal()}$(function(){getParameterByName("screenmode");$("#btnActualizarViewArticles__Portada").on("click",function(e){e.preventDefault(),ListarArticulos__Portada("1")}),$("#pnlLocal > .modal-example-body > .scrollbarra").scroll(function(e){var t=$(".hide-tab-scrollbar"),a="absolute"==t.css("position"),o=400;document.documentElement.clientWidth<480&&(o=260),$(this).scrollTop()>o&&!a&&$(".hide-tab-scrollbar").addClass("fixedElement"),$(this).scrollTop()<o&&a&&$(".hide-tab-scrollbar").removeClass("fixedElement")}),ListarArticulos__Portada("1"),$("#btnActualizarUbicacion").on("click",function(e){e.preventDefault(),registrarPosicion()}),$("#btnVerUbicacion, #next").on("click",function(e){e.preventDefault(),context__map=!0,showModalUbicacion()}),$("#btnConfirmarUbicacion").on("click",function(e){e.preventDefault(),Ambientes()}),$("#gvCentro").on("click",'button[data-action="choose"]',function(e){e.stopPropagation(),e.preventDefault();var t=getParentsUntil(this,"#gvCentro",".dato");t=t[0],showLocal(t)}),$("#gvCentro").on("click",".resultItem",function(e){e.preventDefault();var t=this;showLocal(t)}),$("#txtArticulo").on("keydown",function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $(this).blur(),precargaExp("#pnlArticulo > .gp-body > .container-body",!0),ListarArticulos__Portada("1"),!1}),$("#txtArticulo").easyAutocomplete({url:function(e){var t="services/cartadia/cartadia-search.php";return t+="?tipoconsulta=COMENSAL",t+="&tipobusqueda=2",t+="&tipomenu=01",t+="&criterio="+e},getValue:function(e){return e.nombreProducto},list:{onChooseEvent:function(){precargaExp("#pnlArticulo > .gp-body > .container-body",!0),ListarArticulos__Portada("1")}},template:{type:"custom",method:function(e,t){return'<i class="material-icons">&#xE56C;</i><span class="text grey-text text-darken-4">'+t.nombreProducto+"</span>"}},theme:"bootstrap"}),$("#gvArticulo").on("click",'a[data-action="add"]',function(e){e.preventDefault();var t=getParentsUntil(this,"#gvArticulo",".dato"),a=(t[0].getAttribute("data-iditem"),t[0].getAttribute("data-nombreProducto"));$("#hdNombreArticulo").val(a),VerSedes()}),$("#btnBackToArticles__FromOrdenes").on("click",function(e){e.preventDefault(),$("#pnlOrden").fadeOut("400",function(){$("#pnlArticulo").fadeIn("400",function(){})})}),$("#btnBackToSede__FromArticles").on("click",function(e){e.preventDefault(),$("#pnlCentros").fadeOut("400",function(){$("#pnlArticulo").fadeIn("400",function(){})})}),$("#btnBackToSede__FromOrdenes").on("click",function(e){e.preventDefault(),$("#pnlOrden").fadeOut("400",function(){$("#pnlCentros").fadeIn("400",function(){})})}),$("#btnVerPedido").on("click",function(e){e.preventDefault(),VerOrden__FromArticulo()}),$("#btnSeleccionarMesa").on("click",function(e){e.preventDefault(),seleccionarMesa()}),$("#btnChangeViewOrder").on("click",function(e){e.preventDefault();var t=this;"articles"==t.getAttribute("data-currentview")?(t.setAttribute("data-currentview","orders"),t.setAttribute("title","Ver articulos"),t.setAttribute("data-original-title","Ver articulos"),$("#btnAddArticles").addClass("hide"),$("#pnlOrdenArticulos .articulos").fadeOut(400,function(){$("#pnlOrdenArticulos .ordenes").fadeIn(400)}),$(this).find(".i__orders").animate({opacity:0},400,function(){$(t).find(".i__articles").animate({opacity:1},400,$.noop())})):(t.setAttribute("data-currentview","articles"),t.setAttribute("title","Ver ordenes"),t.setAttribute("data-original-title","Ver ordenes"),$("#pnlOrdenArticulos .ordenes").fadeOut(400,function(){$("#pnlOrdenArticulos .articulos").fadeIn(400,function(){})}),$(this).find(".i__articles").animate({opacity:0},400,function(){$(t).find(".i__orders").animate({opacity:1},400,$.noop())})),$(t).tooltip()}),$("#btnHideSearchBarArticles").on("click",function(e){e.preventDefault(),$("#barSearchArticulos").addClass("hide")}),$("#btnBuscarArticulo").on("click",function(e){e.preventDefault(),$("#barSearchArticulos").removeClass("hide")}),$("#btnHideSearchBarSedes").on("click",function(e){e.preventDefault(),$(this).addClass("hide"),$("#barSearchSedes").addClass("hide")}),$("#btnBuscarSede").on("click",function(e){e.preventDefault(),$("#btnHideSearchBarSedes").removeClass("hide"),$("#barSearchSedes").removeClass("hide")}),$("#btnAgruparMesas").on("click",function(e){e.preventDefault(),AgruparMesas()}),$("#btnSepararMesas").on("click",function(e){e.preventDefault(),MessageBox({content:"¿Desea separar las mesas?",width:"320px",height:"130px",buttons:[{primary:!0,content:"SEPARAR MESAS",onClickButton:function(e){SepararMesas()}}],cancelButton:!0})}),$("#carousel-example-generic").on("slid.bs.carousel",function(e){var t=e.relatedTarget,a=t.getAttribute("data-idambiente");$("#hdIdAmbiente").val(a),ListarMesas(a),ListarMesasGroup(a)}),$("#btnConfirmOrder").on("click",function(e){e.preventDefault(),ConfirmarOrden()}),$("#btnRemoveOrder").on("click",function(e){e.preventDefault(),MessageBox({content:"¿Desea eliminar la orden seleccionada?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarOrden()}}],cancelButton:!0})}),$("#btnLiberarMesas").on("click",function(e){e.preventDefault(),CambiarEstado("00")}),$("#btnReservarMesas").on("click",function(e){e.preventDefault(),CambiarEstado("01")}),$("#btnMesasBack").on("click",function(e){e.preventDefault(),gvMesas.removeSelection()}),$("#btnMesasGroupBack").on("click",function(e){e.preventDefault(),gvMesasGroup.removeSelection()}),$("#pnlMesas .mdl-layout__header").on("click",".view-button",function(e){e.preventDefault();var t=this.getAttribute("data-view");$(this).parent().find(".btn-success").removeClass("btn-success"),$(this).addClass("btn-success"),$("#carousel-example-generic .pane-carousel").addClass("hide"),$("#carousel-example-generic .pane-carousel."+t).removeClass("hide")}),$("#btnAddArticles").on("click",function(e){e.preventDefault(),nuevaOrden()}),$("#gvOrdenes").on("click","button",function(e){e.preventDefault(),"delete"==this.getAttribute("data-action")&&eliminarArticulo(this)}),$("#btnPayOrder").on("click",function(e){e.preventDefault();var t=config.caja.id,a=window.top.document.querySelector('.mdl-card[data-id="'+t+'"]');window.top.navigateInFrame("00",a,function(e){var t=$("#hdIdAtencion").val();e.getOrden(t)})})});var idempresa__old=0,idcentro__old=0,arrAgregado=[],is__setted__question_location=!1,is__built__map=!1,context__map=!1,registrandoPosicion=!1,lugar__destino=!1,flg_show__message__distance=!0,idRegistroPosicion,ultimaPosicionUsuario,marcadorUsuario,mapa,gvMesas,gvMesasGroup,_ACTIVITY="",gvArticulo=new DataList("#gvArticulo",{onSearch:function(){ListarArticulos__Portada(gvArticulo.currentPage())}}),gvArticulo__Individual=new DataList("#gvArticulo__Individual",{onSearch:function(){ListarArticulos__Individual(gvArticulo__Individual.currentPage())}}),x=0;