function MostrarMesas__onupdate(){MostrarMesas(!0)}function MostrarAmbientes(e,t){var a="undefined"!=typeof e?e:$("#hdIdEmpresa").val(),i="undefined"!=typeof t?t:$("#hdIdCentro").val();$.ajax({url:"services/ambientes/ambientes-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:a,idcentro:i,criterio:""},success:function(e){var t=0,a=e.length,i="";if(a>0)for(;t<a;)i+='<div data-idambiente="'+e[t].tm_idambiente+'" class="item'+(0==t?" active":"")+' all-height"><div class="generic-panel gp-no-footer"><div class="gp-header"><h3 class="text-center">'+e[t].tm_nombre+"</h3></div>",i+='<div class="gp-body">',i+='<div class="mdl-grid mdl-grid--no-spacing all-height">',i+='<div class="mdl-cell mdl-cell--6-col all-height">',i+='<div class="mesas scrollbarra" class="gridview all-height" data-selected="none" data-multiselect="false" data-actionbar="mesas-actionbar"><div class="gridview-container mdl-grid"></div></div>',i+="</div>",i+='<div class="mdl-cell mdl-cell--6-col">',i+='<div class="grupos scrollbarra" class="gridview all-height" data-selected="none" data-multiselect="false" data-actionbar="grupos-actionbar"><div class="gridview-container mdl-grid"></div></div>',i+="</div>",i+="</div>",i+="</div>",i+="</div>",i+="</div>",++t;$(".carousel-inner").html(i),$(".carousel").carousel({interval:!1,wrap:!0,keyboard:!0}),initGvMesas(),initGvMesasGroup(),MostrarMesas()},error:function(e){console.log(e)}})}function buildMenu(e,t){var a="",i=0,n=e.length,r="*#gvArticuloMenu tbody";if(n>0){for(;i<n;){var o=Number(e[i].td_precio);a+='<tr data-idmodel="'+e[i].tm_idproducto+'" class="dato">',a+='<td><label class="mdl-input-js mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect check-filled" for="chkDetalle'+i+'"><input name="mc_articulo['+i+'][idproducto]" type="checkbox" id="chkDetalle'+i+'" class="mdl-checkbox__input check-articulo" value="'+e[i].tm_idproducto+'"><span class="mdl-checkbox__label"></span></label><input name="mc_articulo['+i+'][iddetalle]" type="hidden" id="iddetalle'+i+'" value="0" /></td>',a+='<td data-title="Articulo" class="v-align-middle nombre-articulo">'+e[i].nombreProducto,a+='<input type="hidden" class="subtotal" name="mc_articulo['+i+'][subtotal]" id="subtotal'+i+'" value="'+o.toFixed(2)+'" />',a+='<div class="mdl-input-js mdl-textfield mdl-js-textfield no-padding full-size"><input class="mdl-textfield__input observacion hide" type="text" name="mc_articulo['+i+'][observacion]" id="observacion'+i+'" placeholder="Ingresa aqu&iacute; m&aacute;s detalles sobre el art&iacute;culo" value=""><label class="mdl-textfield__label" for="observacion'+i+'"></label></div>',a+="</td>",a+='<td data-title="Cantidad">',a+='<div class="mdl-input-js mdl-textfield mdl-js-textfield no-padding full-size"><input disabled class="mdl-textfield__input align-right cantidad" type="number" step="any" name="mc_articulo['+i+'][cantidad]" id="cantidad'+i+'" value="1"><label class="mdl-textfield__label" for="cantidad'+i+'"></label></div>',a+="</td>",a+='<td data-title="Precio">',a+='<div class="mdl-input-js mdl-textfield mdl-js-textfield no-padding full-size"><input readonly class="mdl-textfield__input align-right precio" type="text" name="mc_articulo['+i+'][precio]" id="precio'+i+'" value="'+o.toFixed(2)+'"><label class="mdl-textfield__label" for="precio'+i+'"></label></div>',a+="</td>",a+="</tr>",++i}"1"==t?$(r).html(a):$(r).append(a),registerScriptMDL(r+" .mdl-input-js")}else"1"==t&&$(r).html("")}function ListarArticulos_Individual(e){var t=$("#txtBuscarArticulos").val();precargaExp("#pnlOrden",!0),$.ajax({type:"GET",url:"services/cartadia/cartadia-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),tipomenu:"01",idgrupo:0,criterio:t,pagina:e},success:function(t){buildMenu(t,e),precargaExp("#pnlOrden",!1)},error:function(e){console.log(e)}})}function ListarArticulos_Carta(e){var t=$("#txtBuscarArticulos").val();precargaExp("#pnlOrden",!0),$.ajax({type:"GET",url:"services/cartadia/cartadia-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),tipomenu:"00",idcarta:0,criterio:t,pagina:e},success:function(t){buildMenu(t,e),precargaExp("#pnlOrden",!1)},error:function(e){console.log(e)}})}function ListarArticulos_Menu(e){var t=$("#txtBuscarArticulos").val();precargaExp("#pnlOrden",!0),$.ajax({type:"GET",url:"services/cartadia/cartadia-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"3",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),tipomenu:"03",idgrupo:0,criterio:t,pagina:e},success:function(t){var a=0,i="",n=0,r="#gvArticuloPack",o="",s="",c=_.groupBy(t,function(e){return e.tm_idgrupoarticulo+"#"+e.nombrepack+"#"+e.tm_idmoneda+"#"+e.simboloMoneda+"#"+e.td_precio}),d=_.map(c,function(e){return{tm_idgrupoarticulo:e[0].tm_idgrupoarticulo,nombrepack:e[0].nombrepack,tm_idmoneda:e[0].tm_idmoneda,simboloMoneda:e[0].simboloMoneda,td_precio:e[0].td_precio,list_secciones:extract_secciones(e)}}),l=d.length;if(console.log(l),l>0){for(;a<l;){var u=0,p=d[a].list_secciones,m=0;if(m=1==p.length?0==p[0].td_nombreseccion.trim().length?0:1:p.length,m>0){for(o+='<li class="tab col s3">',o+='<a href="#tab_menu'+d[a].tm_idgrupoarticulo+'" class="dato">'+d[a].nombrepack+" ("+d[a].simboloMoneda+" "+d[a].td_precio+")",o+='<input type="checkbox" class="hide" name="mc_menuarticulo['+a+'][idproducto]" id="chkDetalleMenu'+a+'" value="'+d[a].tm_idgrupoarticulo+'" />',o+='<input type="hidden" id="lista_subarticulos'+a+'" name="mc_menuarticulo['+a+'][lista_subarticulos]" class="lista_subarticulos" value="">',o+='<input type="hidden" id="precio_menu'+a+'" name="mc_menuarticulo['+a+'][precio]" class="precio" value="'+d[a].td_precio+'">',o+='<input type="hidden" id="subtotal_menu'+a+'" name="mc_menuarticulo['+a+'][subtotal]" class="subtotal" value="'+d[a].td_precio+'">',o+="</a>",o+="</li>",s+='<div id="tab_menu'+d[a].tm_idgrupoarticulo+'" class="panel-tab-menu col s12">';u<m;){if("undefined"!=typeof p[u]){s+='<div class="panel panel-info item-pack">',s+='<div class="panel-heading"><h3 class="panel-title">'+p[u].td_nombreseccion+"</h3></div>";var v=0,h=p[u].list_articulos,n=0;if(n=1==h.length?0==h[0].nombreProducto.trim().length?0:1:h.length,s+='<div class="panel-body no-padding"><ul class="list-group no-margin no-padding">',n>0)for(;v<n;)s+='<a data-idproducto="'+h[v].tm_idproducto+'" href="#" class="list-group-item">'+h[v].nombreProducto+"</a>",++v;s+="</ul></div></div>"}++u}s+="</div>"}++a}i+='<div class="gp-header">',i+='<ul class="tabs">',i+=o,i+="</ul>",i+="</div>",i+='<div class="gp-body"><div class="scrollbarra padding10">',i+=s,i+="</div></div>",i+='<div class="gp-footer">',i+='<div class="col-md-12">',i+='<div class="input-field right">',i+='<label for="txtCantidad">Cantidad</label>',i+='<input type="number" id="txtCantidad" name="txtCantidad" disabled class="validate text-right" value="1">',i+="</div>",i+="</div>",i+='<div class="col-md-9 hide">',i+='<div class="input-field">',i+='<label for="txtObservacion">Observaciones</label>',i+='<input type="text" id="txtObservacion" class="validate text-right">',i+="</div>",i+="</div>",i+="</div>",$(r).html(i),$("ul.tabs").tabs().find("a:first").trigger("click")}else"1"==e&&$(r).html("");precargaExp("#pnlOrden",!1)},error:function(e){console.log(e)}})}function showMenuRestaurante(){var e=$("#pnlViewAllArticles .view-button.active").attr("data-action");"view-menu"==e?ListarArticulos_Menu("1"):"view-card"==e?ListarArticulos_Carta("1"):ListarArticulos_Individual("1")}function Ambientes(e,t){$("#pnlLocal").fadeOut(300,function(){$("#pnlMesas").fadeIn(300,function(){MostrarAmbientes(e,t)})})}function Ordenes(e,t){pnlMesas.fadeOut(300,function(){pnlOrden.removeClass("hide"),pnlOrden.fadeIn(300,function(){$("#pnlOrden > .gp-header .mdl-layout-title").text("Mesa: "+t),showMenuRestaurante(),listarDetalle(e)})})}function MostrarMesas(e){var t=$("#carousel-example-generic").find(".item.active"),a=t.attr("data-idambiente");$("#hdIdAmbiente").val(a),"undefined"!=typeof e&&precarga_OverLayer(".page-region",!0,{mensaje:"Las mesas se estÃ¡n actualizando, espere unos minutos..."}),ListarMesas(a,e),ListarMesasGroup(a,e)}function ListarMesas(e,t){var a='#carousel-example-generic .item[data-idambiente="'+e+'"]',i=a+" .mesas .gridview-container";precargaExp(a,!0),$.ajax({url:"services/ambientes/mesas-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"GROUP-MESAS",tipo:"1U",idambiente:e},success:function(e){var n="",r=0,o=e.length;if(o>0)for(;r<o;)n+='<div class="dato mdl-cell mdl-cell--3-col mdl-cell--2-col-phone pos-rel mdl-card" ',n+='data-idatencion="'+e[r].tm_idatencion+'" ',n+='data-nroatencion="'+e[r].tm_nroatencion+'" ',n+='data-idmesa="'+e[r].idgrupomesa+'" ',n+='data-tipomesa="'+e[r].ta_tipomesa+'" ',n+='data-state="'+e[r].estadomesa_group+'" ',n+='style="background-color: '+e[r].color_leyenda_group+';">',n+='<input type="checkbox" name="chkMesa[]" value="'+e[r].idgrupomesa+'" />',n+='<i class="icon-select place-top-right margin10 material-icons white-text circle">done</i><div class="layer-select"></div>',n+='<div style="width: 64px; height:48px;" class="centered"><h1 class="text-center white-text nombremesa">'+e[r].codigo_group+"</h1></div>",n+="</div>",++r;else n="<h2>No se encontraron resultados.</h2>";$(i).html(n),precargaExp(a,!1),"undefined"!=typeof t&&precarga_OverLayer(".page-region",!1)},error:function(e){console.log(e)}})}function ListarMesasGroup(e,t){var a='#carousel-example-generic .item[data-idambiente="'+e+'"]',i=a+" .grupos .gridview-container";precargaExp(a,!0),$.ajax({url:"services/ambientes/mesas-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"GROUP-MESAS",tipo:"1G",idambiente:e},success:function(e){var n="",r=0,o=_.groupBy(e,function(e){return e.idgrupomesa+"#"+e.ta_tipomesa+"#"+e.codigo_group+"#"+e.comensales_group+"#"+e.estadomesa_group+"#"+e.color_leyenda_group}),s=_.map(o,function(e){return{tm_idatencion:e[0].tm_idatencion,tm_nroatencion:e[0].tm_nroatencion,idgrupomesa:e[0].idgrupomesa,ta_tipomesa:e[0].ta_tipomesa,codigo_group:e[0].codigo_group,comensales_group:e[0].comensales_group,estadomesa_group:e[0].estadomesa_group,color_leyenda_group:e[0].color_leyenda_group,list_mesas:e}}),c=s.length;if(c>0)for(;r<c;){var d="",l=0,u=0;if(s[r].codigo_group.trim().length>0)d=s[r].codigo_group;else if(l=1==mesas.length&&0==mesas[0].tm_codigo.trim().length?0:mesas.length,l>0)for(;u<l;)d+=mesas[u].tm_codigo,++u;n+='<div class="dato mdl-cell mdl-cell--6-col mdl-cell--6-col-phone pos-rel mdl-card" ',n+='data-idatencion="'+s[r].tm_idatencion+'" ',n+='data-nroatencion="'+s[r].tm_nroatencion+'" ',n+='data-idmesa="'+s[r].idgrupomesa+'" ',n+='data-tipomesa="'+s[r].ta_tipomesa+'" ',n+='data-state="'+s[r].estadomesa_group+'" ',n+='style="background-color: '+s[r].color_leyenda_group+';">',n+='<input type="checkbox" name="chkGrupos[]" value="'+s[r].idgrupomesa+'" />',n+='<i class="icon-select place-top-right margin10 material-icons white-text circle">done</i><div class="layer-select"></div>',n+='<div style="width: 84px; height:84px;" class="centered"><h1 class="text-center white-text nombremesa">'+d+"</h1></div>",n+="</div>",++r}else n="<h2>No se encontraron resultados.</h2>";$(i).html(n),precargaExp(a,!1),"undefined"!=typeof t&&precarga_OverLayer(".page-region",!1)},error:function(e){console.log(e)}})}function ListarAgregadosArticulo(e){var t=$("#pnlViewAllArticles .view-button.active").attr("data-tipomenudia");$("#hdTipoMenuDia").val(t),$.ajax({type:"GET",url:"services/productos/productos-agregados-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),tipomenudia:t},success:function(t){arrAgregado=t,"view-menu"==e?($("#gvArticuloPack").removeClass("hide"),$("#gvArticuloMenu").addClass("hide"),ListarArticulos_Menu("1")):($("#gvArticuloPack").addClass("hide"),$("#gvArticuloMenu").removeClass("hide"),"view-card"==e?ListarArticulos_Carta("1"):ListarArticulos_Individual("1"))},error:function(e){console.log(error)}})}function crearItemArticulo(e,t,a,i,n,r,o){var s="",c=Number(r).toFixed(2);return s+='<tr data-iditem="'+e+'">',s+='<td data-title="Articulo" class="v-align-middle nombre-articulo">'+a+"</td>",s+='<td data-title="Cantidad">'+i+"</td>",s+='<td data-title="Precio">'+c+"</td>",s+='<td class="pos-rel"><button class="mdl-button mdl-button--icon" data-action="delete"><i class="material-icons">&#xE872;</i></td>',s+="</tr>"}function listarDetalle(e){$.ajax({url:"services/atencion/detallearticulo-search.php",type:"GET",data:{tipo:"2",idatencion:e},dataType:"json",cache:!1,success:function(e){var t=crearItems_Articulos(e),a=t.count_articulos,i=t.strhtml_articulos,n=t.total_orden;$("#gvOrdenes tbody").html(i),$("#lblTotalFromOrder .monto").text(Number(n).toFixed(2)),a>0&&("02"==$("#hdEstadoMesa").val()?$("#btnConfirmOrder").removeClass("hide"):$("#btnConfirmOrder").addClass("hide"),"05"!=$("#hdEstadoMesa").val()&&$("#btnPayOrder").removeClass("hide"))},error:function(e){console.log(e)}})}function agregarArticulos(e){var t=new FormData;t.append("btnAddArticles","btnAddArticles"),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),t.append("hdIdAmbiente",$("#hdIdAmbiente").val()),t.append("hdIdAtencion",e),t.append("hdTipoMenuDia",$("#hdTipoMenuDia").val()),t.append("txtCantidad",$("#txtCantidad").val()),t.append("txtObservacion",$("#txtObservacion").val());var a="03"==$("#hdTipoMenuDia").val()?"#gvArticuloPack":"#gvArticuloMenu",i=$(a+" :input").serializeArray();Array.prototype.forEach.call(i,function(e){t.append(e.name,e.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){"0"!=t.rpta&&($("#btnConfirmOrder").removeClass("hide"),listarDetalle(e))},error:function(e){console.log(e)}})}function eliminarArticulo(e){var t=getParentsUntil(e,"#gvOrdenes","tr"),a=t[0].getAttribute("data-iditem");MessageBox({content:"Â¿Desea quitar este item?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Quitar item",onClickButton:function(e){var i=new FormData;i.append("btnRemoveArticles","btnRemoveArticles"),i.append("hdIdArticuloOrden",a),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:i,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&$(t[0]).remove()},error:function(e){console.log(e)}})}}],cancelButton:!0})}function nuevaOrden(){var e=new FormData;$("#hdNombrePersonal").val();e.append("btnNuevaOrden","btnNuevaOrden"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAmbiente",$("#hdIdAmbiente").val()),e.append("hdIdAtencion",$("#hdIdAtencion").val()),e.append("hdIdMesa",$("#hdIdMesa").val()),e.append("hdTipoMesa",$("#hdTipoMesa").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){var t=e.rpta;e.contenidomsje;createSnackbar(e.titulomsje),"0"!=t&&($("#hdIdAtencion").val(t),agregarArticulos(t),MostrarMesas())},error:function(e){console.log(e)}})}function crearItems_Articulos(e){var t=0,a=0,i="",n=0;if(a=1==e.length?0==e[0].nombreProducto.trim().length?0:1:e.length,a>0)for(;t<a;){if("undefined"!=typeof e[t]){var r=Number(e[t].td_subtotal);i+=crearItemArticulo(e[t].td_idatencion_articulo,e[t].tm_idproducto,e[t].nombreProducto,Number(e[t].td_cantidad).toFixed(0),Number(e[t].td_precio).toFixed(2),e[t].td_subtotal,e[t].td_observacion),n+=r}++t}return{count_articulos:a,strhtml_articulos:i,total_orden:n}}function CambiarEstado(e){var t=new FormData,a=$("#carousel-example-generic").find(".item.active"),i=a.attr("data-idambiente"),n='#carousel-example-generic .item[data-idambiente="'+i+'"]',r=n+" .gridview-container",o=$(r+" :input").serializeArray();t.append("btnCambiarEstado","btnCambiarEstado"),t.append("hdEstadoMesa",e),t.append("hdIdEmpresa",$("#hdIdEmpresa").val()),t.append("hdIdCentro",$("#hdIdCentro").val()),Array.prototype.forEach.call(o,function(e){t.append(e.name,e.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(gvMesas.removeSelection(),gvMesasGroup.removeSelection(),MostrarMesas())},error:function(e){console.log(e)}})}function ConfirmarOrden(){var e=new FormData;e.append("btnConfirmOrder","btnConfirmOrder"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAtencion",$("#hdIdAtencion").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&($("#btnBackToRooms").trigger("click"),MostrarMesas())},error:function(e){console.log(e)}})}function EliminarOrden(){var e=new FormData;e.append("btnRemoveOrder","btnRemoveOrder"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAtencion",$("#hdIdAtencion").val()),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&($("#btnBackToRooms").trigger("click"),MostrarMesas())},error:function(e){console.log(e)}})}function AgruparMesas(){var e=new FormData;e.append("btnAgruparMesas","btnAgruparMesas"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),e.append("hdIdAmbiente",$("#hdIdAmbiente").val());var t=$(".mesas :input").serializeArray();Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(gvMesas.removeSelection(),MostrarMesas())},error:function(e){console.log(e)}})}function SepararMesas(){var e=new FormData;e.append("btnSepararMesas","btnSepararMesas"),e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val());var t=$(".grupos :input").serializeArray();Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({url:"services/atencion/atencion-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&(gvMesasGroup.removeSelection(),MostrarMesas())},error:function(e){console.log(e)}})}function initGvMesas(){gvMesas=new DataList("#carousel-example-generic .mesas",{actionbar:"#mesas-actionbar",onSearch:function(){},oneItemClick:function(e){var t=e.target,a=getParentsUntil(t,"#carousel-example-generic .mesas",".dato");a=a[0];var i=a.getAttribute("data-idatencion"),n=a.getAttribute("data-idmesa"),r=a.getAttribute("data-tipomesa"),o=a.getAttribute("data-state"),s=$(a).find(".nombremesa").text();$("#hdIdAtencion").val(i),$("#hdIdMesa").val(n),$("#hdTipoMesa").val(r),$("#hdEstadoMesa").val(o),Ordenes(i,s)}})}function initGvMesasGroup(){gvMesasGroup=new DataList("#carousel-example-generic .grupos",{actionbar:"#grupos-actionbar",onSearch:function(){},oneItemClick:function(e){var t=e.target,a=getParentsUntil(t,"#carousel-example-generic .grupos",".dato");a=a[0];var i=a.getAttribute("data-idatencion"),n=a.getAttribute("data-idmesa"),r=a.getAttribute("data-tipomesa"),o=a.getAttribute("data-state"),s=$(a).find(".nombremesa").text();$("#hdIdAtencion").val(i),$("#hdIdMesa").val(n),$("#hdTipoMesa").val(r),$("#hdEstadoMesa").val(o),Ordenes(i,s)}})}function BackToRooms(){$("#hdIdAtencion").val("0"),$("#hdIdMesa").val("0"),$("#hdTipoMesa").val("0"),$("#hdEstadoMesa").val("00"),pnlOrden.fadeOut(300,function(){pnlOrden.addClass("hide"),pnlMesas.fadeIn(300,function(){$("#btnPayOrder, #btnRemoveOrder, #btnAddArticles, #btnConfirmOrder").addClass("hide")})})}function InitBuscarUbicacion(){function e(){s?(s=!1,navigator.geolocation.clearWatch(r),i()):r=navigator.geolocation.watchPosition(t,a,{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})}function t(e){if(s){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);o=t}else s=!0,o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);n()}function a(){console.log("No se pudo determinar la ubicaciÃ³n"),i()}function i(){o=new google.maps.LatLng(0,0)}function n(){$.ajax({url:"services/centro/centro-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"3",id:$("#hdIdRegion").val()},success:function(e){var t=0,a=e.length;if(a>0){for(;t<a;){var i=e[t].tm_latitud,n=e[t].tm_longitud,r=new google.maps.LatLng(i,n),s=google.maps.geometry.spherical.computeDistanceBetween(o,r);e[t].distancia=s,++t}var c=e.sort(function(e,t){return e.distancia-t.distancia});$("#txtDireccion").easyAutocomplete({data:c,getValue:function(e){return e.NombreEmpresa+" - "+e.tm_direccion+" - (a "+Number(e.distancia).toFixed(2)+" metros de distancia)"},list:{onSelectItemEvent:function(){var e=$("#txtDireccion").getSelectedItemData().tm_idempresa,t=$("#txtDireccion").getSelectedItemData().tm_idcentro;$("#hdIdEmpresa").val(e),$("#hdIdCentro").val(t)}},template:{type:"custom",method:function(e,t){return t.NombreEmpresa+" - "+t.tm_direccion+" - (a "+Number(t.distancia).toFixed(2)+" metros de distancia)"}},theme:"square"})}},error:function(e){console.log(e)}})}var r,o,s=!1;$("#btnActualizar").on("click",function(t){t.preventDefault(),createSnackbar("Buscando..."),e()})}function setEmpresaCentro(){var e=new FormData;e.append("hdIdEmpresa",$("#hdIdEmpresa").val()),e.append("hdIdCentro",$("#hdIdCentro").val()),$.ajax({url:"services/home/home-ajax-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){createSnackbar(e.titulomsje),"0"!=e.rpta&&Ambientes(_idempresa,_idcentro)},error:function(e){console.log(e)}})}$(function(){var e=getParameterByName("screenmode");"cliente"==e?(InitBuscarUbicacion(),$("#btnActualizarCentro__OnEmpty, #btnActualizarCentro").on("click",function(e){e.preventDefault(),ListarCentros()})):MostrarAmbientes(),$("#btnChangeViewOrder").on("click",function(e){e.preventDefault();var t=this;"articles"==t.getAttribute("data-currentview")?(t.setAttribute("data-currentview","orders"),t.setAttribute("title","Ver articulos"),t.setAttribute("data-original-title","Ver articulos"),$("#btnAddArticles").addClass("hide"),$("#pnlOrdenArticulos .articulos").fadeOut(400,function(){$("#pnlOrdenArticulos .ordenes").fadeIn(400)}),$(this).find(".i__orders").animate({opacity:0},400,function(){$(t).find(".i__articles").animate({opacity:1},400,$.noop())})):(t.setAttribute("data-currentview","articles"),t.setAttribute("title","Ver ordenes"),t.setAttribute("data-original-title","Ver ordenes"),$("#pnlOrdenArticulos .ordenes").fadeOut(400,function(){$("#pnlOrdenArticulos .articulos").fadeIn(400,function(){showMenuRestaurante()})}),$(this).find(".i__articles").animate({opacity:0},400,function(){$(t).find(".i__orders").animate({opacity:1},400,$.noop())})),$(t).tooltip()}),$("#txtBuscarArticulos").on("keyup",function(e){showMenuRestaurante()}),$("#btnHideSearchBarArticles").on("click",function(e){e.preventDefault(),$("#btnBuscarArticulo").removeClass("hide"),$(this).addClass("hide"),$("#barSearchArticulos").addClass("hide"),$("#pnlViewAllArticles .view-button").removeClass("hide"),$("#pnlViewAllArticles > .mdl-layout__header > .mdl-layout__header-row").removeClass("no-padding-right")}),$("#btnBuscarArticulo").on("click",function(e){e.preventDefault(),$("#btnHideSearchBarArticles").removeClass("hide"),$(this).addClass("hide"),$("#barSearchArticulos").removeClass("hide"),$("#pnlViewAllArticles .view-button").addClass("hide"),$("#pnlViewAllArticles > .mdl-layout__header > .mdl-layout__header-row").addClass("no-padding-right")}),$("#btnAgruparMesas").on("click",function(e){e.preventDefault(),AgruparMesas()}),$("#btnSepararMesas").on("click",function(e){e.preventDefault(),MessageBox({content:"Â¿Desea separar las mesas?",width:"320px",height:"130px",buttons:[{primary:!0,content:"SEPARAR MESAS",onClickButton:function(e){SepararMesas()}}],cancelButton:!0})}),$("#carousel-example-generic").on("slid.bs.carousel",function(e){var t=e.relatedTarget,a=t.getAttribute("data-idambiente");$("#hdIdAmbiente").val(a),ListarMesas(a),ListarMesasGroup(a)}),$("#btnConfirmOrder").on("click",function(e){e.preventDefault(),ConfirmarOrden()}),$("#btnRemoveOrder").on("click",function(e){e.preventDefault(),MessageBox({content:"Â¿Desea eliminar la orden seleccionada?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarOrden()}}],cancelButton:!0})}),$("#btnLiberarMesas").on("click",function(e){e.preventDefault(),CambiarEstado("00")}),$("#btnReservarMesas").on("click",function(e){e.preventDefault(),CambiarEstado("01")}),$("#btnMesasBack").on("click",function(e){e.preventDefault(),gvMesas.removeSelection()}),$("#btnMesasGroupBack").on("click",function(e){e.preventDefault(),gvMesasGroup.removeSelection()}),$("#gvArticuloPack").on("click","ul.tabs a",function(e){e.preventDefault(),$("ul.tabs input:checkbox").prop("checked",!1),$("#gvArticuloPack").find(".item-pack .list-group-item").removeClass("active");var t=this;$(t).find("input:checkbox").prop("checked",!0),$(t.getAttribute("href",2)).find(".item-pack .list-group-item:first-child").addClass("active"),$("#btnAddArticles").removeClass("hide");var a=t.getElementsByClassName("lista_subarticulos")[0];a.value=extraerSubArticulos(t),habilitarControl("#txtCantidad",!0)}),$("#gvArticuloPack").on("click",".list-group-item",function(e){e.preventDefault();var t=getParentsUntil(this,"#gvArticuloPack",".panel-tab-menu"),a=$('ul.tabs a[href="#'+t[0].getAttribute("id")+'"]');if(a.find("input:checkbox")[0].checked){var i=getParentsUntil(this,"#gvArticuloPack",".item-pack");$(i).find(".list-group-item").removeClass("active"),$(this).addClass("active"),$("#btnAddArticles").removeClass("hide");var n=a.find(".lista_subarticulos");n.val(extraerSubArticulos(a[0]))}}),$("#btnBackToRooms").on("click",function(e){e.preventDefault(),BackToRooms()}),$("#pnlViewAllArticles").on("click",".view-button",function(e){e.preventDefault();var t=this.getAttribute("data-action");$(this).parent().find(".active").removeClass("active"),$(this).addClass("active"),$("#btnAddArticles").addClass("hide"),ListarAgregadosArticulo(t)}),$("#gvArticuloMenu").on("click touchend",'.options-add > a[data-action="nothing"]',function(e){e.stopPropagation()}),$("#gvArticuloMenu").on("click touchend",'.options-add > a[data-action="addins"]',function(e){e.preventDefault(),e.stopPropagation();var t=getParentsUntil(this,"#gvArticuloMenu",".dato"),a=this.parentNode,i=$("#pnlViewAllArticles .view-button.active").attr("data-tipomenudia");i+"_"+t[0].getAttribute("data-idmodel");a.classList.contains("fixed")?a.classList.remove("fixed"):($(".options-add").removeClass("fixed"),a.classList.add("fixed"))}),$("#gvArticuloMenu").on("click",".check-addins",function(e){e.stopPropagation()}),$("#gvArticuloMenu").on("keyup",".precio",function(e){var t=this,a=getParentsUntil(t,"#gvArticuloMenu",".dato"),i=a[0].getElementsByClassName("cantidad")[0],n=a[0].getElementsByClassName("subtotal")[0],r=Number(t.value),o=Number(i.value),s=r*o;n.value=s.toFixed(2)}),$("#gvArticuloMenu").on("keyup",".cantidad",function(e){var t=this,a=getParentsUntil(t,"#gvArticuloMenu",".dato"),i=a[0].getElementsByClassName("precio")[0],n=a[0].getElementsByClassName("subtotal")[0],r=Number(i.value),o=Number(t.value),s=r*o;n.value=s.toFixed(2)}),$("*#gvArticuloMenu tbody").on("click",".check-articulo",function(e){e.stopPropagation(),handlerRowCheck(this,"#gvArticuloMenu",e)}),$("*#gvArticuloMenu tbody").on("click","tr",function(e){handlerRowCheck(this,"#gvArticuloMenu",e)}),$("*#gvArticuloMenu tbody").on("click focus","tr .mdl-textfield__input",function(e){"click"==e.type?e.stopPropagation():this.select()}),$("#btnAddArticles").on("click",function(e){e.preventDefault(),nuevaOrden()}),$("#gvOrdenes").on("click","button",function(e){e.preventDefault(),"delete"==this.getAttribute("data-action")&&eliminarArticulo(this)}),$("#btnPayOrder").on("click",function(e){e.preventDefault();var t=config.caja.id,a=window.top.document.querySelector('.mdl-card[data-id="'+t+'"]');window.top.navigateInFrame("00",a,function(e){var t=$("#hdIdAtencion").val();e.getOrden(t)})})});var hdIdEmpresa=$("#hdIdEmpresa"),hdIdCentro=$("#hdIdCentro"),pnlOrden=$("#pnlOrden"),pnlMesas=$("#pnlMesas"),arrAgregado=[],gvMesas,gvMesasGroup,extraerSubArticulos=function(e){var t=$(e.getAttribute("href",2)).find(".list-group-item.active").map(function(){return this.getAttribute("data-idproducto")}).get().join(",");return t},handlerRowCheck=function(e,t,a){if("textbox"!==(a.target||{}).type){var i,n=e,r="";if("#gvArticuloMenu"==t&&(r=".check-articulo"),"checkbox"!==(e||{}).type?(a.preventDefault(),i=e,n=e.querySelector(r),null!=n&&(n.checked=!n.checked,n.parentNode.MaterialCheckbox.checkToggleState())):("#gvArticuloMenu"==t?n.classList.contains(check-articulo.substring(1))&&(i=getParentsUntil(n,t,"tr")):i=getParentsUntil(n,t,"tr"),i=i[0]),null!=i&&"#gvArticuloMenu"==t){var o=i.getElementsByClassName("cantidad")[0],s=(i.getElementsByClassName("precio")[0],i.getElementsByClassName("observacion")[0]);habilitarControl([o],n.checked),n.checked?(i.classList.add("selected"),o.parentNode.classList.remove("is-disabled"),s.classList.remove("hide"),$("#btnAddArticles").removeClass("hide"),o.focus()):(i.classList.remove("selected"),o.parentNode.classList.add("is-disabled"),s.classList.add("hide"),0==$(t).find(".selected").length&&$("#btnAddArticles").addClass("hide"))}}},extract_secciones=function(e){var t=_.groupBy(e,function(e){return e.tp_idseccionpack+"#"+e.td_nombreseccion}),a=_.map(t,function(e){return{tp_idseccionpack:e[0].tp_idseccionpack,td_nombreseccion:e[0].td_nombreseccion,list_articulos:e}});return a},x=0;