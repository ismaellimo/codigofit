function Reporte_Ventas(t){precargaExp("#pnlReports",!0),$.ajax({url:"services/ventas/ventas-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),anhoini:$("#ddlAnhoIni").val(),mesini:$("#ddlMesIni").val(),anhofin:$("#ddlAnhoFin").val(),mesfin:$("#ddlMesFin").val(),isexport:t},success:function(t){var e="",o=t.length,r=0;if(o>0)for(;r<o;)e+="<tr>",e+='<td class="text-center">'+t[r].CUO+"</td>",e+='<td class="text-center">'+t[r].FechaEmision+"</td>",e+='<td class="text-center"></td>',e+='<td class="text-center">'+t[r].Tipo+"</td>",e+='<td class="text-center">'+t[r].Serie+"</td>",e+='<td class="text-center">'+t[r].NroDoc+"</td>",e+='<td class="text-center">'+t[r].CodSunatDocCli+"</td>",e+='<td class="text-center">'+t[r].Numero+"</td>",e+='<td class="text-center">'+t[r].Nombres+"</td>",e+='<td class="text-center">'+t[r].ValorFac+"</td>",e+='<td class="text-center">'+t[r].BaseImponible+"</td>",e+='<td class="text-center">'+t[r].Exonerada+"</td>",e+='<td class="text-center">'+t[r].Inafecta+"</td>",e+='<td class="text-center">'+t[r].ISC+"</td>",e+='<td class="text-center">'+t[r].Impuesto+"</td>",e+='<td class="text-center">'+t[r].OtrosTributos+"</td>",e+='<td class="text-center">'+t[r].ImporteTotal+"</td>",e+='<td class="text-center">'+t[r].TipoCambio+"</td>",e+='<td class="text-center">'+t[r].ReferenciaFecha+"</td>",e+='<td class="text-center">'+t[r].ReferenciaTipo+"</td>",e+='<td class="text-center">'+t[r].ReferenciaSerie+"</td>",e+='<td class="text-center">'+t[r].ReferenciaNroDoc+"</td>",e+="</tr>",++r;$("#gvVenta tbody").html(e),precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_Compras(t){precargaExp("#pnlReports",!0),$.ajax({url:"services/compras/compras-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),anhoini:$("#ddlAnhoIni").val(),mesini:$("#ddlMesIni").val(),anhofin:$("#ddlAnhoFin").val(),mesfin:$("#ddlMesFin").val(),isexport:t},success:function(t){var e="",o=t.length,r=0;if(o>0)for(;r<o;)e+="<tr>",e+='<td class="text-center">'+t[r].CUO+"</td>",e+='<td class="text-center">'+t[r].FechaEmision+"</td>",e+='<td class="text-center">'+t[r].FechaVencimiento+"</td>",e+='<td class="text-center">'+t[r].Tipo+"</td>",e+='<td class="text-center">'+t[r].CodAduana+"</td>",e+='<td class="text-center">'+t[r].AnhoEmisionDUA+"</td>",e+='<td class="text-center">'+t[r].Serie+"-"+t[r].NroDoc+"</td>",e+='<td class="text-center">'+t[r].CodSunatDocCli+"</td>",e+='<td class="text-center">'+t[r].Numero+"</td>",e+='<td class="text-center">'+t[r].Nombres+"</td>",e+='<td class="text-center">'+t[r].BaseImponible_EXPORT_GV+"</td>",e+='<td class="text-center">'+t[r].Impuesto_EXPORT_GV+"</td>",e+='<td class="text-center">'+t[r].BaseImponible_EXPORT_NOGV+"</td>",e+='<td class="text-center">'+t[r].Impuesto_EXPORT_NOGV+"</td>",e+='<td class="text-center">'+t[r].BaseImponible_NOGV+"</td>",e+='<td class="text-center">'+t[r].Impuesto_NOGV+"</td>",e+='<td class="text-center">'+t[r].ValorAdqNoGravada+"</td>",e+='<td class="text-center">'+t[r].ISC+"</td>",e+='<td class="text-center">'+t[r].OtrosTributos+"</td>",e+='<td class="text-center">'+t[r].ImporteTotal+"</td>",e+='<td class="text-center">'+t[r].NroDocDetraccion+"</td>",e+='<td class="text-center">'+t[r].FechaDocDetraccion+"</td>",e+='<td class="text-center">'+t[r].TipoCambio+"</td>",e+='<td class="text-center">'+t[r].ReferenciaFecha+"</td>",e+='<td class="text-center">'+t[r].ReferenciaTipo+"</td>",e+='<td class="text-center">'+t[r].ReferenciaSerie+"</td>",e+='<td class="text-center">'+t[r].ReferenciaNroDoc+"</td>",e+="</tr>",++r;$("#gvCompra tbody").html(e),precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_Caja(t){precargaExp("#pnlReports",!0),$.ajax({url:"services/ventas/caja-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:t,idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),fechaini:$("#txtFechaIni_Caja").val(),fechafin:$("#txtFechaFin").val()},success:function(e){var o="",r="",a=e.length,n=0;if("CUADRE"==t?o="#gvCaja_Cuadre":"EFECTIVO"==t?o="#gvCaja_Efectivo":"IMPUESTOS"==t&&(o="#gvCaja_Impuesto"),a>0)for(;n<a;)r+="<tr>","CUADRE"==t?r+="<td>"+e[n].CuadreCaja+"</td>":"EFECTIVO"==t?r+="<td>"+e[n].EfectivoCaja+"</td>":"IMPUESTOS"==t&&(r+="<td>"+e[n].TipoComprobante+"</td>"),r+='<td class="text-right">'+Number(e[n].Importe).toFixed(2)+"</td>",r+="</tr>",++n;$(o+" tbody").html(r),precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_EstadisticaVentas(){precargaExp("#pnlReports",!0),$.ajax({url:"services/ventas/ventas-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"3",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),anhoini:$("#ddlAnhoIni").val(),mesini:$("#ddlMesIni").val(),anhofin:$("#ddlAnhoFin").val(),mesfin:$("#ddlMesFin").val(),idcliente:$("#hdIdCliente").val()},success:function(t){var e="",o=t.length,r=0;if(o>0)for(;r<o;)e+="<tr>",e+='<td class="text-center">'+t[r].nombreArticulo+"</td>",e+='<td class="text-center">'+Number(t[r].td_cantidad)+"</td>",e+='<td class="text-center">'+Number(t[r].td_precio)+"</td>",e+='<td class="text-center">'+Number(t[r].td_subtotal)+"</td>",e+="</tr>",++r;$("#gvEstadisticaVentas tbody").html(e),precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_Rentabilidad(t,e){precargaExp("#pnlReports",!0),$.ajax({url:"services/insumos/rentabilidad-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),anhoini:$("#ddlAnhoIni").val(),mesini:$("#ddlMesIni").val(),anhofin:$("#ddlAnhoFin").val(),mesfin:$("#ddlMesFin").val(),isexport:e,pagina:t},success:function(t){var e="",o=t.length,r=0;if(o>0)for(;r<o;)e+='<tr><td class="text-center">'+t[r].tr_nombrearticulo+"</td>",e+='<td class="text-center">'+t[r].tr_costo+"</td>",e+='<td class="text-center">'+t[r].tr_precioventa+"</td>",e+='<td class="text-center">'+t[r].tr_rentabilidad+"</td>",e+='<td class="text-center">'+t[r].tr_porcjrentabilidad+"</td></tr>",++r;$("#gvRentabilidad tbody").html(e),precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_ControlStock(t,e){precargaExp("#pnlReports",!0),$.ajax({url:"services/insumos/controlstock-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),fechaini:$("#txtFechaIni").val(),fechafin:$("#txtFechaFin").val(),isexport:e,pagina:t},success:function(o){if(1==e)window.location=o.archivo;else{var r="#gvControlStock tbody",a="",n=o.length,i=0;if(n>0){for(;i<n;)a+="<tr"+(Number(o[i].stock_diferencia)<0?' class="red white-text"':"")+">",a+="<td>"+o[i].insumo+"</td>",a+='<td class="text-center">'+o[i].UM+"</td>",a+='<td class="text-right">'+o[i].stock_almacen+"</td>",a+='<td class="text-right">'+o[i].stock_programado+"</td>",a+='<td class="text-right">'+o[i].stock_diferencia+"</td>",a+="</tr>",++i;gvControlStock.currentPage(gvControlStock.currentPage()+1),"1"==t?$(r).html(a):$(r).append(a)}}precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_ControlStockMinimo(t,e){precargaExp("#pnlReports",!0),$.ajax({url:"services/insumos/controlstock-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"2",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),fechaini:$("#txtFechaIni").val(),fechafin:$("#txtFechaFin").val(),isexport:e,pagina:t},success:function(o){if(1==e)window.location=o.archivo;else{var r="#gvControlStockMinimo tbody",a="",n=o.length,i=0;if(n>0){for(;i<n;){a+="<tr"+(Number(o[i].stock_diferencia)<0?' class="red white-text"':"")+">",a+="<td>"+o[i].insumo+"</td>",a+='<td class="text-center">'+o[i].UM+"</td>",a+='<td class="text-right">'+Number(o[i].stock_almacen).toFixed(3)+"</td>",a+='<td class="text-right">'+Number(o[i].stock_minimo).toFixed(3)+"</td>",a+='<td class="text-right">'+Number(o[i].stock_diferencia).toFixed(3)+"</td>";var s="undefined"!=typeof o[i].stock_porcentaje?o[i].stock_porcentaje:0;a+='<td class="text-right">'+Number(s).toFixed(2)+"</td>",a+="</tr>",++i}gvControlStockMinimo.currentPage(gvControlStock.currentPage()+1),"1"==t?$(r).html(a):$(r).append(a)}}precargaExp("#pnlReports",!1)},error:function(t){console.log(t)}})}function Reporte_DetalleVenta(t){precargaExp("#pnlReports",!0),$.ajax({url:"services/ventas/detalleventas-report.php",type:"GET",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val(),fechaini:$("#txtFechaIni_Caja").val(),fechafin:$("#txtFechaFin").val(),isexport:t},success:function(t){var e="#gvCaja_DetalleVenta tbody",o="",r=t.length,a=0,n=0;if(r>0)for(;a<r;)o+='<td class="text-center">'+t[a].TipoComprobante+" "+t[a].tm_vserie_documento+"-"+t[a].tm_vnumero_documento+"</td>",o+='<td class="text-center">'+t[a].tm_base_imponible+"</td>",o+='<td class="text-center">0.00</td>',o+='<td class="text-center">'+t[a].tm_base_imponible+"</td>",o+='<td class="text-center">'+t[a].tm_impuesto+"</td>",o+='<td class="text-center">'+t[a].tm_total+"</td>",n+=Number(t[a].tm_total),++a;$(e).html(o),$("#lblTotalDetalleVenta").text("TOTAL: S/. "+n.toFixed(2))},error:function(t){console.log(t)}})}function getDataByReference(t){var e=$("#pnlConsulta .mdl-layout-title"),o="";"#gvCaja"==t?(o="Caja",Reporte_Caja("CUADRE"),Reporte_Caja("EFECTIVO"),Reporte_Caja("IMPUESTOS"),Reporte_DetalleVenta(),$("#fechaIni_Control").addClass("hide"),$("#fechaIni_Caja").removeClass("hide"),$("#rowFechas").removeClass("hide"),$(".rowFilterCaja, .rowFilterPeriod, .rowFilterPeriod_Ini, .rowFilterPeriod_Fin").addClass("hide")):($("#fechaIni_Control").removeClass("hide"),$("#fechaIni_Caja").addClass("hide"),$("#rowFechas, .rowFilterCaja").addClass("hide"),"#gvEstadisticaVentas"==t?(o="Estadistica de Ventas",$(".rowFilterPeriod_Ini, .rowFilterPeriod_Fin, #rowCliente, #rowOrden").removeClass("hide"),$("#rowProveedor, #rowOrden").addClass("hide"),Reporte_EstadisticaVentas()):"#gvVenta"==t?(o="Ventas SUNAT",$(".rowFilterPeriod_Ini, .rowFilterPeriod_Fin").removeClass("hide"),$(".rowFilterPeriod, #rowFechas, #rowCliente, #rowProveedor, #rowTipoProducto, #rowCategoria, #rowOrden, #rowOrdenValor").addClass("hide"),Reporte_Ventas(0)):"#gvCompra"==t?(o="Compras SUNAT",$(".rowFilterPeriod_Ini, .rowFilterPeriod_Fin").removeClass("hide"),$(".rowFilterPeriod, #rowFechas, #rowTipoProducto, #rowCliente, #rowProveedor, #rowCategoria, #rowOrden, #rowOrdenValor").addClass("hide"),Reporte_Compras(0)):"#gvRentabilidad"==t?(o="Margen de ganancia",$("#rowFechas, #rowCliente, #rowProveedor, #rowCategoria, #rowOrden").addClass("hide"),$("#rowTipoProducto, #rowOrden, #rowOrdenValor").removeClass("hide"),Reporte_Rentabilidad("1")):"#gvControlStock"==t?(o="Control de stock",$("#rowFechas").removeClass("hide"),$(".rowFilterCaja, .rowFilterPeriod, .rowFilterPeriod_Ini, .rowFilterPeriod_Fin, #rowCliente, #rowProveedor, #rowTipoProducto, #rowCategoria, #rowOrden, #rowOrdenValor").addClass("hide"),Reporte_ControlStock("1",0)):"#gvControlStockMinimo"==t&&(o="Control de stock mÃ­nimo",$("#rowFechas").removeClass("hide"),$(".rowFilterCaja, .rowFilterPeriod, .rowFilterPeriod_Ini, .rowFilterPeriod_Fin, #rowCliente, #rowProveedor, #rowTipoProducto, #rowCategoria, #rowOrden, #rowOrdenValor").addClass("hide"),Reporte_ControlStockMinimo("1",0))),e.text(o)}function MostrarReporte(t){toggleOptions_v2("#pnlFiltro","left"),$("#gvCaja").is(":visible")?t?console.log("sssss"):(Reporte_Caja("CUADRE"),Reporte_Caja("EFECTIVO"),Reporte_Caja("IMPUESTOS"),Reporte_DetalleVenta()):$("#gvVenta").is(":visible")?Reporte_Ventas(t):$("#gvCompra").is(":visible")?Reporte_Compras(t):$("#gvEstadisticaVentas").is(":visible")?Reporte_EstadisticaVentas(t):$("#gvRentabilidad").is(":visible")?Reporte_Rentabilidad("1",t):$("#gvControlStock").is(":visible")?Reporte_ControlStock("1",t):$("#gvControlStockMinimo").is(":visible")&&Reporte_ControlStockMinimo("1",t)}function ListarCategorias_Combo(){$.ajax({type:"GET",url:"services/categorias/categoria-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#ddlCentro").val()},success:function(t){var e="",o=0,r=t.length;if(r>0)for(;o<r;)e+='<option value="'+t[o].tm_idcategoria+'">'+t[o].tm_nombre+"</option>",++o;else e='<option value="0">No existen categor&iacute;as registradas.</option>';$("#ddlCategoria").html(e)},error:function(t){console.log(t)}})}function ListarCentros(){$.ajax({type:"GET",url:"services/centro/centro-empresa.php",cache:!1,dataType:"json",success:function(t){var e='<option value="0">TODOS</option>',o=t.length,r=0;if(o>0)for(;r<o;)e+='<option value="'+t[r].tm_idcentro+'">'+t[r].tm_nombre+"</option>",++r;$("#ddlCentro").html(e)},error:function(t){console.log(t)}})}$(function(){ListarCentros(),ListarCategorias_Combo(),cargarDatePicker("#txtFecha",function(t,e){}),cargarDatePicker_Restrict("#txtFechaIni",function(t,e){}),cargarDatePicker("#txtFechaIni_Caja",function(t,e){}),cargarDatePicker("#txtFechaFin",function(t,e){}),Reporte_Ventas(0),$("#btnShowFilter").on("click",function(t){t.preventDefault(),toggleOptions_v2("#pnlFiltro","left")}),$("#btnCloseFilter").on("click",function(t){t.preventDefault(),toggleOptions_v2("#pnlFiltro","left")}),$("#gvControlStock").on("scroll",function(t){t.preventDefault(),gvControlStock.listenerScroll(this,t)}),$("#gvControlStockMinimo").on("scroll",function(t){t.preventDefault(),gvControlStockMinimo.listenerScroll(this,t)}),$("#btnConsultarReporte").on("click",function(t){t.preventDefault(),MostrarReporte(0)}),$("#btnExportarReporte").on("click",function(t){t.preventDefault(),MostrarReporte(1)}),$("#txtSearchCliente").easyAutocomplete({url:function(t){var e="services/clientes/clientes-autocomplete.php";return e+="?idempresa="+$("#hdIdEmpresa").val(),e+="&idcentro="+$("#ddlCentro").val(),e+="&tipobusqueda=3",e+="&criterio="+t},getValue:function(t){return t.tm_numerodoc.toLowerCase()+" - "+t.Descripcion},list:{onSelectItemEvent:function(){var t=$("#txtSearchCliente").getSelectedItemData().tm_idtipocliente;$("#hdIdCliente").val(t).trigger("change")}},template:{type:"custom",method:function(t,e){return e.tm_numerodoc.toLowerCase()+" - "+e.Descripcion}},theme:"square"})});var gvControlStock=new DataList("#gvControlStock",{onSearch:function(){Reporte_ControlStock(gvControlStock.currentPage(),0)}}),gvControlStockMinimo=new DataList("#gvControlStockMinimo",{onSearch:function(){Reporte_ControlStockMinimo(gvControlStockMinimo.currentPage(),0)}});