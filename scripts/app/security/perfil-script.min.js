function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#txtDescripcion").val(""),$("#txtAbreviatura").val(""),$("#chkSelectAllMenu").prop("checked",!1),$("#txtNombre").val("").focus()}function MostrarDatos(){$.ajax({url:"services/perfil/perfil-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(t){var e=0,a=t.length,i="";if(a>0)for(;e<a;)i+='<li class="mdl-list__item dato pos-rel" data-id="'+t[e].tm_idperfil+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+t[e].tm_idperfil+'" />',i+='<span class="mdl-list__item-primary-content">'+t[e].tm_nombre+"</span>",i+='<div class="grouped-buttons place-bottom-right padding5 margin5"><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="edit" data-delay="50" data-position="bottom" data-tooltip="Editar"><i class="material-icons">&#xE254;</i></a><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="delete" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></a></div>',i+="</li>",++e;else i="<h2>No se encontraron registros</h2>";$("#gvDatos .gridview").html(i)},error:function(t){console.log(t)}})}function GuardarDatos(){var t=new FormData,e=$("#modalRegistro :input").serializeArray();t.append("btnGuardar","btnGuardar"),Array.prototype.forEach.call(e,function(e){t.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/perfil/perfil-post.php",cache:!1,contentType:!1,processData:!1,data:t,dataType:"json",success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&(closeCustomModal("#modalRegistro"),MostrarDatos())},error:function(t){console.log(t)}})}function GetDataById(t){LimpiarForm(),openModalCallBack("#modalRegistro",function(){"0"==t?ListarOpcionesMenu("0"):$.ajax({url:"services/perfil/perfil-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",idperfil:t},success:function(t){t.length>0&&($("#hdIdPrimary").val(t[0].tm_idperfil),$("#txtNombre").val(t[0].tm_nombre),$("#txtDescripcion").val(t[0].tm_descripcion),$("#txtAbreviatura").val(t[0].tm_abreviatura),Materialize.updateTextFields(),ListarOpcionesMenu(t[0].tm_idperfil))},error:function(t){console.log(t)}})})}function EliminarItem(t,e){var a=new FormData,i=t.getAttribute("data-id");a.append("btnEliminar","btnEliminar"),a.append("hdIdPrimary",i),$.ajax({type:"POST",url:"services/perfil/perfil-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:a,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(t).fadeOut(400,function(){$(this).remove(),0==$("#gvDatos .dato").length&&$("#gvDatos .gridview").html("<h2>No se encontraron registros</h2>")}),"multiple"==e?(++indexList,indexList<=elemsSelected.length-1?EliminarItem(elemsSelected[indexList],e):(n=!0,i=a.titulomsje)):"single"==e&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(t){console.log(t)}})}function ListarOpcionesMenu(t){precargaExp("#modalRegistro .ibody",!0),$.ajax({type:"GET",url:"services/menu/menu-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"CONFIG",idperfil:t},success:function(t){var e="",a=t.length,i="#gvOpcionesMenu tbody";a>0?(e=treeMenu(t,0,0),$(i).html(e)):$(i).html('<tr><td colspan="2">No se encontraron resultados.</td></tr>'),precargaExp("#modalRegistro .ibody",!1)},error:function(t){console.log(t)}})}function treeMenu(t,e,a){var i="";for(var n in t)if(t[n].tm_idmenuref==e){var o=0==t[n].idperfilmenu?"":' checked=""';i+="<tr>",i+="<td>",i+='<input id="chkMenu'+n+'" name="chkMenu[]"  class="filled-in" type="checkbox" value="'+t[n].tm_idmenu+'"'+o+' /><label for="chkMenu'+n+'"></label>',i+='<input type="hidden" value="'+t[n].idperfilmenu+'" />',i+="</td><td>"+t[n].tipomenu+"</td><td>"+t[n].tm_titulo+"</td></tr>",i+=treeMenu(t,t[n].tm_idmenu,a)}return i}$(function(){$("#gvDatos").on("click",".mdl-button",function(t){t.preventDefault();var e=this.getAttribute("data-action"),a=getParentsUntil(this,"#gvDatos",".dato");if("edit"==e){var i=a[0].getAttribute("data-id");GetDataById(i)}else MessageBox({content:"Â¿Desea eliminar el tipo de comprobante?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(t){EliminarItem(a[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(t){t.preventDefault(),GetDataById("0")}),$("#btnGuardar").on("click",function(t){t.preventDefault(),GuardarDatos()}),$("#btnLimpiar").on("click",function(t){t.preventDefault(),LimpiarForm()}),$("#txtNombre").on("keydown",function(t){if(t.keyCode==$.ui.keyCode.ENTER)return $("#txtDescripcion").focus(),!1}),$("#chkSelectAllMenu").on("change",function(t){$("#gvOpcionesMenu tbody input:checkbox").prop("checked",this.checked)}),MostrarDatos()});