function GetDataById(a){LimpiarFormUsuario(),openModalCallBack("#modalRegistro",function(){"0"==a?(ListarPerfiles_Combo("0"),ListarCentros_Combo("0"),habilitarControl("#txtClave,#txtConfirmClave",!0),$("#ddlTipoPersona").focus()):$.ajax({url:"services/usuarios/usuarios-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"4",idusuario:a},success:function(a){a.length>0&&(habilitarControl("#txtClave,#txtConfirmClave",!1),$("#hdIdUsuario").val(a[0].tm_idusuario),$("#txtNombre").val(a[0].tm_login),$("#txtNombres").val(a[0].tm_nombres),$("#txtApellidos").val(a[0].tm_apellidos),$("#txtEmail").val(a[0].tm_email),$("#txtTelefono").val(a[0].tm_telefono),$("#ddlTipoPersona").val(a[0].ta_tipopersona),$("#hdIdPersona").val(a[0].tm_idpersona),$("#txtSearchPersonal").val(a[0].tm_nrodni+" - "+a[0].tm_apellidos+" "+a[0].tm_nombres),ListarPerfiles_Combo(a[0].tm_idperfil),ListarCentros_Combo(a[0].tm_idcentro),Materialize.updateTextFields())},error:function(a){console.log(a)}})})}function setPersona(a,e,t,o){$("#hdIdPersona").val(a),$("#pnlInfoPersonal").attr("data-idpersona",a),$("#pnlInfoPersonal .descripcion").text(t),$("#pnlInfoPersonal .docidentidad").text(e),$("#pnlInfoPersonal .direccion").text(o),$("#pnlSearchPersona").fadeOut("400",function(){})}function BuscarDatos(a){var e="#gvDatos .gridview";precargaExp("#gvDatos",!0),$.ajax({type:"GET",url:"services/usuarios/usuarios-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),pagina:a},success:function(t){var o=0,i=t.length,r="";if(i>0){for(;o<i;){var s=t[o].tm_idusuario,n=t[o].tm_foto;r+='<li class="mdl-list__item dato pos-rel" data-id="'+s+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+s+'" />',r+='<span class="mdl-list__item-primary-content">',r+="no-set"==n?'<i class="material-icons mdl-list__item-avatar">person</i>':'<img src="'+n+'" alt="" class="mdl-list__item-avatar" />',r+=t[o].tm_login,null!=t[o].tm_nombres&&null!=t[o].tm_apellidos&&t[o].tm_nombres.trim().length>0&&t[o].tm_apellidos.trim().length>0&&(r+=" ("+t[o].tm_nombres+" "+t[o].tm_apellidos+")"),r+="</span>",r+='<div class="grouped-buttons place-bottom-right padding5 margin5"><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="change-password" data-delay="50" data-position="bottom" data-tooltip="Cambiar password"><i class="material-icons">&#xE897;</i></a><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="edit" data-delay="50" data-position="bottom" data-tooltip="Editar"><i class="material-icons">&#xE254;</i></a><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="delete" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></a></div>',r+="</li>",++o}"1"==a?$(e).html(r):$(e).append(r)}else"1"==a&&$(e).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvDatos",!1)},error:function(a){console.log(a)}})}function GuardarDatos(){var a=new FormData,e=$("#modalRegistro :input").serializeArray();a.append("btnGuardar","btnGuardar"),a.append("hdIdEmpresa",$("#hdIdEmpresa").val()),a.append("hdIdCentro",$("#hdIdCentro").val()),Array.prototype.forEach.call(e,function(e){a.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/usuarios/usuarios-post.php",cache:!1,contentType:!1,processData:!1,data:a,dataType:"json",success:function(a){createSnackbar(a.titulomsje),"0"!=a.rpta&&(closeCustomModal("#modalRegistro"),BuscarDatos("1"))},error:function(a){console.log(a)}})}function ListarPerfiles(a){var e="",t="0",o="",i="";"DATA"==a?(e="1",o="#pnlPermisos .gp-header"):"FIELD"==a&&(e="PERFILUSER",t=$("#hdIdPerfilUsuario").val(),o="#tablePerfil .ibody"),precargaExp(o,!0),$.ajax({type:"GET",url:"services/perfil/perfil-search.php",cache:!1,dataType:"json",data:{tipobusqueda:e,idperfil:t,idusuario:$("#hdIdUsuario").val()},success:function(e){var t=0,r=0,s="",n="";if(r=e.length,"DATA"==a?n="#gvPerfil":"FIELD"==a&&(n="#tablePerfil tbody"),r>0){for(;t<r;)"DATA"==a?(s+='<div data-idperfil="'+e[t].tm_idperfil+'" class="tile dato double" data-click="transform">',s+='<div class="tile-content">',s+='<div class="text-right padding10 ntp">',s+='<h3 class="fg-gray">'+e[t].tm_nombre+"</h3>",s+="</div>",s+="</div>",s+='<div class="brand">',s+='<div class="label fg-darker">C&oacute;digo: '+e[t].tm_codigo+"</div>",s+="</div>",s+="</div>",s+="</div>"):"FIELD"==a&&(i=0==e[t].idperfilusuario?"":' checked=""',s+="<tr><td>",s+='<div class="input-control checkbox" data-role="input-control">',s+="<label>",s+='<input name="hdIdPefilMenu[]" type="checkbox" value="'+e[t].tm_idperfil+'"'+i+" />",s+='<span class="check"></span>',s+="</label></div>",s+="</td><td>"+e[t].tm_nombre+"</td></tr>"),++t;"DATA"==a?$(n).html(s).find(".tile:first").trigger("click"):"FIELD"==a&&$(n).html(s)}else"DATA"==a?$(n).html("<h2>No se encontraron resultados.</h2>"):"FIELD"==a&&$(n).html("");precargaExp(o,!1)}})}function ListarCentros_Combo(a){$.ajax({type:"GET",url:"services/centro/centro-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:$("#hdIdEmpresa").val()},success:function(e){var t="",o=e.length,i=0;if(o>0)for(;i<o;){var r=a==e[i].tm_idcentro?" selected":"";t+="<option"+r+' value="'+e[i].tm_idcentro+'">'+e[i].tm_nombre+"</option>",++i}$("#ddlCentro").html(t)},error:function(a){console.log(a)}})}function ListarPerfiles_Combo(a){$.ajax({type:"GET",url:"services/perfil/perfil-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val()},success:function(e){var t="",o=e.length,i=0;if(o>0)for(;i<o;){var r=a==e[i].tm_idperfil?" selected":"";t+="<option"+r+' value="'+e[i].tm_idperfil+'">'+e[i].tm_nombre+"</option>",++i}$("#ddlPerfil").html(t)},error:function(a){console.log(a)}})}function LimpiarFormUsuario(){}function BuscarPersona(a){var e,t="#gvPersona .items-area",o="",i="";e=$("#pnlPersona .sectionHeader button.success"),o=e.attr("data-tipodata"),"00"==o?i="services/clientes/clientes-search.php":"01"==o?i="services/proveedores/proveedores-search.php":"02"==o&&(i="services/organigrama/organigrama-search.php"),precargaExp("#gvPersona",!0),$.ajax({type:"GET",url:i,cache:!1,dataType:"json",data:"criterio="+$("#txtSearchPersona").val()+"&pagina="+a,success:function(e){var i=0,r=e.length,s="";if(r>0){if("00"==o)for(;i<r;)iditem=e[i].tm_idtipocliente,foto=e[i].tm_foto,s+='<a href="#" class="list dato bg-gray-glass" rel="'+iditem+'" data-tipocliente="'+e[i].tm_iditc+'">',s+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',s+='<div class="list-content">',s+='<div class="data">',s+="<aside>",s+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',s+="</aside>",s+='<main><p class="fg-darker"><strong class="descripcion">'+e[i].Descripcion+"</strong>Tel&eacute;fono: "+e[i].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+e[i].tm_direccion+'</span><br /><span class="docidentidad">'+e[i].TipoDoc+": "+e[i].tm_numerodoc+"</span> - Email: "+e[i].tm_email+"</p>",s+="</main></div></div>",s+="</a>",++i;else if("01"==o)for(;i<r;)iditem=e[i].tm_idproveedor,foto=e[i].tm_foto,s+='<a href="#" class="list dato bg-gray-glass" rel="'+iditem+'">',s+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',s+='<div class="list-content">',s+='<div class="data">',s+="<aside>",s+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',s+="</aside>",s+='<main><p class="fg-darker"><strong class="descripcion">'+e[i].tm_nombreproveedor+"</strong>Tel&eacute;fono: "+e[i].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+e[i].tm_direccion+'</span><br /><span class="docidentidad">RUC: '+e[i].tm_numerodoc+"</span> - Email: "+e[i].tm_email+"</p>",s+="</main></div></div>",s+="</a>",++i;else if("02"==o)for(;i<r;)iditem=e[i].tm_idpersonal,foto=e[i].tm_foto,s+='<a href="#" class="list dato bg-gray-glass"rel="'+iditem+'">',s+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',s+='<div class="list-content">',s+='<div class="data">',s+="<aside>",s+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',s+="</aside>",s+='<main><p class="fg-darker"><strong class="descripcion">'+e[i].tm_apellidopaterno+" "+e[i].tm_apellidomaterno+" "+e[i].tm_nombres+'</strong>Cargo: <span class="direccion">'+e[i].Cargo+'</span><br /><span class="docidentidad">RUC: '+e[i].tm_nrodni+"</span> - Email: "+e[i].tm_email+"</p>",s+="</main></div></div>",s+="</a>",++i;"1"==a?$(t).html(s):$(t).append(s),$("#hdPagePersona").val(Number($("#hdPagePersona").val())+1),$(t).on("scroll",function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){var a=$("#hdPagePersona").val();BuscarPersona(a)}})}else"1"==a&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvPersona",!1)}})}function EliminarUsuario(){indexList=0,elemsSelected=$("#gvDatos").find(".selected"),EliminarItemUsuario(elemsSelected[0],"multiple")}function EliminarItemUsuario(a,e){var t=new FormData,o=a.getAttribute("data-id");t.append("btnEliminarUsuario","btnEliminarUsuario"),t.append("hdIdUsuario",o),$.ajax({url:"services/usuarios/usuarios-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){var o="",i=!1;"0"==t.rpta?(i=!0,o="No se puede eliminar"):($(a).fadeOut(400,function(){$(this).remove()}),"multiple"==e?(++indexList,indexList<=elemsSelected.length-1?EliminarItemUsuario(elemsSelected[indexList],e):(i=!0,o=t.titulomsje)):"single"==e&&(i=!0,o=t.titulomsje)),i&&createSnackbar(o)},error:function(a){console.log(a)}})}function CambiarClave(){var a=new FormData,e=$("#modalChangePassword :input").serializeArray();a.append("btnCambiarClave","btnCambiarClave"),Array.prototype.forEach.call(e,function(e){a.append(e.name,e.value)}),$.ajax({url:"services/usuarios/usuarios-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){},error:function(a){console.log(a)}})}$(function(){$("#gvDatos").on("click","a",function(a){a.preventDefault();var e=this.getAttribute("data-action"),t=getParentsUntil(this,"#gvDatos",".dato"),o=t[0].getAttribute("data-id");"edit"==e?GetDataById(o):"change-password"==e?($("#hdIdUsuarioClave").val(o),openCustomModal("#modalChangePassword")):MessageBox({content:"¿Desea eliminar el tipo de comprobante?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(a){EliminarItemUsuario(t[0],"single")}}],cancelButton:!0})}),$("#btnCambiarClave").on("click",function(a){a.preventDefault(),CambiarClave()}),$("#txtSearchPersonal").easyAutocomplete({url:function(a){return"services/organigrama/organigrama-search.php?criterio="+a+"&tipobusqueda=1&idempresa="+$("#hdIdEmpresa").val()+"&idcentro="+$("#hdIdCentro").val()},getValue:function(a){return a.tm_nrodni+" - "+a.tm_apellidopaterno+" "+a.tm_apellidomaterno+" "+a.tm_nombres},list:{onSelectItemEvent:function(){var a=$("#txtSearchPersonal").getSelectedItemData(),e=a.tm_idpersonal,t=a.tm_nrodni,o=a.tm_apellidopaterno+" "+a.tm_apellidomaterno,i=a.tm_nombres,r=a.tm_email,s=a.tm_telefono;$("#hdIdPersona").val(e),$("#txtNumeroDoc").val(t),$("#txtApellidos").val(o),$("#txtNombres").val(i),$("#txtEmail").val(r),$("#txtTelefono").val(s),Materialize.updateTextFields()}},template:{type:"custom",method:function(a,e){return e.tm_nrodni+" - "+e.tm_apellidopaterno+" "+e.tm_apellidomaterno+" "+e.tm_nombres}},theme:"square"}),$("#ddlCargo").focus().on("change",function(){idreferencia=$(this).val(),LoadPersonal(TipoBusqueda,$(this).val(),"0","1")}),$("#btnNuevo").on("click",function(a){a.preventDefault(),GetDataById("0")}),BuscarDatos("1"),$("#btnEditarPerfil").on("click",function(a){var e="0";a.preventDefault(),e=$("#gvPerfil .tile.selected").attr("data-idperfil"),LimpiarFormPerfil(),openCustomModal("#modalPerfil"),GetPerfil(e),$("#txtNombrePerfil").focus()}),$("#btnNuevoPerfil").on("click",function(a){a.preventDefault(),LimpiarFormPerfil(),openCustomModal("#modalPerfil"),$("#txtNombrePerfil").focus()}),$("#btnGuardar").on("click",function(a){a.preventDefault(),GuardarDatos()}),$("#btnGuardarPerfil").on("click",function(a){a.preventDefault(),GuardarPerfil()}),$("#btnAplicarPerfil").on("click",function(a){a.preventDefault(),AplicarPerfil()}),$("#chkAllMenu").on("click",function(a){var e=$(this)[0].checked,t=$("#tableMenu tbody input:checkbox"),o=t.length;if(o>0)for(var i=0;i<o;i++)t[i].checked=e}),ListarPerfiles("DATA")});