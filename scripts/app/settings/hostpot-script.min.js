function crearItem_Serie(e){var t=e.td_idnumeraciondoc,a=(e.tm_idtipocomprobante,e.TipoComprobante),i=e.td_serie,n=e.td_correlativo,r="";return r+='<div class="mdl-card dato demo-card-order mdl-shadow--2dp mdl-cell mdl-cell--3-col" data-idserie="'+t+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+t+'" />',r+='<div class="generic-panel">',r+='<div class="gp-header">',r+='<h4 class="padding20 no-margin">'+a+"</h4>",r+="</div>",r+='<div class="gp-body">',r+='<div class="panel-view row padding20">',r+="<h4>Serie: "+i+"</h4>",r+="<h4>Correlativo: "+n+"</h4>",r+="</div>",r+="</div>",r+='<div class="gp-footer">',r+='<div class="grouped-buttons place-bottom-right padding5 margin5">',r+='<button class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="edit-serie" data-delay="50" data-position="bottom" data-tooltip="Editar"><i class="material-icons">&#xE254;</i></button>',r+='<button class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="delete-serie" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></button>',r+="</div>",r+="</div>",r+="</div>",r+="</div>"}function MostrarSeries(e){$.ajax({url:"services/numeracion/numventa-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),id:e},success:function(e){var t=0,a=e.length,i="";if(a>0)for(;t<a;)i+=crearItem_Serie(e[t]),++t;else i="<h2>No se encontraron registros</h2>";$("#nav li.active .gridview").html(i)},error:function(e){console.log(e)}})}function ShowSeriesByCurrentTab(){var e=$("#nav li.active");$("#nav li.active").length>0&&MostrarSeries(e.attr("data-idterminal"))}function LimpiarTerminal(){$("#hdIdTerminal").val("0"),$("#txtNombre").val("").focus()}function addValidForm(){$("#txtNombre").rules("add",{required:!0,maxlength:150})}function limpiarSeleccionados(){$(".listview .selected").removeClass("selected"),$(".listview .list input:checkbox").removeAttr("checked")}function crearItem_Terminal(e,t){var a="";return a+='<li data-idterminal="'+e.tm_idterminal+'">',a+='<div class="collapsible-header"><i class="material-icons">&#xE42A;</i>'+e.tm_nombre+"</div>",a+='<div class="collapsible-body">',a+='<div class="panel panel-default no-margin">',a+='<div class="panel-heading"><h3 class="panel-title">Series configuradas</h3></div>',a+='<div class="panel-body"><div class="gridview mdl-grid no-padding"></div></div>',a+='<div class="panel-footer">',a+='<button data-action="edit-terminal" type="button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--primary mdl-button--colored left">Editar terminal</button>',a+='<button data-action="delete-terminal" type="button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored left">Eliminar terminal</button>',a+='<button data-action="new-serie" type="button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored right">Nueva serie de venta</button>',a+='<div class="clear"></div>',a+="</div>",a+="</div>",a+="</div>",a+="</li>"}function MostrarDatos(){$.ajax({url:"services/terminal/terminal-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(e){var t=0,a=e.length,i="";if(a>0)for(;t<a;)i+=crearItem_Terminal(e[t],0==t),++t;$("#nav").html(i).collapsible({accordion:!1}).find("li:first > .collapsible-header").trigger("click")},error:function(e){console.log(e)}})}function GuardarSerie(){var e=new FormData,t=$("#modalSerie :input").serializeArray();e.append("btnGuardarSerie","btnGuardarSerie"),e.append("hdIdTerminal",$("#hdIdTerminal").val()),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/terminal/terminal-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){createSnackbar(e.titulomsje),"0"!=typeof e.rpta&&(closeCustomModal("#modalSerie"),ShowSeriesByCurrentTab())},error:function(e){console.log(e)}})}function GuardarTerminal(){var e=new FormData,t=$("#modalTerminal :input").serializeArray();e.append("btnGuardarTerminal","btnGuardarTerminal"),Array.prototype.forEach.call(t,function(t){e.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/terminal/terminal-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){if(createSnackbar(e.titulomsje),"0"!=e.rpta){var t=$("#hdIdTerminal").val(),a=crearItem_Terminal(e.rpta[0],!1);"0"==t?$("#nav").append(a):$('#nav li[data-idterminal="'+t+'"]').replaceWith(a),$("#nav").collapsible({accordion:!1}),"0"!=t&&$('#nav li[data-idterminal="'+t+'"] > .collapsible-header').trigger("click"),closeCustomModal("#modalTerminal")}},error:function(e){console.log(e)}})}function GetTerminalById(e){LimpiarTerminal(),openModalCallBack("#modalTerminal",function(){"0"!=e&&$.ajax({url:"services/terminal/terminal-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:e},success:function(e){e.length>0&&($("#hdIdTerminal").val(e[0].tm_idterminal),$("#txtNombre").val(e[0].tm_nombre),$("#txtDireccionIP").val(e[0].tm_direccionip),Materialize.updateTextFields())},error:function(e){console.log(e)}})})}function LimpiarSerie(){$("#hdIdSerie").val("0"),$("#ddlTipoComprobante").attr("data-idtipocomprobante","0"),$("#ddlTipoComprobante")[0].selectedIndex=0,$("#txtSerie").val(""),$("#txtCorrelativo").val("")}function GetSerieById(e){LimpiarSerie(),openModalCallBack("#modalSerie",function(){"0"!=e&&$.ajax({url:"services/numeracion/numventa-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:e},success:function(e){e.length>0&&($("#hdIdSerie").val(e[0].td_idnumeraciondoc),$("#ddlTipoComprobante").val(e[0].tm_idtipocomprobante).attr("data-idtipocomprobante",e[0].tm_idtipocomprobante),$("#txtSerie").val(e[0].td_serie),$("#txtCorrelativo").val(e[0].td_correlativo),Materialize.updateTextFields())},error:function(e){console.log(e)}})})}function ListarTipoComprobante(){$.ajax({url:"services/tipocomprobante/tipocomprobante-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(e){var t=0,a=e.length,i="",n=$("#ddlTipoComprobante").attr("data-idtipocomprobante");if(a>0)for(;t<a;){var r=n==e[t].tm_idtipocomprobante?' selected="selected"':"";i+="<option"+r+' value="'+e[t].tm_idtipocomprobante+'">'+e[t].tm_nombre+"</option>",++t}else i='<option value="0">NO EXISTEN TIPOS DE COMPROBANTE REGISTRADOS</option>';$("#ddlTipoComprobante").html(i)},error:function(e){console.log(e)}})}function EliminarTerminal(e){var t=e.getAttribute("data-idterminal");MessageBox({content:"¿Desea eliminar la terminal?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(a){var i=new FormData;i.append("btnEliminarTerminal","btnEliminarTerminal"),i.append("hdIdTerminal",t),$.ajax({type:"POST",url:"services/terminal/terminal-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:i,success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&$(e).fadeOut(400,function(){$(this).remove()})},error:function(e){console.log(e)}})}}],cancelButton:!0})}function EliminarSerie(){indexList=0,elemsSelected=$("#gvDatos").find(".selected"),EliminarItemSerie(elemsSelected[0],"multiple")}function EliminarItemSerie(e,t){var a=new FormData,i=e.getAttribute("data-idserie");a.append("btnEliminarSerie","btnEliminarSerie"),a.append("hdIdSerie",i),$.ajax({url:"services/terminal/terminal-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var i="",n=!1;"0"==a.rpta?(n=!0,i="No se puede eliminar"):($(e).fadeOut(400,function(){$(this).remove(),0==$("#nav li.active .dato").length&&$("#nav li.active .gridview").html("<h2>No se encontraron registros</h2>")}),"multiple"==t?(++indexList,indexList<=elemsSelected.length-1?EliminarItemSerie(elemsSelected[indexList],t):(n=!0,i=a.titulomsje)):"single"==t&&(n=!0,i=a.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(e){console.log(e)}})}$(function(){MostrarDatos(),$("#nav").on("click","li > .collapsible-header",function(e){e.preventDefault(),ShowSeriesByCurrentTab()}),$("#nav").on("click","button",function(e){e.preventDefault();var t,a=this.getAttribute("data-action"),i="0";"edit-terminal"==a||"delete-terminal"==a||"new-serie"==a?(t=getParentsUntil(this,"#nav","li"),i=t[0].getAttribute("data-idterminal"),"edit-terminal"==a?GetTerminalById(i):"delete-terminal"==a?EliminarTerminal(t[0]):($("#hdIdTerminal").val(i),GetSerieById("0"))):"edit-serie"!=a&&"delete-serie"!=a||(t=getParentsUntil(this,"#nav",".dato"),"edit-serie"==a?(i=t[0].getAttribute("data-idserie"),GetSerieById(i)):MessageBox({content:"¿Desea eliminar este item?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(e){EliminarItemSerie(t[0],"single")}}],cancelButton:!0}))}),$("#btnGuardarTerminal").on("click",function(e){e.preventDefault(),GuardarTerminal()}),$("#btnGuardarSerie").on("click",function(e){e.preventDefault(),GuardarSerie()}),$("#btnNuevo").on("click",function(e){e.preventDefault(),GetTerminalById("0")}),ListarTipoComprobante(),$("#btnUpdateTipoComprobante").on("click",function(e){e.preventDefault(),ListarTipoComprobante()})});var indexList=0,elemsSelected;