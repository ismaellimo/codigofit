function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#txtAbreviatura").val(""),$("#txtNombre").val("").focus()}function addValidForm(){$("#txtNombre").rules("add",{required:!0,maxlength:150,remote:{url:"services/unidadmedida/check-nombre.php",type:"POST",data:{idempresa:function(){return $("#hdIdEmpresa").val()},idcentro:function(){return $("#hdIdCentro").val()},idregistro:function(){return $("#hdIdPrimary").val()}}}})}function MostrarDatos(){$.ajax({url:"services/unidadmedida/unidadmedida-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idempresa:$("#hdIdEmpresa").val(),idcentro:$("#hdIdCentro").val(),criterio:""},success:function(t){var a=0,e=t.length,i="";if(e>0)for(;a<e;)i+='<li class="mdl-list__item dato pos-rel" data-id="'+t[a].tm_idunidadmedida+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+t[a].tm_idunidadmedida+'" />',i+='<span class="mdl-list__item-primary-content">'+t[a].tm_nombre+"</span>",i+='<div class="grouped-buttons place-bottom-right padding5 margin5"><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="edit" data-delay="50" data-position="bottom" data-tooltip="Editar"><i class="material-icons">&#xE254;</i></a><a class="padding5 mdl-button mdl-button--icon tooltipped" href="#" data-action="delete" data-delay="50" data-position="bottom" data-tooltip="Eliminar"><i class="material-icons">&#xE872;</i></a></div>',i+="</li>",++a;else i="<h2>No se encontraron registros</h2>";$("#gvDatos .gridview").html(i)},error:function(t){console.log(t)}})}function GuardarDatos(){var t=new FormData,a=$("#modalRegistro :input").serializeArray();t.append("btnGuardar","btnGuardar"),Array.prototype.forEach.call(a,function(a){t.append(a.name,a.value)}),$.ajax({type:"POST",url:"services/unidadmedida/unidadmedida-post.php",cache:!1,contentType:!1,processData:!1,data:t,dataType:"json",success:function(t){createSnackbar(t.titulomsje),"0"!=t.rpta&&(closeCustomModal("#modalRegistro"),MostrarDatos())},error:function(t){console.log(t)}})}function GetDataById(t){LimpiarForm(),openModalCallBack("#modalRegistro",function(){"0"!=t&&$.ajax({url:"services/unidadmedida/unidadmedida-search.php",type:"GET",dataType:"json",data:{tipo:"L",tipobusqueda:"2",idunidadmedida:t},success:function(t){t.length>0&&($("#hdIdPrimary").val(t[0].tm_idunidadmedida),$("#txtNombre").val(t[0].tm_nombre),$("#txtAbreviatura").val(t[0].tm_abreviatura),Materialize.updateTextFields())},error:function(t){console.log(t)}})})}function EliminarItem(t,a){var e=new FormData,i=t.getAttribute("data-id");e.append("btnEliminar","btnEliminar"),e.append("hdIdPrimary",i),$.ajax({type:"POST",url:"services/unidadmedida/unidadmedida-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:e,success:function(e){var i="",n=!1;"0"==e.rpta?(n=!0,i="No se puede eliminar"):($(t).fadeOut(400,function(){$(this).remove(),0==$("#gvDatos .dato").length&&$("#gvDatos .gridview").html("<h2>No se encontraron registros</h2>")}),"multiple"==a?(++indexList,indexList<=elemsSelected.length-1?EliminarItem(elemsSelected[indexList],a):(n=!0,i=e.titulomsje)):"single"==a&&(n=!0,i=e.titulomsje)),n&&(createSnackbar(i),$(".actionbar").hasClass("is-visible")&&$(".back-button").trigger("click"))},error:function(t){console.log(t)}})}$(function(){$("#gvDatos").on("click",".mdl-button",function(t){t.preventDefault();var a=this.getAttribute("data-action"),e=getParentsUntil(this,"#gvDatos",".dato");if("edit"==a){var i=e[0].getAttribute("data-id");GetDataById(i)}else MessageBox({content:"Â¿Desea eliminar la unidad de medida?",width:"320px",height:"130px",buttons:[{primary:!0,content:"Eliminar",onClickButton:function(t){EliminarItem(e[0],"single")}}],cancelButton:!0})}),$("#btnNuevo").on("click",function(t){t.preventDefault(),GetDataById("0")}),$("#btnGuardar").on("click",function(t){t.preventDefault(),GuardarDatos()}),$("#btnLimpiar").on("click",function(t){t.preventDefault(),LimpiarForm()}),$("#txtNombre").on("keydown",function(t){if(t.keyCode==$.ui.keyCode.ENTER)return $("#txtDescripcion").focus(),!1}),MostrarDatos()});